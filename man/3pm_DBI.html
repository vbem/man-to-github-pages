<!-- Creator     : groff version 1.22.2 -->
<!-- CreationDate: Mon Aug  8 15:52:52 2016 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>DBI</title>

</head>
<body>

<h1 align="center">DBI</h1>

<a href="#NAME">NAME</a><br>
<a href="#SYNOPSIS">SYNOPSIS</a><br>
<a href="#DESCRIPTION">DESCRIPTION</a><br>
<a href="#THE DBI PACKAGE AND CLASS">THE DBI PACKAGE AND CLASS</a><br>
<a href="#METHODS COMMON TO ALL HANDLES">METHODS COMMON TO ALL HANDLES</a><br>
<a href="#ATTRIBUTES COMMON TO ALL HANDLES">ATTRIBUTES COMMON TO ALL HANDLES</a><br>
<a href="#DBI DATABASE HANDLE OBJECTS">DBI DATABASE HANDLE OBJECTS</a><br>
<a href="#DBI STATEMENT HANDLE OBJECTS">DBI STATEMENT HANDLE OBJECTS</a><br>
<a href="#FURTHER INFORMATION">FURTHER INFORMATION</a><br>
<a href="#TRACING">TRACING</a><br>
<a href="#DBI ENVIRONMENT VARIABLES">DBI ENVIRONMENT VARIABLES</a><br>
<a href="#WARNING AND ERROR MESSAGES">WARNING AND ERROR MESSAGES</a><br>
<a href="#Pure-Perl DBI">Pure-Perl DBI</a><br>
<a href="#SEE ALSO">SEE ALSO</a><br>
<a href="#AUTHORS">AUTHORS</a><br>
<a href="#COPYRIGHT">COPYRIGHT</a><br>
<a href="#SUPPORT / WARRANTY">SUPPORT / WARRANTY</a><br>
<a href="#ACKNOWLEDGEMENTS">ACKNOWLEDGEMENTS</a><br>
<a href="#CONTRIBUTING">CONTRIBUTING</a><br>
<a href="#TRANSLATIONS">TRANSLATIONS</a><br>
<a href="#TRAINING">TRAINING</a><br>
<a href="#OTHER RELATED WORK AND PERL MODULES">OTHER RELATED WORK AND PERL MODULES</a><br>

<hr>


<h2>NAME
<a name="NAME"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">DBI &minus;
Database independent interface for Perl</p>

<h2>SYNOPSIS
<a name="SYNOPSIS"></a>
</h2>


<pre style="margin-left:11%; margin-top: 1em">  use DBI;
  @driver_names = DBI&minus;&gt;available_drivers;
  %drivers      = DBI&minus;&gt;installed_drivers;
  @data_sources = DBI&minus;&gt;data_sources($driver_name, \%attr);
  $dbh = DBI&minus;&gt;connect($data_source, $username, $auth, \%attr);
  $rv  = $dbh&minus;&gt;do($statement);
  $rv  = $dbh&minus;&gt;do($statement, \%attr);
  $rv  = $dbh&minus;&gt;do($statement, \%attr, @bind_values);
  $ary_ref  = $dbh&minus;&gt;selectall_arrayref($statement);
  $hash_ref = $dbh&minus;&gt;selectall_hashref($statement, $key_field);
  $ary_ref  = $dbh&minus;&gt;selectcol_arrayref($statement);
  $ary_ref  = $dbh&minus;&gt;selectcol_arrayref($statement, \%attr);
  @row_ary  = $dbh&minus;&gt;selectrow_array($statement);
  $ary_ref  = $dbh&minus;&gt;selectrow_arrayref($statement);
  $hash_ref = $dbh&minus;&gt;selectrow_hashref($statement);
  $sth = $dbh&minus;&gt;prepare($statement);
  $sth = $dbh&minus;&gt;prepare_cached($statement);
  $rc = $sth&minus;&gt;bind_param($p_num, $bind_value);
  $rc = $sth&minus;&gt;bind_param($p_num, $bind_value, $bind_type);
  $rc = $sth&minus;&gt;bind_param($p_num, $bind_value, \%attr);
  $rv = $sth&minus;&gt;execute;
  $rv = $sth&minus;&gt;execute(@bind_values);
  $rv = $sth&minus;&gt;execute_array(\%attr, ...);
  $rc = $sth&minus;&gt;bind_col($col_num, \$col_variable);
  $rc = $sth&minus;&gt;bind_columns(@list_of_refs_to_vars_to_bind);
  @row_ary  = $sth&minus;&gt;fetchrow_array;
  $ary_ref  = $sth&minus;&gt;fetchrow_arrayref;
  $hash_ref = $sth&minus;&gt;fetchrow_hashref;
  $ary_ref  = $sth&minus;&gt;fetchall_arrayref;
  $ary_ref  = $sth&minus;&gt;fetchall_arrayref( $slice, $max_rows );
  $hash_ref = $sth&minus;&gt;fetchall_hashref( $key_field );
  $rv  = $sth&minus;&gt;rows;
  $rc  = $dbh&minus;&gt;begin_work;
  $rc  = $dbh&minus;&gt;commit;
  $rc  = $dbh&minus;&gt;rollback;
  $quoted_string = $dbh&minus;&gt;quote($string);
  $rc  = $h&minus;&gt;err;
  $str = $h&minus;&gt;errstr;
  $rv  = $h&minus;&gt;state;
  $rc  = $dbh&minus;&gt;disconnect;</pre>


<p style="margin-left:11%; margin-top: 1em"><i>The synopsis
above only lists the major methods and parameters.</i></p>


<p style="margin-left:11%; margin-top: 1em"><b><small>GETTING
HELP</small></b> <i><br>
General</i></p>

<p style="margin-left:11%; margin-top: 1em">Before asking
any questions, reread this document, consult the archives
and read the <small>DBI FAQ.</small> The archives are listed
at the end of this document and on the <small>DBI</small>
home page &lt;http://dbi.perl.org/support/&gt;</p>

<p style="margin-left:11%; margin-top: 1em">You might also
like to read the Advanced <small>DBI</small> Tutorial at
&lt;http://www.slideshare.net/Tim.Bunce/dbi&minus;advanced&minus;tutorial&minus;2007&gt;</p>

<p style="margin-left:11%; margin-top: 1em">To help you
make the best use of the dbi-users mailing list, and any
other lists or forums you may use, I recommend that you read
&quot;Getting Answers&quot; by Mike Ash:
&lt;http://mikeash.com/getting_answers.html&gt;.</p>

<p style="margin-left:11%; margin-top: 1em"><i>Mailing
Lists</i></p>

<p style="margin-left:11%; margin-top: 1em">If you have
questions about <small>DBI,</small> or <small>DBD</small>
driver modules, you can get help from the
<i>dbi&minus;users@perl.org</i> mailing list. This is the
best way to get help. You don&rsquo;t have to subscribe to
the list in order to post, though I&rsquo;d recommend it.
You can get help on subscribing and using the list by
emailing <i>dbi&minus;users&minus;help@perl.org</i>.</p>

<p style="margin-left:11%; margin-top: 1em">Please note
that Tim Bunce does not maintain the mailing lists or the
web pages (generous volunteers do that). So please
don&rsquo;t send mail directly to him; he just doesn&rsquo;t
have the time to answer questions personally. The
<i>dbi-users</i> mailing list has lots of experienced people
who should be able to help you if you need it. If you do
email Tim he is very likely to just forward it to the
mailing list.</p>


<p style="margin-left:11%; margin-top: 1em"><i>Online</i></p>

<p style="margin-left:11%; margin-top: 1em">StackOverflow
has a <small>DBI</small> tag
&lt;http://stackoverflow.com/questions/tagged/dbi&gt; with
over 400 questions.</p>

<p style="margin-left:11%; margin-top: 1em">The
<small>DBI</small> home page at &lt;http://dbi.perl.org/&gt;
and the <small>DBI FAQ</small> at
&lt;http://faq.dbi&minus;support.com/&gt; may be worth a
visit. They include links to other resources, but <i>are
rather out-dated</i>.</p>

<p style="margin-left:11%; margin-top: 1em">I don&rsquo;t
recommend the <small>DBI</small> cpanforum (at
http://www.cpanforum.com/dist/DBI) because relatively few
people read it compared with dbi&minus;users@perl.org.</p>

<p style="margin-left:11%; margin-top: 1em"><i>Reporting a
Bug</i></p>

<p style="margin-left:11%; margin-top: 1em">If you think
you&rsquo;ve found a bug then please read &quot;How to
Report Bugs Effectively&quot; by Simon Tatham:
&lt;http://www.chiark.greenend.org.uk/~sgtatham/bugs.html&gt;.</p>

<p style="margin-left:11%; margin-top: 1em">Your problem is
most likely related to the specific <small>DBD</small>
driver module you&rsquo;re using. If that&rsquo;s the case
then click on the &rsquo;Bugs&rsquo; link on the
&lt;http://metacpan.org&gt; page for your driver. Only
submit a bug report against the <small>DBI</small> itself if
you&rsquo;re sure that your issue isn&rsquo;t related to the
driver you&rsquo;re using.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>NOTES</small></b>
<br>
This is the <small>DBI</small> specification that
corresponds to <small>DBI</small> version 1.627 (see
DBI::Changes for details).</p>

<p style="margin-left:11%; margin-top: 1em">The
<small>DBI</small> is evolving at a steady pace, so
it&rsquo;s good to check that you have the latest copy.</p>

<p style="margin-left:11%; margin-top: 1em">The significant
user-visible changes in each release are documented in the
DBI::Changes module so you can read them by executing
<tt>&quot;perldoc DBI::Changes&quot;</tt>.</p>

<p style="margin-left:11%; margin-top: 1em">Some
<small>DBI</small> changes require changes in the drivers,
but the drivers can take some time to catch up. Newer
versions of the <small>DBI</small> have added features that
may not yet be supported by the drivers you use. Talk to the
authors of your drivers if you need a new feature that is
not yet supported.</p>

<p style="margin-left:11%; margin-top: 1em">Features added
after <small>DBI 1.21</small> (February 2002) are marked in
the text with the version number of the <small>DBI</small>
release they first appeared in.</p>

<p style="margin-left:11%; margin-top: 1em">Extensions to
the <small>DBI API</small> often use the
<tt>&quot;DBIx::*&quot;</tt> namespace. See &quot;Naming
Conventions and Name Space&quot;. <small>DBI</small>
extension modules can be found at
&lt;http://search.cpan.org/search?mode=module&amp;query=DBIx&gt;.
And all modules related to the <small>DBI</small> can be
found at
&lt;http://search.cpan.org/search?query=DBI&amp;mode=all&gt;.</p>

<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The
<small>DBI</small> is a database access module for the Perl
programming language. It defines a set of methods,
variables, and conventions that provide a consistent
database interface, independent of the actual database being
used.</p>

<p style="margin-left:11%; margin-top: 1em">It is important
to remember that the <small>DBI</small> is just an
interface. The <small>DBI</small> is a layer of
&quot;glue&quot; between an application and one or more
database <i>driver</i> modules. It is the driver modules
which do most of the real work. The <small>DBI</small>
provides a standard interface and framework for the drivers
to operate within.</p>

<p style="margin-left:11%; margin-top: 1em">This document
often uses terms like <i>references</i>, <i>objects</i>,
<i>methods</i>. If you&rsquo;re not familiar with those
terms then it would be a good idea to read at least the
following perl manuals first: perlreftut, perldsc, perllol,
and perlboot.</p>


<p style="margin-left:11%; margin-top: 1em"><b>Architecture
of a <small>DBI</small> Application</b></p>

<pre style="margin-left:11%;">             |&lt;&minus; Scope of DBI &minus;&gt;|
                  .&minus;.   .&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;.   .&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;.
  .&minus;&minus;&minus;&minus;&minus;&minus;&minus;.       | |&minus;&minus;&minus;| XYZ Driver   |&minus;&minus;&minus;| XYZ Engine  |
  | Perl  |       | |   `&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;'   `&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;'
  | script|  |A|  |D|   .&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;.   .&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;.
  | using |&minus;&minus;|P|&minus;&minus;|B|&minus;&minus;&minus;|Oracle Driver |&minus;&minus;&minus;|Oracle Engine|
  | DBI   |  |I|  |I|   `&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;'   `&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;'
  | API   |       | |...
  |methods|       | |... Other drivers
  `&minus;&minus;&minus;&minus;&minus;&minus;&minus;'       | |...
                  `&minus;'</pre>


<p style="margin-left:11%; margin-top: 1em">The
<small>API,</small> or Application Programming Interface,
defines the call interface and variables for Perl scripts to
use. The <small>API</small> is implemented by the Perl
<small>DBI</small> extension.</p>

<p style="margin-left:11%; margin-top: 1em">The
<small>DBI</small> &quot;dispatches&quot; the method calls
to the appropriate driver for actual execution. The
<small>DBI</small> is also responsible for the dynamic
loading of drivers, error checking and handling, providing
default implementations for methods, and many other
non-database specific duties.</p>

<p style="margin-left:11%; margin-top: 1em">Each driver
contains implementations of the <small>DBI</small> methods
using the private interface functions of the corresponding
database engine. Only authors of
sophisticated/multi&minus;database applications or generic
library functions need be concerned with drivers.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Notation and
Conventions</b> <br>
The following conventions are used in this document:</p>

<pre style="margin-left:11%; margin-top: 1em">  $dbh    Database handle object
  $sth    Statement handle object
  $drh    Driver handle object (rarely seen or used in applications)
  $h      Any of the handle types above ($dbh, $sth, or $drh)
  $rc     General Return Code  (boolean: true=ok, false=error)
  $rv     General Return Value (typically an integer)
  @ary    List of values returned from the database, typically a row of data
  $rows   Number of rows processed (if available, else &minus;1)
  $fh     A filehandle
  undef   NULL values are represented by undefined values in Perl
  \%attr  Reference to a hash of attribute values passed to methods</pre>


<p style="margin-left:11%; margin-top: 1em">Note that Perl
will automatically destroy database and statement handle
objects if all references to them are deleted.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Outline
Usage</b> <br>
To use <small>DBI,</small> first you need to load the
<small>DBI</small> module:</p>

<pre style="margin-left:11%; margin-top: 1em">  use DBI;
  use strict;</pre>


<p style="margin-left:11%; margin-top: 1em">(The
<tt>&quot;use strict;&quot;</tt> isn&rsquo;t required but is
strongly recommended.)</p>

<p style="margin-left:11%; margin-top: 1em">Then you need
to &quot;connect&quot; to your data source and get a
<i>handle</i> for that connection:</p>

<pre style="margin-left:11%; margin-top: 1em">  $dbh = DBI&minus;&gt;connect($dsn, $user, $password,
                      { RaiseError =&gt; 1, AutoCommit =&gt; 0 });</pre>


<p style="margin-left:11%; margin-top: 1em">Since
connecting can be expensive, you generally just connect at
the start of your program and disconnect at the end.</p>

<p style="margin-left:11%; margin-top: 1em">Explicitly
defining the required <tt>&quot;AutoCommit&quot;</tt>
behaviour is strongly recommended and may become mandatory
in a later version. This determines whether changes are
automatically committed to the database when executed, or
need to be explicitly committed later.</p>

<p style="margin-left:11%; margin-top: 1em">The
<small>DBI</small> allows an application to
&quot;prepare&quot; statements for later execution. A
prepared statement is identified by a statement handle held
in a Perl variable. We&rsquo;ll call the Perl variable
<tt>$sth</tt> in our examples.</p>

<p style="margin-left:11%; margin-top: 1em">The typical
method call sequence for a <tt>&quot;SELECT&quot;</tt>
statement is:</p>

<pre style="margin-left:11%; margin-top: 1em">  prepare,
    execute, fetch, fetch, ...
    execute, fetch, fetch, ...
    execute, fetch, fetch, ...</pre>


<p style="margin-left:11%; margin-top: 1em">for
example:</p>

<pre style="margin-left:11%; margin-top: 1em">  $sth = $dbh&minus;&gt;prepare(&quot;SELECT foo, bar FROM table WHERE baz=?&quot;);
  $sth&minus;&gt;execute( $baz );
  while ( @row = $sth&minus;&gt;fetchrow_array ) {
    print &quot;@row\n&quot;;
  }</pre>


<p style="margin-left:11%; margin-top: 1em">The typical
method call sequence for a
<i>non</i>&minus;<tt>&quot;SELECT&quot;</tt> statement
is:</p>

<pre style="margin-left:11%; margin-top: 1em">  prepare,
    execute,
    execute,
    execute.</pre>


<p style="margin-left:11%; margin-top: 1em">for
example:</p>

<pre style="margin-left:11%; margin-top: 1em">  $sth = $dbh&minus;&gt;prepare(&quot;INSERT INTO table(foo,bar,baz) VALUES (?,?,?)&quot;);
  while(&lt;CSV&gt;) {
    chomp;
    my ($foo,$bar,$baz) = split /,/;
        $sth&minus;&gt;execute( $foo, $bar, $baz );
  }</pre>


<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;do()&quot;</tt> method can be used for non
repeated <i>non</i>&minus;<tt>&quot;SELECT&quot;</tt>
statement (or with drivers that don&rsquo;t support
placeholders):</p>

<pre style="margin-left:11%; margin-top: 1em">  $rows_affected = $dbh&minus;&gt;do(&quot;UPDATE your_table SET foo = foo + 1&quot;);</pre>


<p style="margin-left:11%; margin-top: 1em">To commit your
changes to the database (when &quot;AutoCommit&quot; is
off):</p>

<pre style="margin-left:11%; margin-top: 1em">  $dbh&minus;&gt;commit;  # or call $dbh&minus;&gt;rollback; to undo changes</pre>


<p style="margin-left:11%; margin-top: 1em">Finally, when
you have finished working with the data source, you should
&quot;disconnect&quot; from it:</p>

<pre style="margin-left:11%; margin-top: 1em">  $dbh&minus;&gt;disconnect;</pre>


<p style="margin-left:11%; margin-top: 1em"><b>General
Interface Rules &amp; Caveats</b> <br>
The <small>DBI</small> does not have a concept of a
&quot;current session&quot;. Every session has a handle
object (i.e., a <tt>$dbh</tt>) returned from the
<tt>&quot;connect&quot;</tt> method. That handle object is
used to invoke database related methods.</p>

<p style="margin-left:11%; margin-top: 1em">Most data is
returned to the Perl script as strings. (Null values are
returned as <tt>&quot;undef&quot;</tt>.) This allows
arbitrary precision numeric data to be handled without loss
of accuracy. Beware that Perl may not preserve the same
accuracy when the string is used as a number.</p>

<p style="margin-left:11%; margin-top: 1em">Dates and times
are returned as character strings in the current default
format of the corresponding database engine. Time zone
effects are database/driver dependent.</p>

<p style="margin-left:11%; margin-top: 1em">Perl supports
binary data in Perl strings, and the <small>DBI</small> will
pass binary data to and from the driver without change. It
is up to the driver implementors to decide how they wish to
handle such binary data.</p>

<p style="margin-left:11%; margin-top: 1em">Perl supports
two kinds of strings: Unicode (utf8 internally) and
non-Unicode (defaults to iso&minus;8859&minus;1 if forced to
assume an encoding). Drivers should accept both kinds of
strings and, if required, convert them to the character set
of the database being used. Similarly, when fetching from
the database character data that isn&rsquo;t
iso&minus;8859&minus;1 the driver should convert it into
utf8.</p>

<p style="margin-left:11%; margin-top: 1em">Multiple
<small>SQL</small> statements may not be combined in a
single statement handle (<tt>$sth</tt>), although some
databases and drivers do support this (notably Sybase and
<small>SQL</small> Server).</p>

<p style="margin-left:11%; margin-top: 1em">Non-sequential
record reads are not supported in this version of the
<small>DBI.</small> In other words, records can only be
fetched in the order that the database returned them, and
once fetched they are forgotten.</p>

<p style="margin-left:11%; margin-top: 1em">Positioned
updates and deletes are not directly supported by the
<small>DBI.</small> See the description of the
<tt>&quot;CursorName&quot;</tt> attribute for an
alternative.</p>

<p style="margin-left:11%; margin-top: 1em">Individual
driver implementors are free to provide any private
functions and/or handle attributes that they feel are
useful. Private driver functions can be invoked using the
<small>DBI</small> <tt>&quot;func()&quot;</tt> method.
Private driver attributes are accessed just like standard
attributes.</p>

<p style="margin-left:11%; margin-top: 1em">Many methods
have an optional <tt>&quot;\%attr&quot;</tt> parameter which
can be used to pass information to the driver implementing
the method. Except where specifically documented, the
<tt>&quot;\%attr&quot;</tt> parameter can only be used to
pass driver specific hints. In general, you can ignore
<tt>&quot;\%attr&quot;</tt> parameters or pass it as
<tt>&quot;undef&quot;</tt>.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Naming
Conventions and Name Space</b> <br>
The <small>DBI</small> package and all packages below it
(<tt>&quot;DBI::*&quot;</tt>) are reserved for use by the
<small>DBI.</small> Extensions and related modules use the
<tt>&quot;DBIx::&quot;</tt> namespace (see
&lt;http://www.perl.com/CPAN/modules/by&minus;module/DBIx/&gt;).
Package names beginning with <tt>&quot;DBD::&quot;</tt> are
reserved for use by <small>DBI</small> database drivers. All
environment variables used by the <small>DBI</small> or by
individual DBDs begin with
&quot;<tt>&quot;DBI_&quot;</tt>&quot; or
&quot;<tt>&quot;DBD_&quot;</tt>&quot;.</p>

<p style="margin-left:11%; margin-top: 1em">The letter case
used for attribute names is significant and plays an
important part in the portability of <small>DBI</small>
scripts. The case of the attribute name is used to signify
who defined the meaning of that name and its values.</p>

<pre style="margin-left:11%; margin-top: 1em">  Case of name  Has a meaning defined by
  &minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;  &minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;
  UPPER_CASE    Standards, e.g.,  X/Open, ISO SQL92 etc (portable)
  MixedCase     DBI API (portable), underscores are not used.
  lower_case    Driver or database engine specific (non&minus;portable)</pre>


<p style="margin-left:11%; margin-top: 1em">It is of the
utmost importance that Driver developers only use lowercase
attribute names when defining private attributes. Private
attribute names must be prefixed with the driver name or
suitable abbreviation (e.g.,
&quot;<tt>&quot;ora_&quot;</tt>&quot; for Oracle,
&quot;<tt>&quot;ing_&quot;</tt>&quot; for Ingres, etc).</p>

<p style="margin-left:11%; margin-top: 1em"><b><small>SQL
&minus; A</small> Query Language</b> <br>
Most <small>DBI</small> drivers require applications to use
a dialect of <small>SQL</small> (Structured Query Language)
to interact with the database engine. The &quot;Standards
Reference Information&quot; section provides links to useful
information about <small>SQL.</small></p>

<p style="margin-left:11%; margin-top: 1em">The
<small>DBI</small> itself does not mandate or require any
particular language to be used; it is language independent.
In <small>ODBC</small> terms, the <small>DBI</small> is in
&quot;pass-thru&quot; mode, although individual drivers
might not be. The only requirement is that queries and other
statements must be expressed as a single string of
characters passed as the first argument to the
&quot;prepare&quot; or &quot;do&quot; methods.</p>

<p style="margin-left:11%; margin-top: 1em">For an
interesting diversion on the <i>real</i> history of
<small>RDBMS</small> and <small>SQL,</small> from the people
who made it happen, see:</p>

<pre style="margin-left:11%; margin-top: 1em">  http://www.mcjones.org/System_R/SQL_Reunion_95/sqlr95.html</pre>


<p style="margin-left:11%; margin-top: 1em">Follow the
&quot;Full Contents&quot; then &quot;Intergalactic
dataspeak&quot; links for the <small>SQL</small>
history.</p>


<p style="margin-left:11%; margin-top: 1em"><b>Placeholders
and Bind Values</b> <br>
Some drivers support placeholders and bind values.
<i>Placeholders</i>, also called parameter markers, are used
to indicate values in a database statement that will be
supplied later, before the prepared statement is executed.
For example, an application might use the following to
insert a row of data into the <small>SALES</small>
table:</p>

<pre style="margin-left:11%; margin-top: 1em">  INSERT INTO sales (product_code, qty, price) VALUES (?, ?, ?)</pre>


<p style="margin-left:11%; margin-top: 1em">or the
following, to select the description for a product:</p>

<pre style="margin-left:11%; margin-top: 1em">  SELECT description FROM products WHERE product_code = ?</pre>


<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;?&quot;</tt> characters are the placeholders. The
association of actual values with placeholders is known as
<i>binding</i>, and the values are referred to as <i>bind
values</i>. Note that the <tt>&quot;?&quot;</tt> is not
enclosed in quotation marks, even when the placeholder
represents a string.</p>

<p style="margin-left:11%; margin-top: 1em">Some drivers
also allow placeholders like
<tt>&quot;:&quot;</tt><i>name</i> and
<tt>&quot;:&quot;</tt><i>N</i> (e.g.,
<tt>&quot;:1&quot;</tt>, <tt>&quot;:2&quot;</tt>, and so on)
in addition to <tt>&quot;?&quot;</tt>, but their use is not
portable.</p>

<p style="margin-left:11%; margin-top: 1em">If the
<tt>&quot;:&quot;</tt><i>N</i> form of placeholder is
supported by the driver you&rsquo;re using, then you should
be able to use either &quot;bind_param&quot; or
&quot;execute&quot; to bind values. Check your driver
documentation.</p>

<p style="margin-left:11%; margin-top: 1em">With most
drivers, placeholders can&rsquo;t be used for any element of
a statement that would prevent the database server from
validating the statement and creating a query execution plan
for it. For example:</p>

<pre style="margin-left:11%; margin-top: 1em">  &quot;SELECT name, age FROM ?&quot;         # wrong (will probably fail)
  &quot;SELECT name, ?   FROM people&quot;    # wrong (but may not 'fail')</pre>


<p style="margin-left:11%; margin-top: 1em">Also,
placeholders can only represent single scalar values. For
example, the following statement won&rsquo;t work as
expected for more than one value:</p>

<pre style="margin-left:11%; margin-top: 1em">  &quot;SELECT name, age FROM people WHERE name IN (?)&quot;    # wrong
  &quot;SELECT name, age FROM people WHERE name IN (?,?)&quot;  # two names</pre>


<p style="margin-left:11%; margin-top: 1em">When using
placeholders with the <small>SQL</small>
<tt>&quot;LIKE&quot;</tt> qualifier, you must remember that
the placeholder substitutes for the whole string. So you
should use &quot;<tt>&quot;... LIKE ? ...&quot;</tt>&quot;
and include any wildcard characters in the value that you
bind to the placeholder.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>NULL</small>
Values</b></p>

<p style="margin-left:11%; margin-top: 1em">Undefined
values, or <tt>&quot;undef&quot;</tt>, are used to indicate
<small>NULL</small> values. You can insert and update
columns with a <small>NULL</small> value as you would a
non-NULL value. These examples insert and update the column
<tt>&quot;age&quot;</tt> with a <small>NULL</small>
value:</p>

<pre style="margin-left:11%; margin-top: 1em">  $sth = $dbh&minus;&gt;prepare(qq{
    INSERT INTO people (fullname, age) VALUES (?, ?)
  });
  $sth&minus;&gt;execute(&quot;Joe Bloggs&quot;, undef);
  $sth = $dbh&minus;&gt;prepare(qq{
    UPDATE people SET age = ? WHERE fullname = ?
  });
  $sth&minus;&gt;execute(undef, &quot;Joe Bloggs&quot;);</pre>


<p style="margin-left:11%; margin-top: 1em">However, care
must be taken when trying to use <small>NULL</small> values
in a <tt>&quot;WHERE&quot;</tt> clause. Consider:</p>

<pre style="margin-left:11%; margin-top: 1em">  SELECT fullname FROM people WHERE age = ?</pre>


<p style="margin-left:11%; margin-top: 1em">Binding an
<tt>&quot;undef&quot;</tt> ( <small>NULL</small> ) to the
placeholder will <i>not</i> select rows which have a
<small>NULL</small> <tt>&quot;age&quot;</tt>! At least for
database engines that conform to the <small>SQL</small>
standard. Refer to the <small>SQL</small> manual for your
database engine or any <small>SQL</small> book for the
reasons for this. To explicitly select NULLs you have to say
&quot;<tt>&quot;WHERE age IS NULL&quot;</tt>&quot;.</p>

<p style="margin-left:11%; margin-top: 1em">A common issue
is to have a code fragment handle a value that could be
either <tt>&quot;defined&quot;</tt> or
<tt>&quot;undef&quot;</tt> (non-NULL or <small>NULL</small>
) at runtime. A simple technique is to prepare the
appropriate statement as needed, and substitute the
placeholder for non-NULL cases:</p>

<pre style="margin-left:11%; margin-top: 1em">  $sql_clause = defined $age? &quot;age = ?&quot; : &quot;age IS NULL&quot;;
  $sth = $dbh&minus;&gt;prepare(qq{
    SELECT fullname FROM people WHERE $sql_clause
  });
  $sth&minus;&gt;execute(defined $age ? $age : ());</pre>


<p style="margin-left:11%; margin-top: 1em">The following
technique illustrates qualifying a
<tt>&quot;WHERE&quot;</tt> clause with several columns,
whose associated values (<tt>&quot;defined&quot;</tt> or
<tt>&quot;undef&quot;</tt>) are in a hash <tt>%h:</tt></p>

<p style="margin-left:11%; margin-top: 1em"><tt>for my $col
(&quot;age&quot;, &quot;phone&quot;, &quot;email&quot;) {
<br>
if (defined $h{$col}) { <br>
push @sql_qual, &quot;$col = ?&quot;; <br>
push @sql_bind, $h{$col}; <br>
} <br>
else { <br>
push @sql_qual, &quot;$col IS NULL&quot;; <br>
} <br>
} <br>
$sql_clause = join(&quot; AND &quot;, @sql_qual); <br>
$sth = $dbh&minus;&gt;prepare(qq{ <br>
SELECT fullname FROM people WHERE $sql_clause <br>
}); <br>
$sth&minus;&gt;execute(@sql_bind);</tt></p>

<p style="margin-left:11%; margin-top: 1em">The techniques
above call prepare for the <small>SQL</small> statement with
each call to execute. Because calls to <i>prepare()</i> can
be expensive, performance can suffer when an application
iterates many times over statements like the above.</p>

<p style="margin-left:11%; margin-top: 1em">A better
solution is a single <tt>&quot;WHERE&quot;</tt> clause that
supports both <small>NULL</small> and non-NULL comparisons.
Its <small>SQL</small> statement would need to be prepared
only once for all cases, thus improving performance. Several
examples of <tt>&quot;WHERE&quot;</tt> clauses that support
this are presented below. But each example lacks
portability, robustness, or simplicity. Whether an example
is supported on your database engine depends on what
<small>SQL</small> extensions it provides, and where it
supports the <tt>&quot;?&quot;</tt> placeholder in a
statement.</p>

<pre style="margin-left:11%; margin-top: 1em">  0)  age = ?
  1)  NVL(age, xx) = NVL(?, xx)
  2)  ISNULL(age, xx) = ISNULL(?, xx)
  3)  DECODE(age, ?, 1, 0) = 1
  4)  age = ? OR (age IS NULL AND ? IS NULL)
  5)  age = ? OR (age IS NULL AND SP_ISNULL(?) = 1)
  6)  age = ? OR (age IS NULL AND ? = 1)</pre>


<p style="margin-left:11%; margin-top: 1em">Statements
formed with the above <tt>&quot;WHERE&quot;</tt> clauses
require execute statements as follows. The arguments are
required, whether their values are
<tt>&quot;defined&quot;</tt> or
<tt>&quot;undef&quot;</tt>.</p>

<pre style="margin-left:11%; margin-top: 1em">  0,1,2,3)  $sth&minus;&gt;execute($age);
  4,5)      $sth&minus;&gt;execute($age, $age);
  6)        $sth&minus;&gt;execute($age, defined($age) ? 0 : 1);</pre>


<p style="margin-left:11%; margin-top: 1em">Example 0
should not work (as mentioned earlier), but may work on a
few database engines anyway (e.g. Sybase). Example 0 is part
of examples 4, 5, and 6, so if example 0 works, these other
examples may work, even if the engine does not properly
support the right hand side of the <tt>&quot;OR&quot;</tt>
expression.</p>

<p style="margin-left:11%; margin-top: 1em">Examples 1 and
2 are not robust: they require that you provide a valid
column value xx (e.g. &rsquo;~&rsquo;) which is not present
in any row. That means you must have some notion of what
data won&rsquo;t be stored in the column, and expect clients
to adhere to that.</p>

<p style="margin-left:11%; margin-top: 1em">Example 5
requires that you provide a stored procedure (
<small>SP_ISNULL</small> in this example) that acts as a
function: it checks whether a value is null, and returns 1
if it is, or 0 if not.</p>

<p style="margin-left:11%; margin-top: 1em">Example 6, the
least simple, is probably the most portable, i.e., it should
work with with most, if not all, database engines.</p>

<p style="margin-left:11%; margin-top: 1em">Here is a table
that indicates which examples above are known to work on
various database engines:</p>

<pre style="margin-left:11%; margin-top: 1em">                   &minus;&minus;&minus;&minus;&minus;Examples&minus;&minus;&minus;&minus;&minus;&minus;
                   0  1  2  3  4  5  6
                   &minus;  &minus;  &minus;  &minus;  &minus;  &minus;  &minus;
  Oracle 9         N  Y  N  Y  Y  ?  Y
  Informix IDS 9   N  N  N  Y  N  Y  Y
  MS SQL           N  N  Y  N  Y  ?  Y
  Sybase           Y  N  N  N  N  N  Y
  AnyData,DBM,CSV  Y  N  N  N  Y  Y* Y
  SQLite 3.3       N  N  N  N  Y  N  N
  MSAccess         N  N  N  N  Y  N  Y</pre>


<p style="margin-left:11%; margin-top: 1em">* Works only
because Example 0 works.</p>


<p style="margin-left:11%; margin-top: 1em"><small>DBI</small>
provides a sample perl script that will test the examples
above on your database engine and tell you which ones work.
It is located in the <i>ex/</i> subdirectory of the
<small>DBI</small> source distribution, or here:
&lt;http://svn.perl.org/modules/dbi/trunk/ex/perl_dbi_nulls_test.pl&gt;
Please use the script to help us fill-in and maintain this
table.</p>


<p style="margin-left:11%; margin-top: 1em"><b>Performance</b></p>

<p style="margin-left:11%; margin-top: 1em">Without using
placeholders, the insert statement shown previously would
have to contain the literal values to be inserted and would
have to be re-prepared and re-executed for each row. With
placeholders, the insert statement only needs to be prepared
once. The bind values for each row can be given to the
<tt>&quot;execute&quot;</tt> method each time it&rsquo;s
called. By avoiding the need to re-prepare the statement for
each row, the application typically runs many times faster.
Here&rsquo;s an example:</p>

<pre style="margin-left:11%; margin-top: 1em">  my $sth = $dbh&minus;&gt;prepare(q{
    INSERT INTO sales (product_code, qty, price) VALUES (?, ?, ?)
  }) or die $dbh&minus;&gt;errstr;
  while (&lt;&gt;) {
      chomp;
      my ($product_code, $qty, $price) = split /,/;
      $sth&minus;&gt;execute($product_code, $qty, $price) or die $dbh&minus;&gt;errstr;
  }
  $dbh&minus;&gt;commit or die $dbh&minus;&gt;errstr;</pre>


<p style="margin-left:11%; margin-top: 1em">See
&quot;execute&quot; and &quot;bind_param&quot; for more
details.</p>

<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;q{...}&quot;</tt> style quoting used in this
example avoids clashing with quotes that may be used in the
<small>SQL</small> statement. Use the double-quote like
<tt>&quot;qq{...}&quot;</tt> operator if you want to
interpolate variables into the string. See &quot;Quote and
Quote-like Operators&quot; in perlop for more details.</p>

<p style="margin-left:11%; margin-top: 1em">See also the
&quot;bind_columns&quot; method, which is used to associate
Perl variables with the output columns of a
<tt>&quot;SELECT&quot;</tt> statement.</p>

<h2>THE DBI PACKAGE AND CLASS
<a name="THE DBI PACKAGE AND CLASS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">In this
section, we cover the <small>DBI</small> class methods,
utility functions, and the dynamic attributes associated
with generic <small>DBI</small> handles.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>DBI</small>
Constants</b> <br>
Constants representing the values of the <small>SQL</small>
standard types can be imported individually by name, or all
together by importing the special
<tt>&quot;:sql_types&quot;</tt> tag.</p>

<p style="margin-left:11%; margin-top: 1em">The names and
values of all the defined <small>SQL</small> standard types
can be produced like this:</p>

<pre style="margin-left:11%; margin-top: 1em">  foreach (@{ $DBI::EXPORT_TAGS{sql_types} }) {
    printf &quot;%s=%d\n&quot;, $_, &amp;{&quot;DBI::$_&quot;};
  }</pre>


<p style="margin-left:11%; margin-top: 1em">These constants
are defined by <small>SQL/CLI, ODBC</small> or both.
<tt>&quot;SQL_BIGINT&quot;</tt> is (currently) omitted,
because <small>SQL/CLI</small> and <small>ODBC</small>
provide conflicting codes.</p>

<p style="margin-left:11%; margin-top: 1em">See the
&quot;type_info&quot;, &quot;type_info_all&quot;, and
&quot;bind_param&quot; methods for possible uses.</p>

<p style="margin-left:11%; margin-top: 1em">Note that just
because the <small>DBI</small> defines a named constant for
a given data type doesn&rsquo;t mean that drivers will
support that data type.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>DBI</small>
Class Methods</b> <br>
The following methods are provided by the <small>DBI</small>
class:</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;parse_dsn&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  ($scheme, $driver, $attr_string, $attr_hash, $driver_dsn) = DBI&minus;&gt;parse_dsn($dsn)
      or die &quot;Can't parse DBI DSN '$dsn'&quot;;</pre>


<p style="margin-left:11%; margin-top: 1em">Breaks apart a
<small>DBI</small> Data Source Name ( <small>DSN</small> )
and returns the individual parts. If <tt>$dsn</tt>
doesn&rsquo;t contain a valid <small>DSN</small> then
<i>parse_dsn()</i> returns an empty list.</p>


<p style="margin-left:11%; margin-top: 1em"><tt>$scheme</tt>
is the first part of the <small>DSN</small> and is currently
always &rsquo;dbi&rsquo;. <tt>$driver</tt> is the driver
name, possibly defaulted to <tt>$ENV</tt>{
<small>DBI_DRIVER</small> }, and may be undefined.
<tt>$attr_string</tt> is the contents of the optional
attribute string, which may be undefined. If
<tt>$attr_string</tt> is not empty then <tt>$attr_hash</tt>
is a reference to a hash containing the parsed attribute
names and values. <tt>$driver_dsn</tt> is the last part of
the <small>DBI DSN</small> string. For example:</p>

<pre style="margin-left:11%; margin-top: 1em">  ($scheme, $driver, $attr_string, $attr_hash, $driver_dsn)
      = DBI&minus;&gt;parse_dsn(&quot;DBI:MyDriver(RaiseError=&gt;1):db=test;port=42&quot;);
  $scheme      = 'dbi';
  $driver      = 'MyDriver';
  $attr_string = 'RaiseError=&gt;1';
  $attr_hash   = { 'RaiseError' =&gt; '1' };
  $driver_dsn  = 'db=test;port=42';</pre>


<p style="margin-left:11%; margin-top: 1em">The
<i>parse_dsn()</i> method was added in <small>DBI
1.43.</small></p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;connect&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  $dbh = DBI&minus;&gt;connect($data_source, $username, $password)
            or die $DBI::errstr;
  $dbh = DBI&minus;&gt;connect($data_source, $username, $password, \%attr)
            or die $DBI::errstr;</pre>


<p style="margin-left:11%; margin-top: 1em">Establishes a
database connection, or session, to the requested
<tt>$data_source</tt>. Returns a database handle object if
the connection succeeds. Use
<tt>&quot;$dbh&minus;&gt;disconnect&quot;</tt> to terminate
the connection.</p>

<p style="margin-left:11%; margin-top: 1em">If the connect
fails (see below), it returns <tt>&quot;undef&quot;</tt> and
sets both <tt>$DBI::err</tt> and <tt>$DBI::errstr</tt>. (It
does <i>not</i> explicitly set <tt>$!</tt>.) You should
generally test the return status of
<tt>&quot;connect&quot;</tt> and <tt>&quot;print
$DBI::errstr&quot;</tt> if it has failed.</p>

<p style="margin-left:11%; margin-top: 1em">Multiple
simultaneous connections to multiple databases through
multiple drivers can be made via the <small>DBI.</small>
Simply make one <tt>&quot;connect&quot;</tt> call for each
database and keep a copy of each returned database
handle.</p>

<p style="margin-left:11%; margin-top: 1em">The
<tt>$data_source</tt> value must begin with
&quot;<tt>&quot;dbi:&quot;</tt><i>driver_name</i><tt>&quot;:&quot;</tt>&quot;.
The <i>driver_name</i> specifies the driver that will be
used to make the connection. (Letter case is
significant.)</p>

<p style="margin-left:11%; margin-top: 1em">As a
convenience, if the <tt>$data_source</tt> parameter is
undefined or empty, the <small>DBI</small> will substitute
the value of the environment variable
<tt>&quot;DBI_DSN&quot;</tt>. If just the <i>driver_name</i>
part is empty (i.e., the <tt>$data_source</tt> prefix is
&quot;<tt>&quot;dbi::&quot;</tt>&quot;), the environment
variable <tt>&quot;DBI_DRIVER&quot;</tt> is used. If neither
variable is set, then <tt>&quot;connect&quot;</tt> dies.</p>

<p style="margin-left:11%; margin-top: 1em">Examples of
<tt>$data_source</tt> values are:</p>

<pre style="margin-left:11%; margin-top: 1em">  dbi:DriverName:database_name
  dbi:DriverName:database_name@hostname:port
  dbi:DriverName:database=database_name;host=hostname;port=port</pre>


<p style="margin-left:11%; margin-top: 1em">There is <i>no
standard</i> for the text following the driver name. Each
driver is free to use whatever syntax it wants. The only
requirement the <small>DBI</small> makes is that all the
information is supplied in a single string. You must consult
the documentation for the drivers you are using for a
description of the syntax they require.</p>

<p style="margin-left:11%; margin-top: 1em">It is
recommended that drivers support the <small>ODBC</small>
style, shown in the last example above. It is also
recommended that that they support the three common names
&rsquo;<tt>&quot;host&quot;</tt>&rsquo;,
&rsquo;<tt>&quot;port&quot;</tt>&rsquo;, and
&rsquo;<tt>&quot;database&quot;</tt>&rsquo; (plus
&rsquo;<tt>&quot;db&quot;</tt>&rsquo; as an alias for
<tt>&quot;database&quot;</tt>). This simplifies automatic
construction of basic DSNs:
<tt>&quot;dbi:$driver:database=$db;host=$host;port=$port&quot;</tt>.
Drivers should aim to &rsquo;do something reasonable&rsquo;
when given a <small>DSN</small> in this form, but if any
part is meaningless for that driver (such as
&rsquo;port&rsquo; for Informix) it should generate an error
if that part is not empty.</p>

<p style="margin-left:11%; margin-top: 1em">If the
environment variable <tt>&quot;DBI_AUTOPROXY&quot;</tt> is
defined (and the driver in <tt>$data_source</tt> is not
&quot;<tt>&quot;Proxy&quot;</tt>&quot;) then the connect
request will automatically be changed to:</p>

<pre style="margin-left:11%; margin-top: 1em">  $ENV{DBI_AUTOPROXY};dsn=$data_source</pre>



<p style="margin-left:11%; margin-top: 1em">&quot;DBI_AUTOPROXY&quot;
is typically set as
&quot;<tt>&quot;dbi:Proxy:hostname=...;port=...&quot;</tt>&quot;.
If <tt>$ENV</tt>{ <small>DBI_AUTOPROXY</small> }
doesn&rsquo;t begin with
&rsquo;<tt>&quot;dbi:&quot;</tt>&rsquo; then
&quot;dbi:Proxy:&quot; will be prepended to it first. See
the DBD::Proxy documentation for more details.</p>

<p style="margin-left:11%; margin-top: 1em">If
<tt>$username</tt> or <tt>$password</tt> are undefined
(rather than just empty), then the <small>DBI</small> will
substitute the values of the <tt>&quot;DBI_USER&quot;</tt>
and <tt>&quot;DBI_PASS&quot;</tt> environment variables,
respectively. The <small>DBI</small> will warn if the
environment variables are not defined. However, the everyday
use of these environment variables is not recommended for
security reasons. The mechanism is primarily intended to
simplify testing. See below for alternative way to specify
the username and password.</p>


<p style="margin-left:11%; margin-top: 1em"><tt>&quot;DBI&minus;&gt;connect&quot;</tt>
automatically installs the driver if it has not been
installed yet. Driver installation either returns a valid
driver handle, or it <i>dies</i> with an error message that
includes the string
&quot;<tt>&quot;install_driver&quot;</tt>&quot; and the
underlying problem. So
<tt>&quot;DBI&minus;&gt;connect&quot;</tt> will die on a
driver installation failure and will only return
<tt>&quot;undef&quot;</tt> on a connect failure, in which
case <tt>$DBI::errstr</tt> will hold the error message. Use
<tt>&quot;eval { ... }&quot;</tt> if you need to catch the
&quot;<tt>&quot;install_driver&quot;</tt>&quot; error.</p>

<p style="margin-left:11%; margin-top: 1em">The
<tt>$data_source</tt> argument (with the
&quot;<tt>&quot;dbi:...:&quot;</tt>&quot; prefix removed)
and the <tt>$username</tt> and <tt>$password</tt> arguments
are then passed to the driver for processing. The
<small>DBI</small> does not define any interpretation for
the contents of these fields. The driver is free to
interpret the <tt>$data_source</tt>, <tt>$username</tt>, and
<tt>$password</tt> fields in any way, and supply whatever
defaults are appropriate for the engine being accessed.
(Oracle, for example, uses the <small>ORACLE_SID</small> and
<small>TWO_TASK</small> environment variables if no
<tt>$data_source</tt> is specified.)</p>

<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;AutoCommit&quot;</tt> and
<tt>&quot;PrintError&quot;</tt> attributes for each
connection default to &quot;on&quot;. (See
&quot;AutoCommit&quot; and &quot;PrintError&quot; for more
information.) However, it is strongly recommended that you
explicitly define <tt>&quot;AutoCommit&quot;</tt> rather
than rely on the default. The <tt>&quot;PrintWarn&quot;</tt>
attribute defaults to on if $^W is true, i.e., perl is
running with warnings enabled.</p>

<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;\%attr&quot;</tt> parameter can be used to alter
the default settings of <tt>&quot;PrintError&quot;</tt>,
<tt>&quot;RaiseError&quot;</tt>,
<tt>&quot;AutoCommit&quot;</tt>, and other attributes. For
example:</p>

<pre style="margin-left:11%; margin-top: 1em">  $dbh = DBI&minus;&gt;connect($data_source, $user, $pass, {
        PrintError =&gt; 0,
        AutoCommit =&gt; 0
  });</pre>


<p style="margin-left:11%; margin-top: 1em">The username
and password can also be specified using the attributes
<tt>&quot;Username&quot;</tt> and
<tt>&quot;Password&quot;</tt>, in which case they take
precedence over the <tt>$username</tt> and
<tt>$password</tt> parameters.</p>

<p style="margin-left:11%; margin-top: 1em">You can also
define connection attribute values within the
<tt>$data_source</tt> parameter. For example:</p>

<pre style="margin-left:11%; margin-top: 1em">  dbi:DriverName(PrintWarn=&gt;1,PrintError=&gt;0,Taint=&gt;1):...</pre>


<p style="margin-left:11%; margin-top: 1em">Individual
attributes values specified in this way take precedence over
any conflicting values specified via the
<tt>&quot;\%attr&quot;</tt> parameter to
<tt>&quot;connect&quot;</tt>.</p>

<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;dbi_connect_method&quot;</tt> attribute can be
used to specify which driver method should be called to
establish the connection. The only useful values are
&rsquo;connect&rsquo;, &rsquo;connect_cached&rsquo;, or some
specialized case like &rsquo;Apache::DBI::connect&rsquo;
(which is automatically the default when running within
Apache).</p>

<p style="margin-left:11%; margin-top: 1em">Where possible,
each session (<tt>$dbh</tt>) is independent from the
transactions in other sessions. This is useful when you need
to hold cursors open across transactions--for example, if
you use one session for your long lifespan cursors
(typically read-only) and another for your short update
transactions.</p>

<p style="margin-left:11%; margin-top: 1em">For
compatibility with old <small>DBI</small> scripts, the
driver can be specified by passing its name as the fourth
argument to <tt>&quot;connect&quot;</tt> (instead of
<tt>&quot;\%attr&quot;</tt>):</p>

<pre style="margin-left:11%; margin-top: 1em">  $dbh = DBI&minus;&gt;connect($data_source, $user, $pass, $driver);</pre>


<p style="margin-left:11%; margin-top: 1em">In this
&quot;old-style&quot; form of <tt>&quot;connect&quot;</tt>,
the <tt>$data_source</tt> should not start with
&quot;<tt>&quot;dbi:driver_name:&quot;</tt>&quot;. (If it
does, the embedded driver_name will be ignored). Also note
that in this older form of <tt>&quot;connect&quot;</tt>, the
<tt>&quot;$dbh&minus;&gt;{AutoCommit}&quot;</tt> attribute
is <i>undefined</i>, the
<tt>&quot;$dbh&minus;&gt;{PrintError}&quot;</tt> attribute
is off, and the old <tt>&quot;DBI_DBNAME&quot;</tt>
environment variable is checked if
<tt>&quot;DBI_DSN&quot;</tt> is not defined. Beware that
this &quot;old-style&quot; <tt>&quot;connect&quot;</tt> will
soon be withdrawn in a future version of
<small>DBI.</small></p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;connect_cached&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  $dbh = DBI&minus;&gt;connect_cached($data_source, $username, $password)
            or die $DBI::errstr;
  $dbh = DBI&minus;&gt;connect_cached($data_source, $username, $password, \%attr)
            or die $DBI::errstr;</pre>



<p style="margin-left:11%; margin-top: 1em">&quot;connect_cached&quot;
is like &quot;connect&quot;, except that the database handle
returned is also stored in a hash associated with the given
parameters. If another call is made to
<tt>&quot;connect_cached&quot;</tt> with the same parameter
values, then the corresponding cached <tt>$dbh</tt> will be
returned if it is still valid. The cached database handle is
replaced with a new connection if it has been disconnected
or if the <tt>&quot;ping&quot;</tt> method fails.</p>

<p style="margin-left:11%; margin-top: 1em">Note that the
behaviour of this method differs in several respects from
the behaviour of persistent connections implemented by
Apache::DBI. However, if Apache::DBI is loaded then
<tt>&quot;connect_cached&quot;</tt> will use it.</p>

<p style="margin-left:11%; margin-top: 1em">Caching
connections can be useful in some applications, but it can
also cause problems, such as too many connections, and so
should be used with care. In particular, avoid changing the
attributes of a database handle created via
<i>connect_cached()</i> because it will affect other code
that may be using the same handle. When
<i>connect_cached()</i> returns a handle the attributes will
be reset to their initial values. This can cause problems,
especially with the <tt>&quot;AutoCommit&quot;</tt>
attribute.</p>

<p style="margin-left:11%; margin-top: 1em">Where multiple
separate parts of a program are using
<i>connect_cached()</i> to connect to the same database with
the same (initial) attributes it is a good idea to add a
private attribute to the <i>connect_cached()</i> call to
effectively limit the scope of the caching. For example:</p>

<pre style="margin-left:11%; margin-top: 1em">  DBI&minus;&gt;connect_cached(..., { private_foo_cachekey =&gt; &quot;Bar&quot;, ... });</pre>


<p style="margin-left:11%; margin-top: 1em">Handles
returned from that <i>connect_cached()</i> call will only be
returned by other <i>connect_cached()</i> call elsewhere in
the code if those other calls also pass in the same
attribute values, including the private one. (I&rsquo;ve
used <tt>&quot;private_foo_cachekey&quot;</tt> here as an
example, you can use any attribute name with a
<tt>&quot;private_&quot;</tt> prefix.)</p>

<p style="margin-left:11%; margin-top: 1em">Taking that one
step further, you can limit a particular
<i>connect_cached()</i> call to return handles unique to
that one place in the code by setting the private attribute
to a unique value for that place:</p>

<pre style="margin-left:11%; margin-top: 1em">  DBI&minus;&gt;connect_cached(..., { private_foo_cachekey =&gt; __FILE__.__LINE__, ... });</pre>


<p style="margin-left:11%; margin-top: 1em">By using a
private attribute you still get connection caching for the
individual calls to <i>connect_cached()</i> but, by making
separate database connections for separate parts of the
code, the database handles are isolated from any attribute
changes made to other handles.</p>

<p style="margin-left:11%; margin-top: 1em">The cache can
be accessed (and cleared) via the &quot;CachedKids&quot;
attribute:</p>

<pre style="margin-left:11%; margin-top: 1em">  my $CachedKids_hashref = $dbh&minus;&gt;{Driver}&minus;&gt;{CachedKids};
  %$CachedKids_hashref = () if $CachedKids_hashref;</pre>



<p style="margin-left:11%; margin-top: 1em"><i>&quot;available_drivers&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  @ary = DBI&minus;&gt;available_drivers;
  @ary = DBI&minus;&gt;available_drivers($quiet);</pre>


<p style="margin-left:11%; margin-top: 1em">Returns a list
of all available drivers by searching for
<tt>&quot;DBD::*&quot;</tt> modules through the directories
in <tt>@INC</tt>. By default, a warning is given if some
drivers are hidden by others of the same name in earlier
directories. Passing a true value for <tt>$quiet</tt> will
inhibit the warning.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;installed_drivers&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  %drivers = DBI&minus;&gt;installed_drivers();</pre>


<p style="margin-left:11%; margin-top: 1em">Returns a list
of driver name and driver handle pairs for all drivers
&rsquo;installed&rsquo; (loaded) into the current process.
The driver name does not include the &rsquo;
<small>DBD::</small> &rsquo; prefix.</p>

<p style="margin-left:11%; margin-top: 1em">To get a list
of all drivers available in your perl installation you can
use &quot;available_drivers&quot;.</p>

<p style="margin-left:11%; margin-top: 1em">Added in
<small>DBI 1.49.</small></p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;installed_versions&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  DBI&minus;&gt;installed_versions;
  @ary  = DBI&minus;&gt;installed_versions;
  $hash = DBI&minus;&gt;installed_versions;</pre>


<p style="margin-left:11%; margin-top: 1em">Calls
<i>available_drivers()</i> and attempts to load each of them
in turn using <i>install_driver()</i>. For each load that
succeeds the driver name and version number are added to a
hash. When running under DBI::PurePerl drivers which appear
not be pure-perl are ignored.</p>

<p style="margin-left:11%; margin-top: 1em">When called in
array context the list of successfully loaded drivers is
returned (without the &rsquo; <small>DBD::</small> &rsquo;
prefix).</p>

<p style="margin-left:11%; margin-top: 1em">When called in
scalar context an extra entry for the
<tt>&quot;DBI&quot;</tt> is added (and
<tt>&quot;DBI::PurePerl&quot;</tt> if appropriate) and a
reference to the hash is returned.</p>

<p style="margin-left:11%; margin-top: 1em">When called in
a void context the <i>installed_versions()</i> method will
print out a formatted list of the hash contents, one per
line, along with some other information about the
<small>DBI</small> version and <small>OS.</small></p>

<p style="margin-left:11%; margin-top: 1em">Due to the
potentially high memory cost and unknown risks of loading in
an unknown number of drivers that just happen to be
installed on the system, this method is not recommended for
general use. Use <i>available_drivers()</i> instead.</p>

<p style="margin-left:11%; margin-top: 1em">The
<i>installed_versions()</i> method is primarily intended as
a quick way to see from the command line what&rsquo;s
installed. For example:</p>

<pre style="margin-left:11%; margin-top: 1em">  perl &minus;MDBI &minus;e 'DBI&minus;&gt;installed_versions'</pre>


<p style="margin-left:11%; margin-top: 1em">The
<i>installed_versions()</i> method was added in <small>DBI
1.38.</small></p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;data_sources&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  @ary = DBI&minus;&gt;data_sources($driver);
  @ary = DBI&minus;&gt;data_sources($driver, \%attr);</pre>


<p style="margin-left:11%; margin-top: 1em">Returns a list
of data sources (databases) available via the named driver.
If <tt>$driver</tt> is empty or <tt>&quot;undef&quot;</tt>,
then the value of the <tt>&quot;DBI_DRIVER&quot;</tt>
environment variable is used.</p>

<p style="margin-left:11%; margin-top: 1em">The driver will
be loaded if it hasn&rsquo;t been already. Note that if the
driver loading fails then <i>data_sources() dies</i> with an
error message that includes the string
&quot;<tt>&quot;install_driver&quot;</tt>&quot; and the
underlying problem.</p>

<p style="margin-left:11%; margin-top: 1em">Data sources
are returned in a form suitable for passing to the
&quot;connect&quot; method (that is, they will include the
&quot;<tt>&quot;dbi:$driver:&quot;</tt>&quot; prefix).</p>

<p style="margin-left:11%; margin-top: 1em">Note that many
drivers have no way of knowing what data sources might be
available for it. These drivers return an empty or
incomplete list or may require driver-specific
attributes.</p>

<p style="margin-left:11%; margin-top: 1em">There is also a
<i>data_sources()</i> method defined for database
handles.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;trace&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  DBI&minus;&gt;trace($trace_setting)
  DBI&minus;&gt;trace($trace_setting, $trace_filename)
  DBI&minus;&gt;trace($trace_setting, $trace_filehandle)
  $trace_setting = DBI&minus;&gt;trace;</pre>


<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;DBI&minus;&gt;trace&quot;</tt> method sets the
<i>global default</i> trace settings and returns the
<i>previous</i> trace settings. It can also be used to
change where the trace output is sent.</p>

<p style="margin-left:11%; margin-top: 1em">There&rsquo;s a
similar method, <tt>&quot;$h&minus;&gt;trace&quot;</tt>,
which sets the trace settings for the specific handle
it&rsquo;s called on.</p>

<p style="margin-left:11%; margin-top: 1em">See the &quot;
<small>TRACING&quot;</small> section for full details about
the <small>DBI</small> &rsquo;s powerful tracing
facilities.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;visit_handles&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  DBI&minus;&gt;visit_handles( $coderef );
  DBI&minus;&gt;visit_handles( $coderef, $info );</pre>


<p style="margin-left:11%; margin-top: 1em">Where
<tt>$coderef</tt> is a reference to a subroutine and
<tt>$info</tt> is an arbitrary value which, if undefined,
defaults to a reference to an empty hash. Returns
<tt>$info</tt>.</p>

<p style="margin-left:11%; margin-top: 1em">For each
installed driver handle, if any, <tt>$coderef</tt> is
invoked as:</p>

<pre style="margin-left:11%; margin-top: 1em">  $coderef&minus;&gt;($driver_handle, $info);</pre>


<p style="margin-left:11%; margin-top: 1em">If the
execution of <tt>$coderef</tt> returns a true value then
&quot;visit_child_handles&quot; is called on that child
handle and passed the returned value as <tt>$info</tt>.</p>

<p style="margin-left:11%; margin-top: 1em">For
example:</p>

<pre style="margin-left:11%; margin-top: 1em">  my $info = $dbh&minus;&gt;{Driver}&minus;&gt;visit_child_handles(sub {
      my ($h, $info) = @_;
      ++$info&minus;&gt;{ $h&minus;&gt;{Type} }; # count types of handles (dr/db/st)
      return $info; # visit kids
  });</pre>


<p style="margin-left:11%; margin-top: 1em">See also
&quot;visit_child_handles&quot;.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>DBI</small>
Utility Functions</b> <br>
In addition to the <small>DBI</small> methods listed in the
previous section, the <small>DBI</small> package also
provides several utility functions.</p>

<p style="margin-left:11%; margin-top: 1em">These can be
imported into your code by listing them in the
<tt>&quot;use&quot;</tt> statement. For example:</p>

<pre style="margin-left:11%; margin-top: 1em">  use DBI qw(neat data_diff);</pre>


<p style="margin-left:11%; margin-top: 1em">Alternatively,
all these utility functions (except hash) can be imported
using the <tt>&quot;:utils&quot;</tt> import tag. For
example:</p>

<pre style="margin-left:11%; margin-top: 1em">  use DBI qw(:utils);</pre>



<p style="margin-left:11%; margin-top: 1em"><i>&quot;data_string_desc&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  $description = data_string_desc($string);</pre>


<p style="margin-left:11%; margin-top: 1em">Returns an
informal description of the string. For example:</p>

<pre style="margin-left:11%; margin-top: 1em">  UTF8 off, ASCII, 42 characters 42 bytes
  UTF8 off, non&minus;ASCII, 42 characters 42 bytes
  UTF8 on, non&minus;ASCII, 4 characters 6 bytes
  UTF8 on but INVALID encoding, non&minus;ASCII, 4 characters 6 bytes
  UTF8 off, undef</pre>


<p style="margin-left:11%; margin-top: 1em">The initial
<tt>&quot;UTF8&quot;</tt> on/off refers to Perl&rsquo;s
internal SvUTF8 flag. If <tt>$string</tt> has the SvUTF8
flag set but the sequence of bytes it contains are not a
valid <small>UTF&minus;8</small> encoding then
<i>data_string_desc()</i> will report <tt>&quot;UTF8 on but
INVALID encoding&quot;</tt>.</p>

<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;ASCII&quot;</tt> vs
<tt>&quot;non&minus;ASCII&quot;</tt> portion shows
<tt>&quot;ASCII&quot;</tt> if <i>all</i> the characters in
the string are <small>ASCII</small> (have code points &lt;=
127).</p>

<p style="margin-left:11%; margin-top: 1em">The
<i>data_string_desc()</i> function was added in <small>DBI
1.46.</small></p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;data_string_diff&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  $diff = data_string_diff($a, $b);</pre>


<p style="margin-left:11%; margin-top: 1em">Returns an
informal description of the first character difference
between the strings. If both <tt>$a</tt> and <tt>$b</tt>
contain the same sequence of characters then
<i>data_string_diff()</i> returns an empty string. For
example:</p>

<pre style="margin-left:11%; margin-top: 1em"> Params a &amp; b     Result
 &minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;     &minus;&minus;&minus;&minus;&minus;&minus;
 'aaa', 'aaa'     ''
 'aaa', 'abc'     'Strings differ at index 2: a[2]=a, b[2]=b'
 'aaa', undef     'String b is undef, string a has 3 characters'
 'aaa', 'aa'      'String b truncated after 2 characters'</pre>


<p style="margin-left:11%; margin-top: 1em">Unicode
characters are reported in <tt>&quot;\x{XXXX}&quot;</tt>
format. Unicode code points in the range U+0800 to U+08FF
are unassigned and most likely to occur due to
double-encoding. Characters in this range are reported as
<tt>&quot;\x{08XX}='C'&quot;</tt> where
<tt>&quot;C&quot;</tt> is the corresponding latin&minus;1
character.</p>

<p style="margin-left:11%; margin-top: 1em">The
<i>data_string_diff()</i> function only considers logical
<i>characters</i> and not the underlying encoding. See
&quot;data_diff&quot; for an alternative.</p>

<p style="margin-left:11%; margin-top: 1em">The
<i>data_string_diff()</i> function was added in <small>DBI
1.46.</small></p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;data_diff&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  $diff = data_diff($a, $b);
  $diff = data_diff($a, $b, $logical);</pre>


<p style="margin-left:11%; margin-top: 1em">Returns an
informal description of the difference between two strings.
It calls &quot;data_string_desc&quot; and
&quot;data_string_diff&quot; and returns the combined
results as a multi-line string.</p>

<p style="margin-left:11%; margin-top: 1em">For example,
<tt>&quot;data_diff(&quot;abc&quot;,
&quot;ab\x{263a}&quot;)&quot;</tt> will return:</p>

<pre style="margin-left:11%; margin-top: 1em">  a: UTF8 off, ASCII, 3 characters 3 bytes
  b: UTF8 on, non&minus;ASCII, 3 characters 5 bytes
  Strings differ at index 2: a[2]=c, b[2]=\x{263A}</pre>


<p style="margin-left:11%; margin-top: 1em">If <tt>$a</tt>
and <tt>$b</tt> are identical in both the characters they
contain <i>and</i> their physical encoding then
<i>data_diff()</i> returns an empty string. If
<tt>$logical</tt> is true then physical encoding differences
are ignored (but are still reported if there is a difference
in the characters).</p>

<p style="margin-left:11%; margin-top: 1em">The
<i>data_diff()</i> function was added in <small>DBI
1.46.</small></p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;neat&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  $str = neat($value);
  $str = neat($value, $maxlen);</pre>


<p style="margin-left:11%; margin-top: 1em">Return a string
containing a neat (and tidy) representation of the supplied
value.</p>

<p style="margin-left:11%; margin-top: 1em">Strings will be
quoted, although internal quotes will <i>not</i> be escaped.
Values known to be numeric will be unquoted. Undefined (
<small>NULL</small> ) values will be shown as
<tt>&quot;undef&quot;</tt> (without quotes).</p>

<p style="margin-left:11%; margin-top: 1em">If the string
is flagged internally as utf8 then double quotes will be
used, otherwise single quotes are used and unprintable
characters will be replaced by dot (.).</p>

<p style="margin-left:11%; margin-top: 1em">For result
strings longer than <tt>$maxlen</tt> the result string will
be truncated to <tt>&quot;$maxlen&minus;4&quot;</tt> and
&quot;<tt>&quot;...'&quot;</tt>&quot; will be appended. If
<tt>$maxlen</tt> is 0 or <tt>&quot;undef&quot;</tt>, it
defaults to <tt>$DBI::neat_maxlen</tt> which, in turn,
defaults to 400.</p>

<p style="margin-left:11%; margin-top: 1em">This function
is designed to format values for human consumption. It is
used internally by the <small>DBI</small> for
&quot;trace&quot; output. It should typically <i>not</i> be
used for formatting values for database use. (See also
&quot;quote&quot;.)</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;neat_list&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  $str = neat_list(\@listref, $maxlen, $field_sep);</pre>


<p style="margin-left:11%; margin-top: 1em">Calls
<tt>&quot;neat&quot;</tt> on each element of the list and
returns a string containing the results joined with
<tt>$field_sep</tt>. <tt>$field_sep</tt> defaults to
<tt>&quot;, &quot;</tt>.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;looks_like_number&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  @bool = looks_like_number(@array);</pre>


<p style="margin-left:11%; margin-top: 1em">Returns true
for each element that looks like a number. Returns false for
each element that does not look like a number. Returns
<tt>&quot;undef&quot;</tt> for each element that is
undefined or empty.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;hash&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  $hash_value = DBI::hash($buffer, $type);</pre>


<p style="margin-left:11%; margin-top: 1em">Return a
32&minus;bit integer &rsquo;hash&rsquo; value corresponding
to the contents of <tt>$buffer</tt>. The <tt>$type</tt>
parameter selects which kind of hash algorithm should be
used.</p>

<p style="margin-left:11%; margin-top: 1em">For the
technically curious, type 0 (which is the default if
<tt>$type</tt> isn&rsquo;t specified) is based on the Perl
5.1 hash except that the value is forced to be negative (for
obscure historical reasons). Type 1 is the better
&quot;Fowler / Noll / Vo&quot; ( <small>FNV</small> ) hash.
See &lt;http://www.isthe.com/chongo/tech/comp/fnv/&gt; for
more information. Both types are implemented in C and are
very fast.</p>

<p style="margin-left:11%; margin-top: 1em">This function
doesn&rsquo;t have much to do with databases, except that it
can be handy to store hash values in a database.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;sql_type_cast&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  $sts = DBI::sql_type_cast($sv, $sql_type, $flags);</pre>


<p style="margin-left:11%; margin-top: 1em">sql_type_cast
attempts to cast <tt>$sv</tt> to the <small>SQL</small> type
(see <small>DBI</small> Constants) specified in
<tt>$sql_type</tt>. At present only the <small>SQL</small>
types <tt>&quot;SQL_INTEGER&quot;</tt>,
<tt>&quot;SQL_DOUBLE&quot;</tt> and
<tt>&quot;SQL_NUMERIC&quot;</tt> are supported.</p>

<p style="margin-left:11%; margin-top: 1em">For
<tt>&quot;SQL_INTEGER&quot;</tt> the effect is similar to
using the value in an expression that requires an integer.
It gives the perl scalar an &rsquo;integer aspect&rsquo;.
(Technically the value gains an <small>IV,</small> or
possibly a <small>UV</small> or <small>NV</small> if the
value is too large for an <small>IV.</small> )</p>

<p style="margin-left:11%; margin-top: 1em">For
<tt>&quot;SQL_DOUBLE&quot;</tt> the effect is similar to
using the value in an expression that requires a general
numeric value. It gives the perl scalar a &rsquo;numeric
aspect&rsquo;. (Technically the value gains an
<small>NV.</small> )</p>


<p style="margin-left:11%; margin-top: 1em"><tt>&quot;SQL_NUMERIC&quot;</tt>
is similar to <tt>&quot;SQL_INTEGER&quot;</tt> or
<tt>&quot;SQL_DOUBLE&quot;</tt> but more general and more
cautious. It will look at the string first and if it looks
like an integer (that will fit in an <small>IV</small> or
<small>UV</small> ) it will act like
<tt>&quot;SQL_INTEGER&quot;</tt>, if it looks like a
floating point value it will act like
<tt>&quot;SQL_DOUBLE&quot;</tt>, if it looks like neither
then it will do nothing &minus; and thereby avoid the
warnings that would be generated by
<tt>&quot;SQL_INTEGER&quot;</tt> and
<tt>&quot;SQL_DOUBLE&quot;</tt> when given non-numeric
data.</p>


<p style="margin-left:11%; margin-top: 1em"><tt>$flags</tt>
may be: <br>
&quot;DBIstcf_DISCARD_STRING&quot;</p>

<p style="margin-left:17%;">If this flag is specified then
when the driver successfully casts the bound perl scalar to
a non-string type then the string portion of the scalar will
be discarded.</p>

<p style="margin-left:11%;">&quot;DBIstcf_STRICT&quot;</p>

<p style="margin-left:17%;">If <tt>$sv</tt> cannot be cast
to the requested <tt>$sql_type</tt> then by default it is
left untouched and no error is generated. If you specify
<tt>&quot;DBIstcf_STRICT&quot;</tt> and the cast fails, this
will generate an error.</p>

<p style="margin-left:11%; margin-top: 1em">The returned
<tt>$sts</tt> value is:</p>

<pre style="margin-left:11%; margin-top: 1em">  &minus;2 sql_type is not handled
  &minus;1 sv is undef so unchanged
   0 sv could not be cast cleanly and DBIstcf_STRICT was used
   1 sv could not be cast and DBIstcf_STRICT was not used
   2 sv was cast successfully</pre>


<p style="margin-left:11%; margin-top: 1em">This method is
exported by the :utils tag and was introduced in <small>DBI
1.611.</small></p>


<p style="margin-left:11%; margin-top: 1em"><small><b>DBI</b></small>
<b>Dynamic Attributes</b> <br>
Dynamic attributes are always associated with the <i>last
handle used</i> (that handle is represented by <tt>$h</tt>
in the descriptions below).</p>

<p style="margin-left:11%; margin-top: 1em">Where an
attribute is equivalent to a method call, then refer to the
method call for all related documentation.</p>

<p style="margin-left:11%; margin-top: 1em">Warning: these
attributes are provided as a convenience but they do have
limitations. Specifically, they have a short lifespan:
because they are associated with the last handle used, they
should only be used <i>immediately</i> after calling the
method that &quot;sets&quot; them. If in any doubt, use the
corresponding method call.</p>


<p style="margin-left:11%; margin-top: 1em"><i>$DBI::err</i></p>

<p style="margin-left:11%; margin-top: 1em">Equivalent to
<tt>&quot;$h&minus;&gt;err&quot;</tt>.</p>


<p style="margin-left:11%; margin-top: 1em"><i>$DBI::errstr</i></p>

<p style="margin-left:11%; margin-top: 1em">Equivalent to
<tt>&quot;$h&minus;&gt;errstr&quot;</tt>.</p>


<p style="margin-left:11%; margin-top: 1em"><i>$DBI::state</i></p>

<p style="margin-left:11%; margin-top: 1em">Equivalent to
<tt>&quot;$h&minus;&gt;state&quot;</tt>.</p>


<p style="margin-left:11%; margin-top: 1em"><i>$DBI::rows</i></p>

<p style="margin-left:11%; margin-top: 1em">Equivalent to
<tt>&quot;$h&minus;&gt;rows&quot;</tt>. Please refer to the
documentation for the &quot;rows&quot; method.</p>


<p style="margin-left:11%; margin-top: 1em"><i>$DBI::lasth</i></p>

<p style="margin-left:11%; margin-top: 1em">Returns the
<small>DBI</small> object handle used for the most recent
<small>DBI</small> method call. If the last
<small>DBI</small> method call was a <small>DESTROY</small>
then <tt>$DBI::lasth</tt> will return the handle of the
parent of the destroyed handle, if there is one.</p>

<h2>METHODS COMMON TO ALL HANDLES
<a name="METHODS COMMON TO ALL HANDLES"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The following
methods can be used by all types of <small>DBI</small>
handles.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;err&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  $rv = $h&minus;&gt;err;</pre>


<p style="margin-left:11%; margin-top: 1em">Returns the
<i>native</i> database engine error code from the last
driver method called. The code is typically an integer but
you should not assume that.</p>

<p style="margin-left:11%; margin-top: 1em">The
<small>DBI</small> resets <tt>$h</tt>&minus;&gt;err to undef
before almost all <small>DBI</small> method calls, so the
value only has a short lifespan. Also, for most drivers, the
statement handles share the same error variable as the
parent database handle, so calling a method on one handle
may reset the error on the related handles.</p>

<p style="margin-left:11%; margin-top: 1em">(Methods which
don&rsquo;t reset err before being called include
<i>err()</i> and <i>errstr()</i>, obviously, <i>state()</i>,
<i>rows()</i>, <i>func()</i>, <i>trace()</i>,
<i>trace_msg()</i>, <i>ping()</i>, and the tied hash
attribute <i><small>FETCH</small> ()</i> and
<i><small>STORE</small> ()</i> methods.)</p>

<p style="margin-left:11%; margin-top: 1em">If you need to
test for specific error conditions <i>and</i> have your
program be portable to different database engines, then
you&rsquo;ll need to determine what the corresponding error
codes are for all those engines and test for all of
them.</p>

<p style="margin-left:11%; margin-top: 1em">The
<small>DBI</small> uses the value of <tt>$DBI::stderr</tt>
as the <tt>&quot;err&quot;</tt> value for internal errors.
Drivers should also do likewise. The default value for
<tt>$DBI::stderr</tt> is 2000000000.</p>

<p style="margin-left:11%; margin-top: 1em">A driver may
return <tt>0</tt> from <i>err()</i> to indicate a warning
condition after a method call. Similarly, a driver may
return an empty string to indicate a &rsquo;success with
information&rsquo; condition. In both these cases the value
is false but not undef. The <i>errstr()</i> and
<i>state()</i> methods may be used to retrieve extra
information in these cases.</p>

<p style="margin-left:11%; margin-top: 1em">See
&quot;set_err&quot; for more information.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;errstr&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  $str = $h&minus;&gt;errstr;</pre>


<p style="margin-left:11%; margin-top: 1em">Returns the
native database engine error message from the last
<small>DBI</small> method called. This has the same lifespan
issues as the &quot;err&quot; method described above.</p>

<p style="margin-left:11%; margin-top: 1em">The returned
string may contain multiple messages separated by newline
characters.</p>

<p style="margin-left:11%; margin-top: 1em">The
<i>errstr()</i> method should not be used to test for
errors, use <i>err()</i> for that, because drivers may
return &rsquo;success with information&rsquo; or warning
messages via <i>errstr()</i> for methods that have not
&rsquo;failed&rsquo;.</p>

<p style="margin-left:11%; margin-top: 1em">See
&quot;set_err&quot; for more information.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;state&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  $str = $h&minus;&gt;state;</pre>


<p style="margin-left:11%; margin-top: 1em">Returns a state
code in the standard <small>SQLSTATE</small> five character
format. Note that the specific success code <tt>00000</tt>
is translated to any empty string (false). If the driver
does not support <small>SQLSTATE</small> (and most
don&rsquo;t), then <i>state()</i> will return
<tt>&quot;S1000&quot;</tt> (General Error) for all
errors.</p>

<p style="margin-left:11%; margin-top: 1em">The driver is
free to return any value via <tt>&quot;state&quot;</tt>,
e.g., warning codes, even if it has not declared an error by
returning a true value via the &quot;err&quot; method
described above.</p>

<p style="margin-left:11%; margin-top: 1em">The
<i>state()</i> method should not be used to test for errors,
use <i>err()</i> for that, because drivers may return a
&rsquo;success with information&rsquo; or warning state code
via <i>state()</i> for methods that have not
&rsquo;failed&rsquo;.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;set_err&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  $rv = $h&minus;&gt;set_err($err, $errstr);
  $rv = $h&minus;&gt;set_err($err, $errstr, $state);
  $rv = $h&minus;&gt;set_err($err, $errstr, $state, $method);
  $rv = $h&minus;&gt;set_err($err, $errstr, $state, $method, $rv);</pre>


<p style="margin-left:11%; margin-top: 1em">Set the
<tt>&quot;err&quot;</tt>, <tt>&quot;errstr&quot;</tt>, and
<tt>&quot;state&quot;</tt> values for the handle. This
method is typically only used by <small>DBI</small> drivers
and <small>DBI</small> subclasses.</p>

<p style="margin-left:11%; margin-top: 1em">If the
&quot;HandleSetErr&quot; attribute holds a reference to a
subroutine it is called first. The subroutine can alter the
<tt>$err</tt>, <tt>$errstr</tt>, <tt>$state</tt>, and
<tt>$method</tt> values. See &quot;HandleSetErr&quot; for
full details. If the subroutine returns a true value then
the handle <tt>&quot;err&quot;</tt>,
<tt>&quot;errstr&quot;</tt>, and <tt>&quot;state&quot;</tt>
values are not altered and <i>set_err()</i> returns an empty
list (it normally returns <tt>$rv</tt> which defaults to
undef, see below).</p>

<p style="margin-left:11%; margin-top: 1em">Setting
<tt>&quot;err&quot;</tt> to a <i>true</i> value indicates an
error and will trigger the normal <small>DBI</small> error
handling mechanisms, such as <tt>&quot;RaiseError&quot;</tt>
and <tt>&quot;HandleError&quot;</tt>, if they are enabled,
when execution returns from the <small>DBI</small> back to
the application.</p>

<p style="margin-left:11%; margin-top: 1em">Setting
<tt>&quot;err&quot;</tt> to <tt>&quot;&quot;</tt> indicates
an &rsquo;information&rsquo; state, and setting it to
<tt>&quot;0&quot;</tt> indicates a &rsquo;warning&rsquo;
state. Setting <tt>&quot;err&quot;</tt> to
<tt>&quot;undef&quot;</tt> also sets
<tt>&quot;errstr&quot;</tt> to undef, and
<tt>&quot;state&quot;</tt> to <tt>&quot;&quot;</tt>,
irrespective of the values of the <tt>$errstr</tt> and
<tt>$state</tt> parameters.</p>

<p style="margin-left:11%; margin-top: 1em">The
<tt>$method</tt> parameter provides an alternate method name
for the
<tt>&quot;RaiseError&quot;</tt>/<tt>&quot;PrintError&quot;</tt>/<tt>&quot;PrintWarn&quot;</tt>
error string instead of the fairly unhelpful
&rsquo;<tt>&quot;set_err&quot;</tt>&rsquo;.</p>

<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;set_err&quot;</tt> method normally returns undef.
The <tt>$rv</tt> parameter provides an alternate return
value.</p>

<p style="margin-left:11%; margin-top: 1em">Some special
rules apply if the <tt>&quot;err&quot;</tt> or
<tt>&quot;errstr&quot;</tt> values for the handle are
<i>already</i> set...</p>

<p style="margin-left:11%; margin-top: 1em">If
<tt>&quot;errstr&quot;</tt> is true then: &quot;<tt>&quot;
[err was %s now %s]&quot;</tt>&quot; is appended if
<tt>$err</tt> is true and <tt>&quot;err&quot;</tt> is
already true and the new err value differs from the original
one. Similarly &quot;<tt>&quot; [state was %s now
%s]&quot;</tt>&quot; is appended if <tt>$state</tt> is true
and <tt>&quot;state&quot;</tt> is already true and the new
state value differs from the original one. Finally
&quot;<tt>&quot;\n&quot;</tt>&quot; and the new
<tt>$errstr</tt> are appended if <tt>$errstr</tt> differs
from the existing errstr value. Obviously the
<tt>%s</tt>&rsquo;s above are replaced by the corresponding
values.</p>

<p style="margin-left:11%; margin-top: 1em">The handle
<tt>&quot;err&quot;</tt> value is set to <tt>$err</tt> if:
<tt>$err</tt> is true; or handle <tt>&quot;err&quot;</tt>
value is undef; or <tt>$err</tt> is defined and the length
is greater than the handle <tt>&quot;err&quot;</tt> length.
The effect is that an &rsquo;information&rsquo; state only
overrides undef; a &rsquo;warning&rsquo; overrides undef or
&rsquo;information&rsquo;, and an &rsquo;error&rsquo; state
overrides anything.</p>

<p style="margin-left:11%; margin-top: 1em">The handle
<tt>&quot;state&quot;</tt> value is set to <tt>$state</tt>
if <tt>$state</tt> is true and the handle
<tt>&quot;err&quot;</tt> value was set (by the rules
above).</p>

<p style="margin-left:11%; margin-top: 1em">Support for
warning and information states was added in <small>DBI
1.41.</small></p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;trace&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  $h&minus;&gt;trace($trace_settings);
  $h&minus;&gt;trace($trace_settings, $trace_filename);
  $trace_settings = $h&minus;&gt;trace;</pre>


<p style="margin-left:11%; margin-top: 1em">The
<i>trace()</i> method is used to alter the trace settings
for a handle (and any future children of that handle). It
can also be used to change where the trace output is
sent.</p>

<p style="margin-left:11%; margin-top: 1em">There&rsquo;s a
similar method, <tt>&quot;DBI&minus;&gt;trace&quot;</tt>,
which sets the global default trace settings.</p>

<p style="margin-left:11%; margin-top: 1em">See the &quot;
<small>TRACING&quot;</small> section for full details about
the <small>DBI</small> &rsquo;s powerful tracing
facilities.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;trace_msg&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  $h&minus;&gt;trace_msg($message_text);
  $h&minus;&gt;trace_msg($message_text, $min_level);</pre>


<p style="margin-left:11%; margin-top: 1em">Writes
<tt>$message_text</tt> to the trace file if the trace level
is greater than or equal to <tt>$min_level</tt> (which
defaults to 1). Can also be called as
<tt>&quot;DBI&minus;&gt;trace_msg($msg)&quot;</tt>.</p>

<p style="margin-left:11%; margin-top: 1em">See &quot;
<small>TRACING&quot;</small> for more details.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;func&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  $h&minus;&gt;func(@func_arguments, $func_name) or die ...;</pre>


<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;func&quot;</tt> method can be used to call private
non-standard and non-portable methods implemented by the
driver. Note that the function name is given as the
<i>last</i> argument.</p>

<p style="margin-left:11%; margin-top: 1em">It&rsquo;s also
important to note that the <i>func()</i> method does not
clear a previous error ($DBI::err etc.) and it does not
trigger automatic error detection (RaiseError etc.) so you
must check the return status and/or
<tt>$h</tt>&minus;&gt;err to detect errors.</p>

<p style="margin-left:11%; margin-top: 1em">(This method is
not directly related to calling stored procedures. Calling
stored procedures is currently not defined by the
<small>DBI.</small> Some drivers, such as DBD::Oracle,
support it in non-portable ways. See driver documentation
for more details.)</p>

<p style="margin-left:11%; margin-top: 1em">See also
<i>install_method()</i> in <small>DBI::DBD</small> for how
you can avoid needing to use <i>func()</i> and gain direct
access to driver-private methods.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;can&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  $is_implemented = $h&minus;&gt;can($method_name);</pre>


<p style="margin-left:11%; margin-top: 1em">Returns true if
<tt>$method_name</tt> is implemented by the driver or a
default method is provided by the <small>DBI</small>
&rsquo;s driver base class. It returns false where a driver
hasn&rsquo;t implemented a method and the default method is
provided by the <small>DBI</small> &rsquo;s driver base
class is just an empty stub.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;parse_trace_flags&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  $trace_settings_integer = $h&minus;&gt;parse_trace_flags($trace_settings);</pre>


<p style="margin-left:11%; margin-top: 1em">Parses a string
containing trace settings and returns the corresponding
integer value used internally by the <small>DBI</small> and
drivers.</p>

<p style="margin-left:11%; margin-top: 1em">The
<tt>$trace_settings</tt> argument is a string containing a
trace level between 0 and 15 and/or trace flag names
separated by vertical bar
(&quot;<tt>&quot;|&quot;</tt>&quot;) or comma
(&quot;<tt>&quot;,&quot;</tt>&quot;) characters. For
example: <tt>&quot;SQL|3|foo&quot;</tt>.</p>

<p style="margin-left:11%; margin-top: 1em">It uses the
<i>parse_trace_flag()</i> method, described below, to
process the individual trace flag names.</p>

<p style="margin-left:11%; margin-top: 1em">The
<i>parse_trace_flags()</i> method was added in <small>DBI
1.42.</small></p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;parse_trace_flag&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  $bit_flag = $h&minus;&gt;parse_trace_flag($trace_flag_name);</pre>


<p style="margin-left:11%; margin-top: 1em">Returns the bit
flag corresponding to the trace flag name in
<tt>$trace_flag_name</tt>. Drivers are expected to override
this method and check if <tt>$trace_flag_name</tt> is a
driver specific trace flags and, if not, then call the
<small>DBI</small> &rsquo;s default
<i>parse_trace_flag()</i>.</p>

<p style="margin-left:11%; margin-top: 1em">The
<i>parse_trace_flag()</i> method was added in <small>DBI
1.42.</small></p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;private_attribute_info&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  $hash_ref = $h&minus;&gt;private_attribute_info();</pre>


<p style="margin-left:11%; margin-top: 1em">Returns a
reference to a hash whose keys are the names of
driver-private handle attributes available for the kind of
handle (driver, database, statement) that the method was
called on.</p>

<p style="margin-left:11%; margin-top: 1em">For example,
the return value when called with a DBD::Sybase
<tt>$dbh</tt> could look like this:</p>

<pre style="margin-left:11%; margin-top: 1em">  {
      syb_dynamic_supported =&gt; undef,
      syb_oc_version =&gt; undef,
      syb_server_version =&gt; undef,
      syb_server_version_string =&gt; undef,
  }</pre>


<p style="margin-left:11%; margin-top: 1em">and when called
with a DBD::Sybase <tt>$sth</tt> they could look like
this:</p>

<pre style="margin-left:11%; margin-top: 1em">  {
      syb_types =&gt; undef,
      syb_proc_status =&gt; undef,
      syb_result_type =&gt; undef,
  }</pre>


<p style="margin-left:11%; margin-top: 1em">The values
should be undef. Meanings may be assigned to particular
values in future.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;swap_inner_handle&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  $rc = $h1&minus;&gt;swap_inner_handle( $h2 );
  $rc = $h1&minus;&gt;swap_inner_handle( $h2, $allow_reparent );</pre>


<p style="margin-left:11%; margin-top: 1em">Brain
transplants for handles. You don&rsquo;t need to know about
this unless you want to become a handle surgeon.</p>

<p style="margin-left:11%; margin-top: 1em">A
<small>DBI</small> handle is a reference to a tied hash. A
tied hash has an <i>inner</i> hash that actually holds the
contents. The <i>swap_inner_handle()</i> method swaps the
inner hashes between two handles. The <tt>$h1</tt> and
<tt>$h2</tt> handles still point to the same tied hashes,
but what those hashes are tied to has been swapped. In
effect <tt>$h1</tt> <i>becomes</i> <tt>$h2</tt> and
vice-versa. This is powerful stuff, expect problems. Use
with care.</p>

<p style="margin-left:11%; margin-top: 1em">As a small
safety measure, the two handles, <tt>$h1</tt> and
<tt>$h2</tt>, have to share the same parent unless
<tt>$allow_reparent</tt> is true.</p>

<p style="margin-left:11%; margin-top: 1em">The
<i>swap_inner_handle()</i> method was added in <small>DBI
1.44.</small></p>

<p style="margin-left:11%; margin-top: 1em">Here&rsquo;s a
quick kind of &rsquo;diagram&rsquo; as a worked example to
help think about what&rsquo;s happening:</p>

<pre style="margin-left:11%; margin-top: 1em">    Original state:
            dbh1o &minus;&gt; dbh1i
            sthAo &minus;&gt; sthAi(dbh1i)
            dbh2o &minus;&gt; dbh2i
    swap_inner_handle dbh1o with dbh2o:
            dbh2o &minus;&gt; dbh1i
            sthAo &minus;&gt; sthAi(dbh1i)
            dbh1o &minus;&gt; dbh2i
    create new sth from dbh1o:
            dbh2o &minus;&gt; dbh1i
            sthAo &minus;&gt; sthAi(dbh1i)
            dbh1o &minus;&gt; dbh2i
            sthBo &minus;&gt; sthBi(dbh2i)
    swap_inner_handle sthAo with sthBo:
            dbh2o &minus;&gt; dbh1i
            sthBo &minus;&gt; sthAi(dbh1i)
            dbh1o &minus;&gt; dbh2i
            sthAo &minus;&gt; sthBi(dbh2i)</pre>



<p style="margin-left:11%; margin-top: 1em"><i>&quot;visit_child_handles&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  $h&minus;&gt;visit_child_handles( $coderef );
  $h&minus;&gt;visit_child_handles( $coderef, $info );</pre>


<p style="margin-left:11%; margin-top: 1em">Where
<tt>$coderef</tt> is a reference to a subroutine and
<tt>$info</tt> is an arbitrary value which, if undefined,
defaults to a reference to an empty hash. Returns
<tt>$info</tt>.</p>

<p style="margin-left:11%; margin-top: 1em">For each child
handle of <tt>$h</tt>, if any, <tt>$coderef</tt> is invoked
as:</p>

<pre style="margin-left:11%; margin-top: 1em">  $coderef&minus;&gt;($child_handle, $info);</pre>


<p style="margin-left:11%; margin-top: 1em">If the
execution of <tt>$coderef</tt> returns a true value then
<tt>&quot;visit_child_handles&quot;</tt> is called on that
child handle and passed the returned value as
<tt>$info</tt>.</p>

<p style="margin-left:11%; margin-top: 1em">For
example:</p>

<pre style="margin-left:11%; margin-top: 1em">  # count database connections with names (DSN) matching a pattern
  my $connections = 0;
  $dbh&minus;&gt;{Driver}&minus;&gt;visit_child_handles(sub {
      my ($h, $info) = @_;
      ++$connections if $h&minus;&gt;{Name} =~ /foo/;
      return 0; # don't visit kids
  })</pre>


<p style="margin-left:11%; margin-top: 1em">See also
&quot;visit_handles&quot;.</p>

<h2>ATTRIBUTES COMMON TO ALL HANDLES
<a name="ATTRIBUTES COMMON TO ALL HANDLES"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">These
attributes are common to all types of <small>DBI</small>
handles.</p>

<p style="margin-left:11%; margin-top: 1em">Some attributes
are inherited by child handles. That is, the value of an
inherited attribute in a newly created statement handle is
the same as the value in the parent database handle. Changes
to attributes in the new statement handle do not affect the
parent database handle and changes to the database handle do
not affect existing statement handles, only future ones.</p>

<p style="margin-left:11%; margin-top: 1em">Attempting to
set or get the value of an unknown attribute generates a
warning, except for private driver specific attributes
(which all have names starting with a lowercase letter).</p>

<p style="margin-left:11%; margin-top: 1em">Example:</p>

<pre style="margin-left:11%; margin-top: 1em">  $h&minus;&gt;{AttributeName} = ...;    # set/write
  ... = $h&minus;&gt;{AttributeName};    # get/read</pre>



<p style="margin-left:11%; margin-top: 1em"><i>&quot;Warn&quot;</i></p>

<p style="margin-left:11%; margin-top: 1em">Type: boolean,
inherited</p>

<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;Warn&quot;</tt> attribute enables useful warnings
for certain bad practices. It is enabled by default and
should only be disabled in rare circumstances. Since
warnings are generated using the Perl
<tt>&quot;warn&quot;</tt> function, they can be intercepted
using the Perl <tt>$SIG{__WARN__}</tt> hook.</p>

<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;Warn&quot;</tt> attribute is not related to the
<tt>&quot;PrintWarn&quot;</tt> attribute.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;Active&quot;</i></p>

<p style="margin-left:11%; margin-top: 1em">Type: boolean,
read-only</p>

<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;Active&quot;</tt> attribute is true if the handle
object is &quot;active&quot;. This is rarely used in
applications. The exact meaning of active is somewhat vague
at the moment. For a database handle it typically means that
the handle is connected to a database
(<tt>&quot;$dbh&minus;&gt;disconnect&quot;</tt> sets
<tt>&quot;Active&quot;</tt> off). For a statement handle it
typically means that the handle is a
<tt>&quot;SELECT&quot;</tt> that may have more data to
fetch. (Fetching all the data or calling
<tt>&quot;$sth&minus;&gt;finish&quot;</tt> sets
<tt>&quot;Active&quot;</tt> off.)</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;Executed&quot;</i></p>

<p style="margin-left:11%; margin-top: 1em">Type:
boolean</p>

<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;Executed&quot;</tt> attribute is true if the
handle object has been &quot;executed&quot;. Currently only
the <tt>$dbh</tt> <i>do()</i> method and the <tt>$sth</tt>
<i>execute()</i>, <i>execute_array()</i>, and
<i>execute_for_fetch()</i> methods set the
<tt>&quot;Executed&quot;</tt> attribute.</p>

<p style="margin-left:11%; margin-top: 1em">When it&rsquo;s
set on a handle it is also set on the parent handle at the
same time. So calling <i>execute()</i> on a <tt>$sth</tt>
also sets the <tt>&quot;Executed&quot;</tt> attribute on the
parent <tt>$dbh</tt>.</p>

<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;Executed&quot;</tt> attribute for a database
handle is cleared by the <i>commit()</i> and
<i>rollback()</i> methods (even if they fail). The
<tt>&quot;Executed&quot;</tt> attribute of a statement
handle is not cleared by the <small>DBI</small> under any
circumstances and so acts as a permanent record of whether
the statement handle was ever used.</p>

<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;Executed&quot;</tt> attribute was added in
<small>DBI 1.41.</small></p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;Kids&quot;</i></p>

<p style="margin-left:11%; margin-top: 1em">Type: integer,
read-only</p>

<p style="margin-left:11%; margin-top: 1em">For a driver
handle, <tt>&quot;Kids&quot;</tt> is the number of currently
existing database handles that were created from that driver
handle. For a database handle, <tt>&quot;Kids&quot;</tt> is
the number of currently existing statement handles that were
created from that database handle. For a statement handle,
the value is zero.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;ActiveKids&quot;</i></p>

<p style="margin-left:11%; margin-top: 1em">Type: integer,
read-only</p>

<p style="margin-left:11%; margin-top: 1em">Like
<tt>&quot;Kids&quot;</tt>, but only counting those that are
<tt>&quot;Active&quot;</tt> (as above).</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;CachedKids&quot;</i></p>

<p style="margin-left:11%; margin-top: 1em">Type: hash
ref</p>

<p style="margin-left:11%; margin-top: 1em">For a database
handle, <tt>&quot;CachedKids&quot;</tt> returns a reference
to the cache (hash) of statement handles created by the
&quot;prepare_cached&quot; method. For a driver handle,
returns a reference to the cache (hash) of database handles
created by the &quot;connect_cached&quot; method.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;Type&quot;</i></p>

<p style="margin-left:11%; margin-top: 1em">Type: scalar,
read-only</p>

<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;Type&quot;</tt> attribute identifies the type of a
<small>DBI</small> handle. Returns &quot;dr&quot; for driver
handles, &quot;db&quot; for database handles and
&quot;st&quot; for statement handles.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;ChildHandles&quot;</i></p>

<p style="margin-left:11%; margin-top: 1em">Type: array
ref</p>

<p style="margin-left:11%; margin-top: 1em">The
ChildHandles attribute contains a reference to an array of
all the handles created by this handle which are still
accessible. The contents of the array are weak-refs and will
become undef when the handle goes out of scope.</p>


<p style="margin-left:11%; margin-top: 1em"><tt>&quot;ChildHandles&quot;</tt>
returns undef if your perl version does not support weak
references (check the Scalar::Util module). The referenced
array returned should be treated as read-only.</p>

<p style="margin-left:11%; margin-top: 1em">For example, to
enumerate all driver handles, database handles and statement
handles:</p>

<pre style="margin-left:11%; margin-top: 1em">    sub show_child_handles {
        my ($h, $level) = @_;
        printf &quot;%sh %s %s\n&quot;, $h&minus;&gt;{Type}, &quot;\t&quot; x $level, $h;
        show_child_handles($_, $level + 1)
            for (grep { defined } @{$h&minus;&gt;{ChildHandles}});
    }
    my %drivers = DBI&minus;&gt;installed_drivers();
    show_child_handles($_, 0) for (values %drivers);</pre>



<p style="margin-left:11%; margin-top: 1em"><i>&quot;CompatMode&quot;</i></p>

<p style="margin-left:11%; margin-top: 1em">Type: boolean,
inherited</p>

<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;CompatMode&quot;</tt> attribute is used by
emulation layers (such as Oraperl) to enable compatible
behaviour in the underlying driver (e.g., DBD::Oracle) for
this handle. Not normally set by application code.</p>

<p style="margin-left:11%; margin-top: 1em">It also has the
effect of disabling the &rsquo;quick <small>FETCH</small>
&rsquo; of attribute values from the handles attribute
cache. So all attribute values are handled by the drivers
own <small>FETCH</small> method. This makes them slightly
slower but is useful for special-purpose drivers like
DBD::Multiplex.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;InactiveDestroy&quot;</i></p>

<p style="margin-left:11%; margin-top: 1em">Type:
boolean</p>

<p style="margin-left:11%; margin-top: 1em">The default
value, false, means a handle will be fully destroyed as
normal when the last reference to it is removed, just as
you&rsquo;d expect.</p>

<p style="margin-left:11%; margin-top: 1em">If set true
then the handle will be treated by the
<small>DESTROY</small> as if it was no longer Active, and so
the <i>database engine</i> related effects of DESTROYing a
handle will be skipped. Think of the name as meaning
&rsquo;treat the handle as not-Active in the
<small>DESTROY</small> method&rsquo;.</p>

<p style="margin-left:11%; margin-top: 1em">For a database
handle, this attribute does not disable an <i>explicit</i>
call to the disconnect method, only the implicit call from
<small>DESTROY</small> that happens if the handle is still
marked as <tt>&quot;Active&quot;</tt>.</p>

<p style="margin-left:11%; margin-top: 1em">This attribute
is specifically designed for use in Unix applications that
&quot;fork&quot; child processes. For some drivers, when the
child process exits the destruction of inherited handles
cause the corresponding handles in the parent process to
cease working.</p>

<p style="margin-left:11%; margin-top: 1em">Either the
parent or the child process, but not both, should set
<tt>&quot;InactiveDestroy&quot;</tt> true on all their
shared handles. Alternatively the
&quot;AutoInactiveDestroy&quot; can be set in the parent on
connect.</p>

<p style="margin-left:11%; margin-top: 1em">To help tracing
applications using fork the process id is shown in the trace
log whenever a <small>DBI</small> or handle <i>trace()</i>
method is called. The process id also shown for <i>every</i>
method call if the <small>DBI</small> trace level (not
handle trace level) is set high enough to show the trace
from the <small>DBI</small> &rsquo;s method dispatcher, e.g.
&gt;= 9.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;AutoInactiveDestroy&quot;</i></p>

<p style="margin-left:11%; margin-top: 1em">Type: boolean,
inherited</p>

<p style="margin-left:11%; margin-top: 1em">The
&quot;InactiveDestroy&quot; attribute, described above,
needs to be explicitly set in the child process after a
<i>fork()</i>. This is a problem if the code that performs
the <i>fork()</i> is not under your control, perhaps in a
third-party module. Use
<tt>&quot;AutoInactiveDestroy&quot;</tt> to get around this
situation.</p>

<p style="margin-left:11%; margin-top: 1em">If set true,
the <small>DESTROY</small> method will check the process id
of the handle and, if different from the current process id,
it will set the <i>InactiveDestroy</i> attribute.</p>

<p style="margin-left:11%; margin-top: 1em">This is the
example it&rsquo;s designed to deal with:</p>

<pre style="margin-left:11%; margin-top: 1em">    my $dbh = DBI&minus;&gt;connect(...);
    some_code_that_forks(); # Perhaps without your knowledge
    # Child process dies, destroying the inherited dbh
    $dbh&minus;&gt;do(...); # Breaks because parent $dbh is now broken</pre>


<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;AutoInactiveDestroy&quot;</tt> attribute was added
in <small>DBI 1.614.</small></p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;PrintWarn&quot;</i></p>

<p style="margin-left:11%; margin-top: 1em">Type: boolean,
inherited</p>

<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;PrintWarn&quot;</tt> attribute controls the
printing of warnings recorded by the driver. When set to a
true value the <small>DBI</small> will check method calls to
see if a warning condition has been set. If so, the
<small>DBI</small> will effectively do a
<tt>&quot;warn(&quot;$class $method warning:
$DBI::errstr&quot;)&quot;</tt> where <tt>$class</tt> is the
driver class and <tt>$method</tt> is the name of the method
which failed. E.g.,</p>

<pre style="margin-left:11%; margin-top: 1em">  DBD::Oracle::db execute warning: ... warning text here ...</pre>


<p style="margin-left:11%; margin-top: 1em">By default,
<tt>&quot;DBI&minus;&gt;connect&quot;</tt> sets
<tt>&quot;PrintWarn&quot;</tt> &quot;on&quot; if $^W is
true, i.e., perl is running with warnings enabled.</p>

<p style="margin-left:11%; margin-top: 1em">If desired, the
warnings can be caught and processed using a
<tt>$SIG{__WARN__}</tt> handler or modules like CGI::Carp
and CGI::ErrorWrap.</p>

<p style="margin-left:11%; margin-top: 1em">See also
&quot;set_err&quot; for how warnings are recorded and
&quot;HandleSetErr&quot; for how to influence it.</p>

<p style="margin-left:11%; margin-top: 1em">Fetching the
full details of warnings can require an extra round-trip to
the database server for some drivers. In which case the
driver may opt to only fetch the full details of warnings if
the <tt>&quot;PrintWarn&quot;</tt> attribute is true. If
<tt>&quot;PrintWarn&quot;</tt> is false then these drivers
should still indicate the fact that there were warnings by
setting the warning string to, for example: &quot;3
warnings&quot;.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;PrintError&quot;</i></p>

<p style="margin-left:11%; margin-top: 1em">Type: boolean,
inherited</p>

<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;PrintError&quot;</tt> attribute can be used to
force errors to generate warnings (using
<tt>&quot;warn&quot;</tt>) in addition to returning error
codes in the normal way. When set &quot;on&quot;, any method
which results in an error occurring will cause the
<small>DBI</small> to effectively do a
<tt>&quot;warn(&quot;$class $method failed:
$DBI::errstr&quot;)&quot;</tt> where <tt>$class</tt> is the
driver class and <tt>$method</tt> is the name of the method
which failed. E.g.,</p>

<pre style="margin-left:11%; margin-top: 1em">  DBD::Oracle::db prepare failed: ... error text here ...</pre>


<p style="margin-left:11%; margin-top: 1em">By default,
<tt>&quot;DBI&minus;&gt;connect&quot;</tt> sets
<tt>&quot;PrintError&quot;</tt> &quot;on&quot;.</p>

<p style="margin-left:11%; margin-top: 1em">If desired, the
warnings can be caught and processed using a
<tt>$SIG{__WARN__}</tt> handler or modules like CGI::Carp
and CGI::ErrorWrap.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;RaiseError&quot;</i></p>

<p style="margin-left:11%; margin-top: 1em">Type: boolean,
inherited</p>

<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;RaiseError&quot;</tt> attribute can be used to
force errors to raise exceptions rather than simply return
error codes in the normal way. It is &quot;off&quot; by
default. When set &quot;on&quot;, any method which results
in an error will cause the <small>DBI</small> to effectively
do a <tt>&quot;die(&quot;$class $method failed:
$DBI::errstr&quot;)&quot;</tt>, where <tt>$class</tt> is the
driver class and <tt>$method</tt> is the name of the method
that failed. E.g.,</p>

<pre style="margin-left:11%; margin-top: 1em">  DBD::Oracle::db prepare failed: ... error text here ...</pre>


<p style="margin-left:11%; margin-top: 1em">If you turn
<tt>&quot;RaiseError&quot;</tt> on then you&rsquo;d normally
turn <tt>&quot;PrintError&quot;</tt> off. If
<tt>&quot;PrintError&quot;</tt> is also on, then the
<tt>&quot;PrintError&quot;</tt> is done first
(naturally).</p>

<p style="margin-left:11%; margin-top: 1em">Typically
<tt>&quot;RaiseError&quot;</tt> is used in conjunction with
<tt>&quot;eval { ... }&quot;</tt> to catch the exception
that&rsquo;s been thrown and followed by an <tt>&quot;if
($@) { ... }&quot;</tt> block to handle the caught
exception. For example:</p>

<pre style="margin-left:11%; margin-top: 1em">  eval {
    ...
    $sth&minus;&gt;execute();
    ...
  };
  if ($@) {
    # $sth&minus;&gt;err and $DBI::err will be true if error was from DBI
    warn $@; # print the error
    ... # do whatever you need to deal with the error
  }</pre>


<p style="margin-left:11%; margin-top: 1em">In that eval
block the <tt>$DBI::lasth</tt> variable can be useful for
diagnosis and reporting if you can&rsquo;t be sure which
handle triggered the error. For example,
<tt>$DBI::lasth</tt>&minus;&gt;{Type} and
<tt>$DBI::lasth</tt>&minus;&gt;{Statement}.</p>

<p style="margin-left:11%; margin-top: 1em">See also
&quot;Transactions&quot;.</p>

<p style="margin-left:11%; margin-top: 1em">If you want to
temporarily turn <tt>&quot;RaiseError&quot;</tt> off (inside
a library function that is likely to fail, for example), the
recommended way is like this:</p>

<pre style="margin-left:11%; margin-top: 1em">  {
    local $h&minus;&gt;{RaiseError};  # localize and turn off for this block
    ...
  }</pre>


<p style="margin-left:11%; margin-top: 1em">The original
value will automatically and reliably be restored by Perl,
regardless of how the block is exited. The same logic
applies to other attributes, including
<tt>&quot;PrintError&quot;</tt>.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;HandleError&quot;</i></p>

<p style="margin-left:11%; margin-top: 1em">Type: code ref,
inherited</p>

<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;HandleError&quot;</tt> attribute can be used to
provide your own alternative behaviour in case of errors. If
set to a reference to a subroutine then that subroutine is
called when an error is detected (at the same point that
<tt>&quot;RaiseError&quot;</tt> and
<tt>&quot;PrintError&quot;</tt> are handled).</p>

<p style="margin-left:11%; margin-top: 1em">The subroutine
is called with three parameters: the error message string
that <tt>&quot;RaiseError&quot;</tt> and
<tt>&quot;PrintError&quot;</tt> would use, the
<small>DBI</small> handle being used, and the first value
being returned by the method that failed (typically
undef).</p>

<p style="margin-left:11%; margin-top: 1em">If the
subroutine returns a false value then the
<tt>&quot;RaiseError&quot;</tt> and/or
<tt>&quot;PrintError&quot;</tt> attributes are checked and
acted upon as normal.</p>

<p style="margin-left:11%; margin-top: 1em">For example, to
<tt>&quot;die&quot;</tt> with a full stack trace for any
error:</p>

<pre style="margin-left:11%; margin-top: 1em">  use Carp;
  $h&minus;&gt;{HandleError} = sub { confess(shift) };</pre>


<p style="margin-left:11%; margin-top: 1em">Or to turn
errors into exceptions:</p>

<pre style="margin-left:11%; margin-top: 1em">  use Exception; # or your own favourite exception module
  $h&minus;&gt;{HandleError} = sub { Exception&minus;&gt;new('DBI')&minus;&gt;raise($_[0]) };</pre>


<p style="margin-left:11%; margin-top: 1em">It is possible
to &rsquo;stack&rsquo; multiple HandleError handlers by
using closures:</p>

<pre style="margin-left:11%; margin-top: 1em">  sub your_subroutine {
    my $previous_handler = $h&minus;&gt;{HandleError};
    $h&minus;&gt;{HandleError} = sub {
      return 1 if $previous_handler and &amp;$previous_handler(@_);
      ... your code here ...
    };
  }</pre>


<p style="margin-left:11%; margin-top: 1em">Using a
<tt>&quot;my&quot;</tt> inside a subroutine to store the
previous <tt>&quot;HandleError&quot;</tt> value is
important. See perlsub and perlref for more information
about <i>closures</i>.</p>

<p style="margin-left:11%; margin-top: 1em">It is possible
for <tt>&quot;HandleError&quot;</tt> to alter the error
message that will be used by <tt>&quot;RaiseError&quot;</tt>
and <tt>&quot;PrintError&quot;</tt> if it returns false. It
can do that by altering the value of <tt>$_</tt>[0]. This
example appends a stack trace to all errors and, unlike the
previous example using Carp::confess, this will work
<tt>&quot;PrintError&quot;</tt> as well as
<tt>&quot;RaiseError&quot;</tt>:</p>

<pre style="margin-left:11%; margin-top: 1em">  $h&minus;&gt;{HandleError} = sub { $_[0]=Carp::longmess($_[0]); 0; };</pre>


<p style="margin-left:11%; margin-top: 1em">It is also
possible for <tt>&quot;HandleError&quot;</tt> to hide an
error, to a limited degree, by using &quot;set_err&quot; to
reset <tt>$DBI::err</tt> and <tt>$DBI::errstr</tt>, and
altering the return value of the failed method. For
example:</p>

<pre style="margin-left:11%; margin-top: 1em">  $h&minus;&gt;{HandleError} = sub {
    return 0 unless $_[0] =~ /^\S+ fetchrow_arrayref failed:/;
    return 0 unless $_[1]&minus;&gt;err == 1234; # the error to 'hide'
    $h&minus;&gt;set_err(undef,undef);   # turn off the error
    $_[2] = [ ... ];    # supply alternative return value
    return 1;
  };</pre>


<p style="margin-left:11%; margin-top: 1em">This only works
for methods which return a single value and is hard to make
reliable (avoiding infinite loops, for example) and so
isn&rsquo;t recommended for general use! If you find a
<i>good</i> use for it then please let me know.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;HandleSetErr&quot;</i></p>

<p style="margin-left:11%; margin-top: 1em">Type: code ref,
inherited</p>

<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;HandleSetErr&quot;</tt> attribute can be used to
intercept the setting of handle <tt>&quot;err&quot;</tt>,
<tt>&quot;errstr&quot;</tt>, and <tt>&quot;state&quot;</tt>
values. If set to a reference to a subroutine then that
subroutine is called whenever <i>set_err()</i> is called,
typically by the driver or a subclass.</p>

<p style="margin-left:11%; margin-top: 1em">The subroutine
is called with five arguments, the first five that were
passed to <i>set_err()</i>: the handle, the
<tt>&quot;err&quot;</tt>, <tt>&quot;errstr&quot;</tt>, and
<tt>&quot;state&quot;</tt> values being set, and the method
name. These can be altered by changing the values in the
<tt>@_</tt> array. The return value affects <i>set_err()</i>
behaviour, see &quot;set_err&quot; for details.</p>

<p style="margin-left:11%; margin-top: 1em">It is possible
to &rsquo;stack&rsquo; multiple HandleSetErr handlers by
using closures. See &quot;HandleError&quot; for an
example.</p>

<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;HandleSetErr&quot;</tt> and
<tt>&quot;HandleError&quot;</tt> subroutines differ in
subtle but significant ways. HandleError is only invoked at
the point where the <small>DBI</small> is about to return to
the application with <tt>&quot;err&quot;</tt> set true.
It&rsquo;s not invoked by the failure of a method
that&rsquo;s been called by another <small>DBI</small>
method. HandleSetErr, on the other hand, is called whenever
<i>set_err()</i> is called with a defined
<tt>&quot;err&quot;</tt> value, even if false. So it&rsquo;s
not just for errors, despite the name, but also warn and
info states. The <i>set_err()</i> method, and thus
HandleSetErr, may be called multiple times within a method
and is usually invoked from deep within driver code.</p>

<p style="margin-left:11%; margin-top: 1em">In theory a
driver can use the return value from HandleSetErr via
<i>set_err()</i> to decide whether to continue or not. If
<i>set_err()</i> returns an empty list, indicating that the
HandleSetErr code has &rsquo;handled&rsquo; the
&rsquo;error&rsquo;, the driver could then continue instead
of failing (if that&rsquo;s a reasonable thing to do). This
isn&rsquo;t excepted to be common and any such cases should
be clearly marked in the driver documentation and discussed
on the dbi-dev mailing list.</p>

<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;HandleSetErr&quot;</tt> attribute was added in
<small>DBI 1.41.</small></p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;ErrCount&quot;</i></p>

<p style="margin-left:11%; margin-top: 1em">Type: unsigned
integer</p>

<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;ErrCount&quot;</tt> attribute is incremented
whenever the <i>set_err()</i> method records an error. It
isn&rsquo;t incremented by warnings or information states.
It is not reset by the <small>DBI</small> at any time.</p>

<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;ErrCount&quot;</tt> attribute was added in
<small>DBI 1.41.</small> Older drivers may not have been
updated to use <i>set_err()</i> to record errors and so this
attribute may not be incremented when using them.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;ShowErrorStatement&quot;</i></p>

<p style="margin-left:11%; margin-top: 1em">Type: boolean,
inherited</p>

<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;ShowErrorStatement&quot;</tt> attribute can be
used to cause the relevant Statement text to be appended to
the error messages generated by the
<tt>&quot;RaiseError&quot;</tt>,
<tt>&quot;PrintError&quot;</tt>, and
<tt>&quot;PrintWarn&quot;</tt> attributes. Only applies to
errors on statement handles plus the <i>prepare()</i>,
<i>do()</i>, and the various <tt>&quot;select*()&quot;</tt>
database handle methods. (The exact format of the appended
text is subject to change.)</p>

<p style="margin-left:11%; margin-top: 1em">If
<tt>&quot;$h&minus;&gt;{ParamValues}&quot;</tt> returns a
hash reference of parameter (placeholder) values then those
are formatted and appended to the end of the Statement text
in the error message.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;TraceLevel&quot;</i></p>

<p style="margin-left:11%; margin-top: 1em">Type: integer,
inherited</p>

<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;TraceLevel&quot;</tt> attribute can be used as an
alternative to the &quot;trace&quot; method to set the
<small>DBI</small> trace level and trace flags for a
specific handle. See &quot; <small>TRACING&quot;</small> for
more details.</p>

<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;TraceLevel&quot;</tt> attribute is especially
useful combined with <tt>&quot;local&quot;</tt> to alter the
trace settings for just a single block of code.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;FetchHashKeyName&quot;</i></p>

<p style="margin-left:11%; margin-top: 1em">Type: string,
inherited</p>

<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;FetchHashKeyName&quot;</tt> attribute is used to
specify whether the <i>fetchrow_hashref()</i> method should
perform case conversion on the field names used for the hash
keys. For historical reasons it defaults to
&rsquo;<tt>&quot;NAME&quot;</tt>&rsquo; but it is
recommended to set it to
&rsquo;<tt>&quot;NAME_lc&quot;</tt>&rsquo; (convert to lower
case) or &rsquo;<tt>&quot;NAME_uc&quot;</tt>&rsquo; (convert
to upper case) according to your preference. It can only be
set for driver and database handles. For statement handles
the value is frozen when <i>prepare()</i> is called.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;ChopBlanks&quot;</i></p>

<p style="margin-left:11%; margin-top: 1em">Type: boolean,
inherited</p>

<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;ChopBlanks&quot;</tt> attribute can be used to
control the trimming of trailing space characters from fixed
width character ( <small>CHAR</small> ) fields. No other
field types are affected, even where field values have
trailing spaces.</p>

<p style="margin-left:11%; margin-top: 1em">The default is
false (although it is possible that the default may change).
Applications that need specific behaviour should set the
attribute as needed.</p>

<p style="margin-left:11%; margin-top: 1em">Drivers are not
required to support this attribute, but any driver which
does not support it must arrange to return
<tt>&quot;undef&quot;</tt> as the attribute value.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;LongReadLen&quot;</i></p>

<p style="margin-left:11%; margin-top: 1em">Type: unsigned
integer, inherited</p>

<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;LongReadLen&quot;</tt> attribute may be used to
control the maximum length of &rsquo;long&rsquo; type fields
( <small>LONG, BLOB, CLOB, MEMO,</small> etc.) which the
driver will read from the database automatically when it
fetches each row of data.</p>

<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;LongReadLen&quot;</tt> attribute only relates to
fetching and reading long values; it is not involved in
inserting or updating them.</p>

<p style="margin-left:11%; margin-top: 1em">A value of 0
means not to automatically fetch any long data. Drivers may
return undef or an empty string for long fields when
<tt>&quot;LongReadLen&quot;</tt> is 0.</p>

<p style="margin-left:11%; margin-top: 1em">The default is
typically 0 (zero) or 80 bytes but may vary between drivers.
Applications fetching long fields should set this value to
slightly larger than the longest long field value to be
fetched.</p>

<p style="margin-left:11%; margin-top: 1em">Some databases
return some long types encoded as pairs of hex digits. For
these types, <tt>&quot;LongReadLen&quot;</tt> relates to the
underlying data length and not the doubled-up length of the
encoded string.</p>

<p style="margin-left:11%; margin-top: 1em">Changing the
value of <tt>&quot;LongReadLen&quot;</tt> for a statement
handle after it has been
<tt>&quot;prepare&quot;</tt>&rsquo;d will typically have no
effect, so it&rsquo;s common to set
<tt>&quot;LongReadLen&quot;</tt> on the <tt>$dbh</tt> before
calling <tt>&quot;prepare&quot;</tt>.</p>

<p style="margin-left:11%; margin-top: 1em">For most
drivers the value used here has a direct effect on the
memory used by the statement handle while it&rsquo;s active,
so don&rsquo;t be too generous. If you can&rsquo;t be sure
what value to use you could execute an extra select
statement to determine the longest value. For example:</p>

<pre style="margin-left:11%; margin-top: 1em">  $dbh&minus;&gt;{LongReadLen} = $dbh&minus;&gt;selectrow_array(qq{
      SELECT MAX(OCTET_LENGTH(long_column_name))
      FROM table WHERE ...
  });
  $sth = $dbh&minus;&gt;prepare(qq{
      SELECT long_column_name, ... FROM table WHERE ...
  });</pre>


<p style="margin-left:11%; margin-top: 1em">You may need to
take extra care if the table can be modified between the
first select and the second being executed. You may also
need to use a different function if
<i><small>OCTET_LENGTH</small> ()</i> does not work for long
types in your database. For example, for Sybase use
<i><small>DATALENGTH</small> ()</i> and for Oracle use
<i><small>LENGTHB</small> ()</i>.</p>

<p style="margin-left:11%; margin-top: 1em">See also
&quot;LongTruncOk&quot; for information on truncation of
long types.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;LongTruncOk&quot;</i></p>

<p style="margin-left:11%; margin-top: 1em">Type: boolean,
inherited</p>

<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;LongTruncOk&quot;</tt> attribute may be used to
control the effect of fetching a long field value which has
been truncated (typically because it&rsquo;s longer than the
value of the <tt>&quot;LongReadLen&quot;</tt>
attribute).</p>

<p style="margin-left:11%; margin-top: 1em">By default,
<tt>&quot;LongTruncOk&quot;</tt> is false and so fetching a
long value that needs to be truncated will cause the fetch
to fail. (Applications should always be sure to check for
errors after a fetch loop in case an error, such as a divide
by zero or long field truncation, caused the fetch to
terminate prematurely.)</p>

<p style="margin-left:11%; margin-top: 1em">If a fetch
fails due to a long field truncation when
<tt>&quot;LongTruncOk&quot;</tt> is false, many drivers will
allow you to continue fetching further rows.</p>

<p style="margin-left:11%; margin-top: 1em">See also
&quot;LongReadLen&quot;.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;TaintIn&quot;</i></p>

<p style="margin-left:11%; margin-top: 1em">Type: boolean,
inherited</p>

<p style="margin-left:11%; margin-top: 1em">If the
<tt>&quot;TaintIn&quot;</tt> attribute is set to a true
value <i>and</i> Perl is running in taint mode (e.g.,
started with the <tt>&quot;&minus;T&quot;</tt> option), then
all the arguments to most <small>DBI</small> method calls
are checked for being tainted. <i>This may change.</i></p>

<p style="margin-left:11%; margin-top: 1em">The attribute
defaults to off, even if Perl is in taint mode. See perlsec
for more about taint mode. If Perl is not running in taint
mode, this attribute has no effect.</p>

<p style="margin-left:11%; margin-top: 1em">When fetching
data that you trust you can turn off the TaintIn attribute,
for that statement handle, for the duration of the fetch
loop.</p>

<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;TaintIn&quot;</tt> attribute was added in
<small>DBI 1.31.</small></p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;TaintOut&quot;</i></p>

<p style="margin-left:11%; margin-top: 1em">Type: boolean,
inherited</p>

<p style="margin-left:11%; margin-top: 1em">If the
<tt>&quot;TaintOut&quot;</tt> attribute is set to a true
value <i>and</i> Perl is running in taint mode (e.g.,
started with the <tt>&quot;&minus;T&quot;</tt> option), then
most data fetched from the database is considered tainted.
<i>This may change.</i></p>

<p style="margin-left:11%; margin-top: 1em">The attribute
defaults to off, even if Perl is in taint mode. See perlsec
for more about taint mode. If Perl is not running in taint
mode, this attribute has no effect.</p>

<p style="margin-left:11%; margin-top: 1em">When fetching
data that you trust you can turn off the TaintOut attribute,
for that statement handle, for the duration of the fetch
loop.</p>

<p style="margin-left:11%; margin-top: 1em">Currently only
fetched data is tainted. It is possible that the results of
other <small>DBI</small> method calls, and the value of
fetched attributes, may also be tainted in future versions.
That change may well break your applications unless you take
great care now. If you use <small>DBI</small> Taint mode,
please report your experience and any suggestions for
changes.</p>

<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;TaintOut&quot;</tt> attribute was added in
<small>DBI 1.31.</small></p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;Taint&quot;</i></p>

<p style="margin-left:11%; margin-top: 1em">Type: boolean,
inherited</p>

<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;Taint&quot;</tt> attribute is a shortcut for
&quot;TaintIn&quot; and &quot;TaintOut&quot; (it is also
present for backwards compatibility).</p>

<p style="margin-left:11%; margin-top: 1em">Setting this
attribute sets both &quot;TaintIn&quot; and
&quot;TaintOut&quot;, and retrieving it returns a true value
if and only if &quot;TaintIn&quot; and &quot;TaintOut&quot;
are both set to true values.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;Profile&quot;</i></p>

<p style="margin-left:11%; margin-top: 1em">Type:
inherited</p>

<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;Profile&quot;</tt> attribute enables the
collection and reporting of method call timing statistics.
See the DBI::Profile module documentation for <i>much</i>
more detail.</p>

<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;Profile&quot;</tt> attribute was added in
<small>DBI 1.24.</small></p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;ReadOnly&quot;</i></p>

<p style="margin-left:11%; margin-top: 1em">Type: boolean,
inherited</p>

<p style="margin-left:11%; margin-top: 1em">An application
can set the <tt>&quot;ReadOnly&quot;</tt> attribute of a
handle to a true value to indicate that it will not be
attempting to make any changes using that handle or any
children of it.</p>

<p style="margin-left:11%; margin-top: 1em">Note that the
exact definition of &rsquo;read only&rsquo; is rather fuzzy.
For more details see the documentation for the driver
you&rsquo;re using.</p>

<p style="margin-left:11%; margin-top: 1em">If the driver
can make the handle truly read-only then it should (unless
doing so would have unpleasant side effect, like changing
the consistency level from per-statement to per-session).
Otherwise the attribute is simply advisory.</p>

<p style="margin-left:11%; margin-top: 1em">A driver can
set the <tt>&quot;ReadOnly&quot;</tt> attribute itself to
indicate that the data it is connected to cannot be changed
for some reason.</p>

<p style="margin-left:11%; margin-top: 1em">Library modules
and proxy drivers can use the attribute to influence their
behavior. For example, the DBD::Gofer driver considers the
<tt>&quot;ReadOnly&quot;</tt> attribute when making a
decision about whether to retry an operation that
failed.</p>

<p style="margin-left:11%; margin-top: 1em">The attribute
should be set to 1 or 0 (or undef). Other values are
reserved.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;Callbacks&quot;</i></p>

<p style="margin-left:11%; margin-top: 1em">Type: hash
ref</p>

<p style="margin-left:11%; margin-top: 1em">The
<small>DBI</small> callback mechanism lets you intercept,
and optionally replace, any method call on a
<small>DBI</small> handle. At the extreme, it lets you
become a puppet master, deceiving the application in any way
you want.</p>

<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;Callbacks&quot;</tt> attribute is a hash reference
where the keys are <small>DBI</small> method names and the
values are code references. For each key naming a method,
the <small>DBI</small> will execute the associated code
reference before executing the method.</p>

<p style="margin-left:11%; margin-top: 1em">The arguments
to the code reference will be the same as to the method,
including the invocant (a database handle or statement
handle). For example, say that to callback to some code on a
call to <tt>&quot;prepare()&quot;</tt>:</p>

<pre style="margin-left:11%; margin-top: 1em">  $dbh&minus;&gt;{Callbacks} = {
      prepare =&gt; sub {
          my ($dbh, $query, $attrs) = @_;
          print &quot;Preparing q{$query}\n&quot;
      },
  };</pre>


<p style="margin-left:11%; margin-top: 1em">The callback
would then be executed when you called the
<tt>&quot;prepare()&quot;</tt> method:</p>

<pre style="margin-left:11%; margin-top: 1em">  $dbh&minus;&gt;prepare('SELECT 1');</pre>


<p style="margin-left:11%; margin-top: 1em">And the output
of course would be:</p>

<pre style="margin-left:11%; margin-top: 1em">  Preparing q{SELECT 1}</pre>


<p style="margin-left:11%; margin-top: 1em">Because
callbacks are executed <i>before</i> the methods
they&rsquo;re associated with, you can modify the arguments
before they&rsquo;re passed on to the method call. For
example, to make sure that all calls to
<tt>&quot;prepare()&quot;</tt> are immediately prepared by
DBD::Pg, add a callback that makes sure that the
<tt>&quot;pg_prepare_now&quot;</tt> attribute is always
set:</p>

<pre style="margin-left:11%; margin-top: 1em">  my $dbh = DBI&minus;&gt;connect($dsn, $username, $auth, {
      Callbacks =&gt; {
          prepare =&gt; sub {
              $_[2] ||= {};
              $_[2]&minus;&gt;{pg_prepare_now} = 1;
              return; # must return nothing
          },
      }
  });</pre>


<p style="margin-left:11%; margin-top: 1em">Note that we
are editing the contents of <tt>@_</tt> directly. In this
case we&rsquo;ve created the attributes hash if it&rsquo;s
not passed to the <tt>&quot;prepare&quot;</tt> call.</p>

<p style="margin-left:11%; margin-top: 1em">You can also
prevent the associated method from ever executing. While a
callback executes, <tt>$_</tt> holds the method name. (This
allows multiple callbacks to share the same code reference
and still know what method was called.) To prevent the
method from executing, simply <tt>&quot;undef $_&quot;</tt>.
For example, if you wanted to disable calls to
<tt>&quot;ping()&quot;</tt>, you could do this:</p>

<pre style="margin-left:11%; margin-top: 1em">  $dbh&minus;&gt;{Callbacks} = {
      ping =&gt; sub {
          # tell dispatch to not call the method:
          undef $_;
          # return this value instead:
          return &quot;42 bells&quot;;
      }
  };</pre>


<p style="margin-left:11%; margin-top: 1em">As with other
attributes, Callbacks can be specified on a handle or via
the attributes to <tt>&quot;connect()&quot;</tt>. Callbacks
can also be applied to a statement methods on a statement
handle. For example:</p>

<pre style="margin-left:11%; margin-top: 1em">  $sth&minus;&gt;{Callbacks} = {
      execute =&gt; sub {
          print &quot;Executing &quot;, shift&minus;&gt;{Statement}, &quot;\n&quot;;
      }
  };</pre>


<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;Callbacks&quot;</tt> attribute of a database
handle isn&rsquo;t copied to any statement handles it
creates. So setting callbacks for a statement handle
requires you to set the <tt>&quot;Callbacks&quot;</tt>
attribute on the statement handle yourself, as in the
example above, or use the special
<tt>&quot;ChildCallbacks&quot;</tt> key described below.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Special Keys
in Callbacks Attribute</b></p>

<p style="margin-left:11%; margin-top: 1em">In addition to
<small>DBI</small> handle method names, the
<tt>&quot;Callbacks&quot;</tt> hash reference supports three
additional keys.</p>

<p style="margin-left:11%; margin-top: 1em">The first is
the <tt>&quot;ChildCallbacks&quot;</tt> key. When a
statement handle is created from a database handle the
<tt>&quot;ChildCallbacks&quot;</tt> key of the database
handle&rsquo;s <tt>&quot;Callbacks&quot;</tt> attribute, if
any, becomes the new <tt>&quot;Callbacks&quot;</tt>
attribute of the statement handle. This allows you to define
callbacks for all statement handles created from a database
handle. For example, if you wanted to count how many times
<tt>&quot;execute&quot;</tt> was called in your application,
you could write:</p>

<pre style="margin-left:11%; margin-top: 1em">  my $exec_count = 0;
  my $dbh = DBI&minus;&gt;connect( $dsn, $username, $auth, {
      Callbacks =&gt; {
          ChildCallbacks =&gt; {
              execute =&gt; sub { $exec_count++; return; }
          }
      }
  });
  END {
      print &quot;The execute method was called $exec_count times\n&quot;;
  }</pre>


<p style="margin-left:11%; margin-top: 1em">The other two
special keys are <tt>&quot;connect_cached.new&quot;</tt> and
<tt>&quot;connect_cached.reused&quot;</tt>. These keys
define callbacks that are called when
<tt>&quot;connect_cached()&quot;</tt> is called, but allow
different behaviors depending on whether a new handle is
created or a handle is returned. The callback is invoked
with these arguments: <tt>&quot;$dbh, $dsn, $user, $auth,
$attr&quot;</tt>.</p>

<p style="margin-left:11%; margin-top: 1em">For example,
some applications uses <tt>&quot;connect_cached()&quot;</tt>
to connect with <tt>&quot;AutoCommit&quot;</tt> enabled and
then disable <tt>&quot;AutoCommit&quot;</tt> temporarily for
transactions. If <tt>&quot;connect_cached()&quot;</tt> is
called during a transaction, perhaps in a utility method,
then it might select the same cached handle and then force
<tt>&quot;AutoCommit&quot;</tt> on, forcing a commit of the
transaction. See the &quot;connect_cached&quot;
documentation for one way to deal with that. Here
we&rsquo;ll describe an alternative approach using a
callback.</p>

<p style="margin-left:11%; margin-top: 1em">Because the
<tt>&quot;connect_cached.*&quot;</tt> callbacks are invoked
before <i>connect_cached()</i> has applied the connect
attributes you can use a callback to edit the attributes
that will be applied. To prevent a cached handle from having
its transactions committed before it&rsquo;s returned, you
can eliminate the <tt>&quot;AutoCommit&quot;</tt> attribute
in a <tt>&quot;connect_cached.reused&quot;</tt> callback,
like so:</p>

<pre style="margin-left:11%; margin-top: 1em">  my $cb = {
      'connect_cached.reused' =&gt; sub { delete $_[4]&minus;&gt;{AutoCommit} },
  };
  sub dbh {
      my $self = shift;
      DBI&minus;&gt;connect_cached( $dsn, $username, $auth, {
          PrintError =&gt; 0,
          RaiseError =&gt; 1,
          AutoCommit =&gt; 1,
          Callbacks  =&gt; $cb,
      });
  }</pre>


<p style="margin-left:11%; margin-top: 1em">The upshot is
that new database handles are created with
<tt>&quot;AutoCommit&quot;</tt> enabled, while cached
database handles are left in whatever transaction state they
happened to be in when retrieved from the cache.</p>

<p style="margin-left:11%; margin-top: 1em">A more common
application for callbacks is setting connection state only
when a new connection is made (by <i>connect()</i> or
<i>connect_cached()</i>). Adding a callback to the connected
method makes this easy. This method is a no-op by default
(unless you subclass the <small>DBI</small> and change it).
The <small>DBI</small> calls it to indicate that a new
connection has been made and the connection attributes have
all been set. You can give it a bit of added functionality
by applying a callback to it. For example, to make sure that
MySQL understands your application&rsquo;s ANSI-compliant
<small>SQL,</small> set it up like so:</p>

<pre style="margin-left:11%; margin-top: 1em">  my $dbh = DBI&minus;&gt;connect($dsn, $username, $auth, {
      Callbacks =&gt; {
          connected =&gt; sub {
              shift&minus;&gt;do(q{
                  SET SESSION sql_mode='ansi,strict_trans_tables,no_auto_value_on_zero';
              });
              return;
          },
      }
  });</pre>


<p style="margin-left:11%; margin-top: 1em">One significant
limitation with callbacks is that there can only be one per
method per handle. This means it&rsquo;s easy for one use of
callbacks to interfere with, or typically simply overwrite,
another use of callbacks. For this reason modules using
callbacks should document the fact clearly so application
authors can tell if use of callbacks by the module will
clash with use of callbacks by the application.</p>

<p style="margin-left:11%; margin-top: 1em">You might be
able to work around this issue by taking a copy of the
original callback and calling it within your own. For
example:</p>

<pre style="margin-left:11%; margin-top: 1em">  my $prev_cb = $h&minus;&gt;{Callbacks}{method_name};
  $h&minus;&gt;{Callbacks}{method_name} = sub {
    if ($prev_cb) {
        my @result = $prev_cb&minus;&gt;(@_);
        return @result if not $_; # $prev_cb vetoed call
    }
    ... your callback logic here ...
  };</pre>



<p style="margin-left:11%; margin-top: 1em"><i>&quot;private_your_module_name_*&quot;</i></p>

<p style="margin-left:11%; margin-top: 1em">The
<small>DBI</small> provides a way to store extra information
in a <small>DBI</small> handle as &quot;private&quot;
attributes. The <small>DBI</small> will allow you to store
and retrieve any attribute which has a name starting with
&quot;<tt>&quot;private_&quot;</tt>&quot;.</p>

<p style="margin-left:11%; margin-top: 1em">It is
<i>strongly</i> recommended that you use just <i>one</i>
private attribute (e.g., use a hash ref) <i>and</i> give it
a long and unambiguous name that includes the module or
application name that the attribute relates to (e.g.,
&quot;<tt>&quot;private_YourFullModuleName_thingy&quot;</tt>&quot;).</p>

<p style="margin-left:11%; margin-top: 1em">Because of the
way the Perl tie mechanism works you cannot reliably use the
<tt>&quot;||=&quot;</tt> operator directly to initialise the
attribute, like this:</p>

<pre style="margin-left:11%; margin-top: 1em">  my $foo = $dbh&minus;&gt;{private_yourmodname_foo} ||= { ... }; # WRONG</pre>


<p style="margin-left:11%; margin-top: 1em">you should use
a two step approach like this:</p>

<pre style="margin-left:11%; margin-top: 1em">  my $foo = $dbh&minus;&gt;{private_yourmodname_foo};
  $foo ||= $dbh&minus;&gt;{private_yourmodname_foo} = { ... };</pre>


<p style="margin-left:11%; margin-top: 1em">This attribute
is primarily of interest to people sub-classing
<small>DBI,</small> or for applications to piggy-back extra
information onto <small>DBI</small> handles.</p>

<h2>DBI DATABASE HANDLE OBJECTS
<a name="DBI DATABASE HANDLE OBJECTS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">This section
covers the methods and attributes associated with database
handles.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Database
Handle Methods</b> <br>
The following methods are specified for <small>DBI</small>
database handles:</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;clone&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  $new_dbh = $dbh&minus;&gt;clone(\%attr);</pre>


<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;clone&quot;</tt> method duplicates the
<tt>$dbh</tt> connection by connecting with the same
parameters ($dsn, <tt>$user</tt>, <tt>$password</tt>) as
originally used.</p>

<p style="margin-left:11%; margin-top: 1em">The attributes
for the cloned connect are the same as those used for the
<i>original</i> connect, with any other attributes in
<tt>&quot;\%attr&quot;</tt> merged over them. Effectively
the same as doing:</p>

<pre style="margin-left:11%; margin-top: 1em">  %attributes_used = ( %original_attributes, %attr );</pre>


<p style="margin-left:11%; margin-top: 1em">If \%attr is
not given then it defaults to a hash containing all the
attributes in the attribute cache of <tt>$dbh</tt> excluding
any non-code references, plus the main boolean attributes
(RaiseError, PrintError, AutoCommit, etc.). <i>This
behaviour is unreliable and so use of clone without an
argument is deprecated and may cause a warning in a future
release.</i></p>

<p style="margin-left:11%; margin-top: 1em">The clone
method can be used even if the database handle is
disconnected.</p>

<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;clone&quot;</tt> method was added in <small>DBI
1.33.</small></p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;data_sources&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  @ary = $dbh&minus;&gt;data_sources();
  @ary = $dbh&minus;&gt;data_sources(\%attr);</pre>


<p style="margin-left:11%; margin-top: 1em">Returns a list
of data sources (databases) available via the <tt>$dbh</tt>
driver&rsquo;s <i>data_sources()</i> method, plus any extra
data sources that the driver can discover via the connected
<tt>$dbh</tt>. Typically the extra data sources are other
databases managed by the same server process that the
<tt>$dbh</tt> is connected to.</p>

<p style="margin-left:11%; margin-top: 1em">Data sources
are returned in a form suitable for passing to the
&quot;connect&quot; method (that is, they will include the
&quot;<tt>&quot;dbi:$driver:&quot;</tt>&quot; prefix).</p>

<p style="margin-left:11%; margin-top: 1em">The
<i>data_sources()</i> method, for a <tt>$dbh</tt>, was added
in <small>DBI 1.38.</small></p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;do&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  $rows = $dbh&minus;&gt;do($statement)           or die $dbh&minus;&gt;errstr;
  $rows = $dbh&minus;&gt;do($statement, \%attr)   or die $dbh&minus;&gt;errstr;
  $rows = $dbh&minus;&gt;do($statement, \%attr, @bind_values) or die ...</pre>


<p style="margin-left:11%; margin-top: 1em">Prepare and
execute a single statement. Returns the number of rows
affected or <tt>&quot;undef&quot;</tt> on error. A return
value of <tt>&quot;&minus;1&quot;</tt> means the number of
rows is not known, not applicable, or not available.</p>

<p style="margin-left:11%; margin-top: 1em">This method is
typically most useful for
<i>non</i>&minus;<tt>&quot;SELECT&quot;</tt> statements that
either cannot be prepared in advance (due to a limitation of
the driver) or do not need to be executed repeatedly. It
should not be used for <tt>&quot;SELECT&quot;</tt>
statements because it does not return a statement handle (so
you can&rsquo;t fetch any data).</p>

<p style="margin-left:11%; margin-top: 1em">The default
<tt>&quot;do&quot;</tt> method is logically similar to:</p>

<pre style="margin-left:11%; margin-top: 1em">  sub do {
      my($dbh, $statement, $attr, @bind_values) = @_;
      my $sth = $dbh&minus;&gt;prepare($statement, $attr) or return undef;
      $sth&minus;&gt;execute(@bind_values) or return undef;
      my $rows = $sth&minus;&gt;rows;
      ($rows == 0) ? &quot;0E0&quot; : $rows; # always return true if no error
  }</pre>


<p style="margin-left:11%; margin-top: 1em">For
example:</p>

<pre style="margin-left:11%; margin-top: 1em">  my $rows_deleted = $dbh&minus;&gt;do(q{
      DELETE FROM table
      WHERE status = ?
  }, undef, 'DONE') or die $dbh&minus;&gt;errstr;</pre>


<p style="margin-left:11%; margin-top: 1em">Using
placeholders and <tt>@bind_values</tt> with the
<tt>&quot;do&quot;</tt> method can be useful because it
avoids the need to correctly quote any variables in the
<tt>$statement</tt>. But if you&rsquo;ll be executing the
statement many times then it&rsquo;s more efficient to
<tt>&quot;prepare&quot;</tt> it once and call
<tt>&quot;execute&quot;</tt> many times instead.</p>

<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;q{...}&quot;</tt> style quoting used in this
example avoids clashing with quotes that may be used in the
<small>SQL</small> statement. Use the double-quote-like
<tt>&quot;qq{...}&quot;</tt> operator if you want to
interpolate variables into the string. See &quot;Quote and
Quote-like Operators&quot; in perlop for more details.</p>

<p style="margin-left:11%; margin-top: 1em">Note drivers
are free to avoid the overhead of creating an
<small>DBI</small> statement handle for <i>do()</i>,
especially if there are no parameters. In this case error
handlers, if invoked during <i>do()</i>, will be passed the
database handle.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;last_insert_id&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  $rv = $dbh&minus;&gt;last_insert_id($catalog, $schema, $table, $field);
  $rv = $dbh&minus;&gt;last_insert_id($catalog, $schema, $table, $field, \%attr);</pre>


<p style="margin-left:11%; margin-top: 1em">Returns a value
&rsquo;identifying&rsquo; the row just inserted, if
possible. Typically this would be a value assigned by the
database server to a column with an <i>auto_increment</i> or
<i>serial</i> type. Returns undef if the driver does not
support the method or can&rsquo;t determine the value.</p>

<p style="margin-left:11%; margin-top: 1em">The
<tt>$catalog</tt>, <tt>$schema</tt>, <tt>$table</tt>, and
<tt>$field</tt> parameters may be required for some drivers
(see below). If you don&rsquo;t know the parameter values
and your driver does not need them, then use
<tt>&quot;undef&quot;</tt> for each.</p>

<p style="margin-left:11%; margin-top: 1em">There are
several caveats to be aware of with this method if you want
to use it for portable applications:</p>

<p style="margin-left:11%; margin-top: 1em"><b>*</b> For
some drivers the value may only available immediately after
the insert statement has executed (e.g., mysql,
Informix).</p>

<p style="margin-left:11%; margin-top: 1em"><b>*</b> For
some drivers the <tt>$catalog</tt>, <tt>$schema</tt>,
<tt>$table</tt>, and <tt>$field</tt> parameters are
required, for others they are ignored (e.g., mysql).</p>

<p style="margin-left:11%; margin-top: 1em"><b>*</b>
Drivers may return an indeterminate value if no insert has
been performed yet.</p>

<p style="margin-left:11%; margin-top: 1em"><b>*</b> For
some drivers the value may only be available if placeholders
have <i>not</i> been used (e.g., Sybase, <small>MS
SQL</small> ). In this case the value returned would be from
the last non-placeholder insert statement.</p>

<p style="margin-left:11%; margin-top: 1em"><b>*</b> Some
drivers may need driver-specific hints about how to get the
value. For example, being told the name of the database
&rsquo;sequence&rsquo; object that holds the value. Any such
hints are passed as driver-specific attributes in the \%attr
parameter.</p>

<p style="margin-left:11%; margin-top: 1em"><b>*</b> If the
underlying database offers nothing better, then some drivers
may attempt to implement this method by executing
&quot;<tt>&quot;select max($field) from
$table&quot;</tt>&quot;. Drivers using any approach like
this should issue a warning if
<tt>&quot;AutoCommit&quot;</tt> is true because it is
generally unsafe &minus; another process may have modified
the table between your insert and the select. For situations
where you know it is safe, such as when you have locked the
table, you can silence the warning by passing
<tt>&quot;Warn&quot;</tt> =&gt; 0 in \%attr.</p>

<p style="margin-left:11%; margin-top: 1em"><b>*</b> If no
insert has been performed yet, or the last insert failed,
then the value is implementation defined.</p>

<p style="margin-left:11%; margin-top: 1em">Given all the
caveats above, it&rsquo;s clear that this method must be
used with care.</p>

<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;last_insert_id&quot;</tt> method was added in
<small>DBI 1.38.</small></p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;selectrow_array&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  @row_ary = $dbh&minus;&gt;selectrow_array($statement);
  @row_ary = $dbh&minus;&gt;selectrow_array($statement, \%attr);
  @row_ary = $dbh&minus;&gt;selectrow_array($statement, \%attr, @bind_values);</pre>


<p style="margin-left:11%; margin-top: 1em">This utility
method combines &quot;prepare&quot;, &quot;execute&quot; and
&quot;fetchrow_array&quot; into a single call. If called in
a list context, it returns the first row of data from the
statement. The <tt>$statement</tt> parameter can be a
previously prepared statement handle, in which case the
<tt>&quot;prepare&quot;</tt> is skipped.</p>

<p style="margin-left:11%; margin-top: 1em">If any method
fails, and &quot;RaiseError&quot; is not set,
<tt>&quot;selectrow_array&quot;</tt> will return an empty
list.</p>

<p style="margin-left:11%; margin-top: 1em">If called in a
scalar context for a statement handle that has more than one
column, it is undefined whether the driver will return the
value of the first column or the last. So don&rsquo;t do
that. Also, in a scalar context, an
<tt>&quot;undef&quot;</tt> is returned if there are no more
rows or if an error occurred. That
<tt>&quot;undef&quot;</tt> can&rsquo;t be distinguished from
an <tt>&quot;undef&quot;</tt> returned because the first
field value was <small>NULL.</small> For these reasons you
should exercise some caution if you use
<tt>&quot;selectrow_array&quot;</tt> in a scalar context, or
just don&rsquo;t do that.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;selectrow_arrayref&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  $ary_ref = $dbh&minus;&gt;selectrow_arrayref($statement);
  $ary_ref = $dbh&minus;&gt;selectrow_arrayref($statement, \%attr);
  $ary_ref = $dbh&minus;&gt;selectrow_arrayref($statement, \%attr, @bind_values);</pre>


<p style="margin-left:11%; margin-top: 1em">This utility
method combines &quot;prepare&quot;, &quot;execute&quot; and
&quot;fetchrow_arrayref&quot; into a single call. It returns
the first row of data from the statement. The
<tt>$statement</tt> parameter can be a previously prepared
statement handle, in which case the
<tt>&quot;prepare&quot;</tt> is skipped.</p>

<p style="margin-left:11%; margin-top: 1em">If any method
fails, and &quot;RaiseError&quot; is not set,
<tt>&quot;selectrow_array&quot;</tt> will return undef.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;selectrow_hashref&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  $hash_ref = $dbh&minus;&gt;selectrow_hashref($statement);
  $hash_ref = $dbh&minus;&gt;selectrow_hashref($statement, \%attr);
  $hash_ref = $dbh&minus;&gt;selectrow_hashref($statement, \%attr, @bind_values);</pre>


<p style="margin-left:11%; margin-top: 1em">This utility
method combines &quot;prepare&quot;, &quot;execute&quot; and
&quot;fetchrow_hashref&quot; into a single call. It returns
the first row of data from the statement. The
<tt>$statement</tt> parameter can be a previously prepared
statement handle, in which case the
<tt>&quot;prepare&quot;</tt> is skipped.</p>

<p style="margin-left:11%; margin-top: 1em">If any method
fails, and &quot;RaiseError&quot; is not set,
<tt>&quot;selectrow_hashref&quot;</tt> will return
undef.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;selectall_arrayref&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  $ary_ref = $dbh&minus;&gt;selectall_arrayref($statement);
  $ary_ref = $dbh&minus;&gt;selectall_arrayref($statement, \%attr);
  $ary_ref = $dbh&minus;&gt;selectall_arrayref($statement, \%attr, @bind_values);</pre>


<p style="margin-left:11%; margin-top: 1em">This utility
method combines &quot;prepare&quot;, &quot;execute&quot; and
&quot;fetchall_arrayref&quot; into a single call. It returns
a reference to an array containing a reference to an array
(or hash, see below) for each row of data fetched.</p>

<p style="margin-left:11%; margin-top: 1em">The
<tt>$statement</tt> parameter can be a previously prepared
statement handle, in which case the
<tt>&quot;prepare&quot;</tt> is skipped. This is recommended
if the statement is going to be executed many times.</p>

<p style="margin-left:11%; margin-top: 1em">If
&quot;RaiseError&quot; is not set and any method except
<tt>&quot;fetchall_arrayref&quot;</tt> fails then
<tt>&quot;selectall_arrayref&quot;</tt> will return
<tt>&quot;undef&quot;</tt>; if
<tt>&quot;fetchall_arrayref&quot;</tt> fails then it will
return with whatever data has been fetched thus far. You
should check <tt>&quot;$sth&minus;&gt;err&quot;</tt>
afterwards (or use the <tt>&quot;RaiseError&quot;</tt>
attribute) to discover if the data is complete or was
truncated due to an error.</p>

<p style="margin-left:11%; margin-top: 1em">The
&quot;fetchall_arrayref&quot; method called by
<tt>&quot;selectall_arrayref&quot;</tt> supports a
<tt>$max_rows</tt> parameter. You can specify a value for
<tt>$max_rows</tt> by including a
&rsquo;<tt>&quot;MaxRows&quot;</tt>&rsquo; attribute in
\%attr. In which case <i>finish()</i> is called for you
after <i>fetchall_arrayref()</i> returns.</p>

<p style="margin-left:11%; margin-top: 1em">The
&quot;fetchall_arrayref&quot; method called by
<tt>&quot;selectall_arrayref&quot;</tt> also supports a
<tt>$slice</tt> parameter. You can specify a value for
<tt>$slice</tt> by including a
&rsquo;<tt>&quot;Slice&quot;</tt>&rsquo; or
&rsquo;<tt>&quot;Columns&quot;</tt>&rsquo; attribute in
\%attr. The only difference between the two is that if
<tt>&quot;Slice&quot;</tt> is not defined and
<tt>&quot;Columns&quot;</tt> is an array ref, then the array
is assumed to contain column index values (which count from
1), rather than perl array index values. In which case the
array is copied and each value decremented before passing to
<tt>&quot;/fetchall_arrayref&quot;</tt>.</p>

<p style="margin-left:11%; margin-top: 1em">You may often
want to fetch an array of rows where each row is stored as a
hash. That can be done simple using:</p>

<pre style="margin-left:11%; margin-top: 1em">  my $emps = $dbh&minus;&gt;selectall_arrayref(
      &quot;SELECT ename FROM emp ORDER BY ename&quot;,
      { Slice =&gt; {} }
  );
  foreach my $emp ( @$emps ) {
      print &quot;Employee: $emp&minus;&gt;{ename}\n&quot;;
  }</pre>


<p style="margin-left:11%; margin-top: 1em">Or, to fetch
into an array instead of an array ref:</p>

<pre style="margin-left:11%; margin-top: 1em">  @result = @{ $dbh&minus;&gt;selectall_arrayref($sql, { Slice =&gt; {} }) };</pre>


<p style="margin-left:11%; margin-top: 1em">See
&quot;fetchall_arrayref&quot; method for more details.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;selectall_hashref&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  $hash_ref = $dbh&minus;&gt;selectall_hashref($statement, $key_field);
  $hash_ref = $dbh&minus;&gt;selectall_hashref($statement, $key_field, \%attr);
  $hash_ref = $dbh&minus;&gt;selectall_hashref($statement, $key_field, \%attr, @bind_values);</pre>


<p style="margin-left:11%; margin-top: 1em">This utility
method combines &quot;prepare&quot;, &quot;execute&quot; and
&quot;fetchall_hashref&quot; into a single call. It returns
a reference to a hash containing one entry, at most, for
each row, as returned by <i>fetchall_hashref()</i>.</p>

<p style="margin-left:11%; margin-top: 1em">The
<tt>$statement</tt> parameter can be a previously prepared
statement handle, in which case the
<tt>&quot;prepare&quot;</tt> is skipped. This is recommended
if the statement is going to be executed many times.</p>

<p style="margin-left:11%; margin-top: 1em">The
<tt>$key_field</tt> parameter defines which column, or
columns, are used as keys in the returned hash. It can
either be the name of a single field, or a reference to an
array containing multiple field names. Using multiple names
yields a tree of nested hashes.</p>

<p style="margin-left:11%; margin-top: 1em">If a row has
the same key as an earlier row then it replaces the earlier
row.</p>

<p style="margin-left:11%; margin-top: 1em">If any method
except <tt>&quot;fetchrow_hashref&quot;</tt> fails, and
&quot;RaiseError&quot; is not set,
<tt>&quot;selectall_hashref&quot;</tt> will return
<tt>&quot;undef&quot;</tt>. If
<tt>&quot;fetchrow_hashref&quot;</tt> fails and
&quot;RaiseError&quot; is not set, then it will return with
whatever data it has fetched thus far. <tt>$DBI::err</tt>
should be checked to catch that.</p>

<p style="margin-left:11%; margin-top: 1em">See
<i>fetchall_hashref()</i> for more details.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;selectcol_arrayref&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  $ary_ref = $dbh&minus;&gt;selectcol_arrayref($statement);
  $ary_ref = $dbh&minus;&gt;selectcol_arrayref($statement, \%attr);
  $ary_ref = $dbh&minus;&gt;selectcol_arrayref($statement, \%attr, @bind_values);</pre>


<p style="margin-left:11%; margin-top: 1em">This utility
method combines &quot;prepare&quot;, &quot;execute&quot;,
and fetching one column from all the rows, into a single
call. It returns a reference to an array containing the
values of the first column from each row.</p>

<p style="margin-left:11%; margin-top: 1em">The
<tt>$statement</tt> parameter can be a previously prepared
statement handle, in which case the
<tt>&quot;prepare&quot;</tt> is skipped. This is recommended
if the statement is going to be executed many times.</p>

<p style="margin-left:11%; margin-top: 1em">If any method
except <tt>&quot;fetch&quot;</tt> fails, and
&quot;RaiseError&quot; is not set,
<tt>&quot;selectcol_arrayref&quot;</tt> will return
<tt>&quot;undef&quot;</tt>. If <tt>&quot;fetch&quot;</tt>
fails and &quot;RaiseError&quot; is not set, then it will
return with whatever data it has fetched thus far.
<tt>$DBI::err</tt> should be checked to catch that.</p>

<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;selectcol_arrayref&quot;</tt> method defaults to
pushing a single column value (the first) from each row into
the result array. However, it can also push another column,
or even multiple columns per row, into the result array.
This behaviour can be specified via a
&rsquo;<tt>&quot;Columns&quot;</tt>&rsquo; attribute which
must be a ref to an array containing the column number or
numbers to use. For example:</p>

<pre style="margin-left:11%; margin-top: 1em">  # get array of id and name pairs:
  my $ary_ref = $dbh&minus;&gt;selectcol_arrayref(&quot;select id, name from table&quot;, { Columns=&gt;[1,2] });
  my %hash = @$ary_ref; # build hash from key&minus;value pairs so $hash{$id} =&gt; name</pre>


<p style="margin-left:11%; margin-top: 1em">You can specify
a maximum number of rows to fetch by including a
&rsquo;<tt>&quot;MaxRows&quot;</tt>&rsquo; attribute in
\%attr.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;prepare&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  $sth = $dbh&minus;&gt;prepare($statement)          or die $dbh&minus;&gt;errstr;
  $sth = $dbh&minus;&gt;prepare($statement, \%attr)  or die $dbh&minus;&gt;errstr;</pre>


<p style="margin-left:11%; margin-top: 1em">Prepares a
statement for later execution by the database engine and
returns a reference to a statement handle object.</p>

<p style="margin-left:11%; margin-top: 1em">The returned
statement handle can be used to get attributes of the
statement and invoke the &quot;execute&quot; method. See
&quot;Statement Handle Methods&quot;.</p>

<p style="margin-left:11%; margin-top: 1em">Drivers for
engines without the concept of preparing a statement will
typically just store the statement in the returned handle
and process it when
<tt>&quot;$sth&minus;&gt;execute&quot;</tt> is called. Such
drivers are unlikely to give much useful information about
the statement, such as
<tt>&quot;$sth&minus;&gt;{NUM_OF_FIELDS}&quot;</tt>, until
after <tt>&quot;$sth&minus;&gt;execute&quot;</tt> has been
called. Portable applications should take this into
account.</p>

<p style="margin-left:11%; margin-top: 1em">In general,
<small>DBI</small> drivers do not parse the contents of the
statement (other than simply counting any
&quot;Placeholders&quot;). The statement is passed directly
to the database engine, sometimes known as pass-thru mode.
This has advantages and disadvantages. On the plus side, you
can access all the functionality of the engine being used.
On the downside, you&rsquo;re limited if you&rsquo;re using
a simple engine, and you need to take extra care if writing
applications intended to be portable between engines.</p>

<p style="margin-left:11%; margin-top: 1em">Portable
applications should not assume that a new statement can be
prepared and/or executed while still fetching results from a
previous statement.</p>

<p style="margin-left:11%; margin-top: 1em">Some
command-line <small>SQL</small> tools use statement
terminators, like a semicolon, to indicate the end of a
statement. Such terminators should not normally be used with
the <small>DBI.</small></p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;prepare_cached&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  $sth = $dbh&minus;&gt;prepare_cached($statement)
  $sth = $dbh&minus;&gt;prepare_cached($statement, \%attr)
  $sth = $dbh&minus;&gt;prepare_cached($statement, \%attr, $if_active)</pre>


<p style="margin-left:11%; margin-top: 1em">Like
&quot;prepare&quot; except that the statement handle
returned will be stored in a hash associated with the
<tt>$dbh</tt>. If another call is made to
<tt>&quot;prepare_cached&quot;</tt> with the same
<tt>$statement</tt> and <tt>%attr</tt> parameter values,
then the corresponding cached <tt>$sth</tt> will be returned
without contacting the database server.</p>

<p style="margin-left:11%; margin-top: 1em">The
<tt>$if_active</tt> parameter lets you adjust the behaviour
if an already cached statement handle is still Active. There
are several alternatives: <b><br>
0</b>: A warning will be generated, and <i>finish()</i> will
be called on the <br>
statement handle before it is returned. This is the default
behaviour <br>
if $if_active is not passed. <b><br>
1</b>: <i>finish()</i> will be called on the statement
handle, but the warning is <br>
suppressed. <b><br>
2</b>: Disables any checking. <b><br>
3</b>: The existing active statement handle will be removed
from the cache <br>
and a new statement handle prepared and cached in its place.
This is <br>
the safest option because it doesn&rsquo;t affect the state
of the old <br>
handle, it just removes it from the cache. [Added in
<small>DBI 1.40</small> ]</p>

<p style="margin-left:11%; margin-top: 1em">Here are some
examples of <tt>&quot;prepare_cached&quot;</tt>:</p>

<pre style="margin-left:11%; margin-top: 1em">  sub insert_hash {
    my ($table, $field_values) = @_;
    # sort to keep field order, and thus sql, stable for prepare_cached
    my @fields = sort keys %$field_values;
    my @values = @{$field_values}{@fields};
    my $sql = sprintf &quot;insert into %s (%s) values (%s)&quot;,
        $table, join(&quot;,&quot;, @fields), join(&quot;,&quot;, (&quot;?&quot;)x@fields);
    my $sth = $dbh&minus;&gt;prepare_cached($sql);
    return $sth&minus;&gt;execute(@values);
  }
  sub search_hash {
    my ($table, $field_values) = @_;
    # sort to keep field order, and thus sql, stable for prepare_cached
    my @fields = sort keys %$field_values;
    my @values = @{$field_values}{@fields};
    my $qualifier = &quot;&quot;;
    $qualifier = &quot;where &quot;.join(&quot; and &quot;, map { &quot;$_=?&quot; } @fields) if @fields;
    $sth = $dbh&minus;&gt;prepare_cached(&quot;SELECT * FROM $table $qualifier&quot;);
    return $dbh&minus;&gt;selectall_arrayref($sth, {}, @values);
  }</pre>


<p style="margin-left:11%; margin-top: 1em"><i>Caveat
emptor:</i> This caching can be useful in some applications,
but it can also cause problems and should be used with care.
Here is a contrived case where caching would cause a
significant problem:</p>

<pre style="margin-left:11%; margin-top: 1em">  my $sth = $dbh&minus;&gt;prepare_cached('SELECT * FROM foo WHERE bar=?');
  $sth&minus;&gt;execute(...);
  while (my $data = $sth&minus;&gt;fetchrow_hashref) {
    # later, in some other code called within the loop...
    my $sth2 = $dbh&minus;&gt;prepare_cached('SELECT * FROM foo WHERE bar=?');
    $sth2&minus;&gt;execute(...);
    while (my $data2 = $sth2&minus;&gt;fetchrow_arrayref) {
      do_stuff(...);
    }
  }</pre>


<p style="margin-left:11%; margin-top: 1em">In this
example, since both handles are preparing the exact same
statement, <tt>$sth2</tt> will not be its own statement
handle, but a duplicate of <tt>$sth</tt> returned from the
cache. The results will certainly not be what you expect.
Typically the inner fetch loop will work normally, fetching
all the records and terminating when there are no more, but
now that <tt>$sth</tt> is the same as <tt>$sth2</tt> the
outer fetch loop will also terminate.</p>

<p style="margin-left:11%; margin-top: 1em">You&rsquo;ll
know if you run into this problem because
<i>prepare_cached()</i> will generate a warning by default
(when <tt>$if_active</tt> is false).</p>

<p style="margin-left:11%; margin-top: 1em">The cache used
by <i>prepare_cached()</i> is keyed by both the statement
and any attributes so you can also avoid this issue by doing
something like:</p>

<pre style="margin-left:11%; margin-top: 1em">  $sth = $dbh&minus;&gt;prepare_cached(&quot;...&quot;, { dbi_dummy =&gt; __FILE__.__LINE__ });</pre>


<p style="margin-left:11%; margin-top: 1em">which will
ensure that prepare_cached only returns statements cached by
that line of code in that source file.</p>

<p style="margin-left:11%; margin-top: 1em">If you&rsquo;d
like the cache to managed intelligently, you can tie the
hashref returned by <tt>&quot;CachedKids&quot;</tt> to an
appropriate caching module, such as Tie::Cache::LRU:</p>

<pre style="margin-left:11%; margin-top: 1em">  my $cache;
  tie %$cache, 'Tie::Cache::LRU', 500;
  $dbh&minus;&gt;{CachedKids} = $cache;</pre>



<p style="margin-left:11%; margin-top: 1em"><i>&quot;commit&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  $rc  = $dbh&minus;&gt;commit     or die $dbh&minus;&gt;errstr;</pre>


<p style="margin-left:11%; margin-top: 1em">Commit (make
permanent) the most recent series of database changes if the
database supports transactions and AutoCommit is off.</p>

<p style="margin-left:11%; margin-top: 1em">If
<tt>&quot;AutoCommit&quot;</tt> is on, then calling
<tt>&quot;commit&quot;</tt> will issue a &quot;commit
ineffective with AutoCommit&quot; warning.</p>

<p style="margin-left:11%; margin-top: 1em">See also
&quot;Transactions&quot; in the &quot; <small>FURTHER
INFORMATION&quot;</small> section below.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;rollback&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  $rc  = $dbh&minus;&gt;rollback   or die $dbh&minus;&gt;errstr;</pre>


<p style="margin-left:11%; margin-top: 1em">Rollback (undo)
the most recent series of uncommitted database changes if
the database supports transactions and AutoCommit is
off.</p>

<p style="margin-left:11%; margin-top: 1em">If
<tt>&quot;AutoCommit&quot;</tt> is on, then calling
<tt>&quot;rollback&quot;</tt> will issue a &quot;rollback
ineffective with AutoCommit&quot; warning.</p>

<p style="margin-left:11%; margin-top: 1em">See also
&quot;Transactions&quot; in the &quot; <small>FURTHER
INFORMATION&quot;</small> section below.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;begin_work&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  $rc  = $dbh&minus;&gt;begin_work   or die $dbh&minus;&gt;errstr;</pre>


<p style="margin-left:11%; margin-top: 1em">Enable
transactions (by turning <tt>&quot;AutoCommit&quot;</tt>
off) until the next call to <tt>&quot;commit&quot;</tt> or
<tt>&quot;rollback&quot;</tt>. After the next
<tt>&quot;commit&quot;</tt> or
<tt>&quot;rollback&quot;</tt>,
<tt>&quot;AutoCommit&quot;</tt> will automatically be turned
on again.</p>

<p style="margin-left:11%; margin-top: 1em">If
<tt>&quot;AutoCommit&quot;</tt> is already off when
<tt>&quot;begin_work&quot;</tt> is called then it does
nothing except return an error. If the driver does not
support transactions then when
<tt>&quot;begin_work&quot;</tt> attempts to set
<tt>&quot;AutoCommit&quot;</tt> off the driver will trigger
a fatal error.</p>

<p style="margin-left:11%; margin-top: 1em">See also
&quot;Transactions&quot; in the &quot; <small>FURTHER
INFORMATION&quot;</small> section below.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;disconnect&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  $rc = $dbh&minus;&gt;disconnect  or warn $dbh&minus;&gt;errstr;</pre>


<p style="margin-left:11%; margin-top: 1em">Disconnects the
database from the database handle.
<tt>&quot;disconnect&quot;</tt> is typically only used
before exiting the program. The handle is of little use
after disconnecting.</p>

<p style="margin-left:11%; margin-top: 1em">The transaction
behaviour of the <tt>&quot;disconnect&quot;</tt> method is,
sadly, undefined. Some database systems (such as Oracle and
Ingres) will automatically commit any outstanding changes,
but others (such as Informix) will rollback any outstanding
changes. Applications not using
<tt>&quot;AutoCommit&quot;</tt> should explicitly call
<tt>&quot;commit&quot;</tt> or <tt>&quot;rollback&quot;</tt>
before calling <tt>&quot;disconnect&quot;</tt>.</p>

<p style="margin-left:11%; margin-top: 1em">The database is
automatically disconnected by the
<tt>&quot;DESTROY&quot;</tt> method if still connected when
there are no longer any references to the handle. The
<tt>&quot;DESTROY&quot;</tt> method for each driver should
implicitly call <tt>&quot;rollback&quot;</tt> to undo any
uncommitted changes. This is vital behaviour to ensure that
incomplete transactions don&rsquo;t get committed simply
because Perl calls <tt>&quot;DESTROY&quot;</tt> on every
object before exiting. Also, do not rely on the order of
object destruction during &quot;global destruction&quot;, as
it is undefined.</p>

<p style="margin-left:11%; margin-top: 1em">Generally, if
you want your changes to be committed or rolled back when
you disconnect, then you should explicitly call
&quot;commit&quot; or &quot;rollback&quot; before
disconnecting.</p>

<p style="margin-left:11%; margin-top: 1em">If you
disconnect from a database while you still have active
statement handles (e.g., <small>SELECT</small> statement
handles that may have more data to fetch), you will get a
warning. The warning may indicate that a fetch loop
terminated early, perhaps due to an uncaught error. To avoid
the warning call the <tt>&quot;finish&quot;</tt> method on
the active handles.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;ping&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  $rc = $dbh&minus;&gt;ping;</pre>


<p style="margin-left:11%; margin-top: 1em">Attempts to
determine, in a reasonably efficient way, if the database
server is still running and the connection to it is still
working. Individual drivers should implement this function
in the most suitable manner for their database engine.</p>

<p style="margin-left:11%; margin-top: 1em">The current
<i>default</i> implementation always returns true without
actually doing anything. Actually, it returns
&quot;<tt>&quot;0 but true&quot;</tt>&quot; which is true
but zero. That way you can tell if the return value is
genuine or just the default. Drivers should override this
method with one that does the right thing for their type of
database.</p>

<p style="margin-left:11%; margin-top: 1em">Few
applications would have direct use for this method. See the
specialized Apache::DBI module for one example usage.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;get_info&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  $value = $dbh&minus;&gt;get_info( $info_type );</pre>


<p style="margin-left:11%; margin-top: 1em">Returns
information about the implementation, i.e. driver and data
source capabilities, restrictions etc. It returns
<tt>&quot;undef&quot;</tt> for unknown or unimplemented
information types. For example:</p>

<pre style="margin-left:11%; margin-top: 1em">  $database_version  = $dbh&minus;&gt;get_info(  18 ); # SQL_DBMS_VER
  $max_select_tables = $dbh&minus;&gt;get_info( 106 ); # SQL_MAXIMUM_TABLES_IN_SELECT</pre>


<p style="margin-left:11%; margin-top: 1em">See
&quot;Standards Reference Information&quot; for more
detailed information about the information types and their
meanings and possible return values.</p>

<p style="margin-left:11%; margin-top: 1em">The
DBI::Const::GetInfoType module exports a
<tt>%GetInfoType</tt> hash that can be used to map info type
names to numbers. For example:</p>

<pre style="margin-left:11%; margin-top: 1em">  $database_version = $dbh&minus;&gt;get_info( $GetInfoType{SQL_DBMS_VER} );</pre>


<p style="margin-left:11%; margin-top: 1em">The names are a
merging of the <small>ANSI</small> and <small>ODBC</small>
standards (which differ in some cases). See
DBI::Const::GetInfoType for more details.</p>

<p style="margin-left:11%; margin-top: 1em">Because some
<small>DBI</small> methods make use of <i>get_info()</i>,
drivers are strongly encouraged to support <i>at least</i>
the following very minimal set of information types to
ensure the <small>DBI</small> itself works properly:</p>

<pre style="margin-left:11%; margin-top: 1em"> Type  Name                        Example A     Example B
 &minus;&minus;&minus;&minus;  &minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;  &minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;  &minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;
   17  SQL_DBMS_NAME               'ACCESS'      'Oracle'
   18  SQL_DBMS_VER                '03.50.0000'  '08.01.0721 ...'
   29  SQL_IDENTIFIER_QUOTE_CHAR   '`'           '&quot;'
   41  SQL_CATALOG_NAME_SEPARATOR  '.'           '@'
  114  SQL_CATALOG_LOCATION        1             2</pre>



<p style="margin-left:11%; margin-top: 1em"><i>&quot;table_info&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  $sth = $dbh&minus;&gt;table_info( $catalog, $schema, $table, $type );
  $sth = $dbh&minus;&gt;table_info( $catalog, $schema, $table, $type, \%attr );
  # then $sth&minus;&gt;fetchall_arrayref or $sth&minus;&gt;fetchall_hashref etc</pre>


<p style="margin-left:11%; margin-top: 1em">Returns an
active statement handle that can be used to fetch
information about tables and views that exist in the
database.</p>

<p style="margin-left:11%; margin-top: 1em">The arguments
<tt>$catalog</tt>, <tt>$schema</tt> and <tt>$table</tt> may
accept search patterns according to the database/driver, for
example: <tt>$table</tt> = &rsquo;%FOO%&rsquo;; Remember
that the underscore character
(&rsquo;<tt>&quot;_&quot;</tt>&rsquo;) is a search pattern
that means match any character, so &rsquo;FOO_%&rsquo; is
the same as &rsquo;FOO%&rsquo; and &rsquo;FOO_BAR%&rsquo;
will match names like &rsquo; <small>FOO1BAR</small>
&rsquo;.</p>

<p style="margin-left:11%; margin-top: 1em">The value of
<tt>$type</tt> is a comma-separated list of one or more
types of tables to be returned in the result set. Each value
may optionally be quoted, e.g.:</p>

<pre style="margin-left:11%; margin-top: 1em">  $type = &quot;TABLE&quot;;
  $type = &quot;'TABLE','VIEW'&quot;;</pre>


<p style="margin-left:11%; margin-top: 1em">In addition the
following special cases may also be supported by some
drivers:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="83%">


<p>If the value of <tt>$catalog</tt> is &rsquo;%&rsquo; and
<tt>$schema</tt> and <tt>$table</tt> name are empty strings,
the result set contains a list of catalog names. For
example:</p> </td></tr>
</table>

<pre style="margin-left:17%; margin-top: 1em">  $sth = $dbh&minus;&gt;table_info('%', '', '');</pre>



<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p style="margin-top: 1em">&bull;</p></td>
<td width="5%"></td>
<td width="83%">


<p style="margin-top: 1em">If the value of <tt>$schema</tt>
is &rsquo;%&rsquo; and <tt>$catalog</tt> and <tt>$table</tt>
are empty strings, the result set contains a list of schema
names.</p> </td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="83%">


<p>If the value of <tt>$type</tt> is &rsquo;%&rsquo; and
<tt>$catalog</tt>, <tt>$schema</tt>, and <tt>$table</tt> are
all empty strings, the result set contains a list of table
types.</p> </td></tr>
</table>

<p style="margin-left:11%; margin-top: 1em">If your driver
doesn&rsquo;t support one or more of the selection filter
parameters then you may get back more than you asked for and
can do the filtering yourself.</p>

<p style="margin-left:11%; margin-top: 1em">This method can
be expensive, and can return a large amount of data. (For
example, small Oracle installation returns over 2000 rows.)
So it&rsquo;s a good idea to use the filters to limit the
data as much as possible.</p>

<p style="margin-left:11%; margin-top: 1em">The statement
handle returned has at least the following fields in the
order show below. Other fields, after these, may also be
present.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>TABLE_CAT</small></b>
: Table catalog identifier. This field is
<small>NULL</small> (<tt>&quot;undef&quot;</tt>) if not
applicable to the data source, which is usually the case.
This field is empty if not applicable to the table.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>TABLE_SCHEM</small></b>
: The name of the schema containing the
<small>TABLE_NAME</small> value. This field is
<small>NULL</small> (<tt>&quot;undef&quot;</tt>) if not
applicable to data source, and empty if not applicable to
the table.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>TABLE_NAME</small></b>
: Name of the table (or view, synonym, etc).</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>TABLE_TYPE</small></b>
: One of the following: &quot; <small>TABLE&quot;,
&quot;VIEW&quot;, &quot;SYSTEM TABLE&quot;, &quot;GLOBAL
TEMPORARY&quot;, &quot;LOCAL TEMPORARY&quot;,
&quot;ALIAS&quot;, &quot;SYNONYM&quot;</small> or a type
identifier that is specific to the data source.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>REMARKS</small></b>
: A description of the table. May be <small>NULL</small>
(<tt>&quot;undef&quot;</tt>).</p>

<p style="margin-left:11%; margin-top: 1em">Note that
<tt>&quot;table_info&quot;</tt> might not return records for
all tables. Applications can use any valid table regardless
of whether it&rsquo;s returned by
<tt>&quot;table_info&quot;</tt>.</p>

<p style="margin-left:11%; margin-top: 1em">See also
&quot;tables&quot;, &quot;Catalog Methods&quot; and
&quot;Standards Reference Information&quot;.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;column_info&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  $sth = $dbh&minus;&gt;column_info( $catalog, $schema, $table, $column );
  # then $sth&minus;&gt;fetchall_arrayref or $sth&minus;&gt;fetchall_hashref etc</pre>


<p style="margin-left:11%; margin-top: 1em">Returns an
active statement handle that can be used to fetch
information about columns in specified tables.</p>

<p style="margin-left:11%; margin-top: 1em">The arguments
<tt>$schema</tt>, <tt>$table</tt> and <tt>$column</tt> may
accept search patterns according to the database/driver, for
example: <tt>$table</tt> = &rsquo;%FOO%&rsquo;;</p>

<p style="margin-left:11%; margin-top: 1em">Note: The
support for the selection criteria is driver specific. If
the driver doesn&rsquo;t support one or more of them then
you may get back more than you asked for and can do the
filtering yourself.</p>

<p style="margin-left:11%; margin-top: 1em">Note: If your
driver does not support column_info an undef is returned.
This is distinct from asking for something which does not
exist in a driver which supports column_info as a valid
statement handle to an empty result-set will be returned in
this case.</p>

<p style="margin-left:11%; margin-top: 1em">If the
arguments don&rsquo;t match any tables then you&rsquo;ll
still get a statement handle, it&rsquo;ll just return no
rows.</p>

<p style="margin-left:11%; margin-top: 1em">The statement
handle returned has at least the following fields in the
order shown below. Other fields, after these, may also be
present.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>TABLE_CAT</small></b>
: The catalog identifier. This field is <small>NULL</small>
(<tt>&quot;undef&quot;</tt>) if not applicable to the data
source, which is often the case. This field is empty if not
applicable to the table.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>TABLE_SCHEM</small></b>
: The schema identifier. This field is <small>NULL</small>
(<tt>&quot;undef&quot;</tt>) if not applicable to the data
source, and empty if not applicable to the table.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>TABLE_NAME</small></b>
: The table identifier. Note: A driver may provide column
metadata not only for base tables, but also for derived
objects like <small>SYNONYMS</small> etc.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>COLUMN_NAME</small></b>
: The column identifier.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>DATA_TYPE</small></b>
: The concise data type code.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>TYPE_NAME</small></b>
: A data source dependent data type name.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>COLUMN_SIZE</small></b>
: The column size. This is the maximum length in characters
for character data types, the number of digits or bits for
numeric data types or the length in the representation of
temporal types. See the relevant specifications for detailed
information.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>BUFFER_LENGTH</small></b>
: The length in bytes of transferred data.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>DECIMAL_DIGITS</small></b>
: The total number of significant digits to the right of the
decimal point.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>NUM_PREC_RADIX</small></b>
: The radix for numeric precision. The value is 10 or 2 for
numeric data types and <small>NULL</small>
(<tt>&quot;undef&quot;</tt>) if not applicable.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>NULLABLE</small></b>
: Indicates if a column can accept NULLs. The following
values are defined:</p>

<pre style="margin-left:11%; margin-top: 1em">  SQL_NO_NULLS          0
  SQL_NULLABLE          1
  SQL_NULLABLE_UNKNOWN  2</pre>



<p style="margin-left:11%; margin-top: 1em"><b><small>REMARKS</small></b>
: A description of the column.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>COLUMN_DEF</small></b>
: The default value of the column, in a format that can be
used directly in an <small>SQL</small> statement.</p>

<p style="margin-left:11%; margin-top: 1em">Note that this
may be an expression and not simply the text used for the
default value in the original <small>CREATE TABLE</small>
statement. For example, given:</p>

<pre style="margin-left:11%; margin-top: 1em">    col1 char(30) default current_user    &minus;&minus; a 'function'
    col2 char(30) default 'string'        &minus;&minus; a string literal</pre>


<p style="margin-left:11%; margin-top: 1em">where
&quot;current_user&quot; is the name of a function, the
corresponding <tt>&quot;COLUMN_DEF&quot;</tt> values would
be:</p>

<pre style="margin-left:11%; margin-top: 1em">    Database        col1                     col2
    &minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;        &minus;&minus;&minus;&minus;                     &minus;&minus;&minus;&minus;
    Oracle:         current_user             'string'
    Postgres:       &quot;current_user&quot;()         'string'::text
    MS SQL:         (user_name())            ('string')</pre>



<p style="margin-left:11%; margin-top: 1em"><b><small>SQL_DATA_TYPE</small></b>
: The <small>SQL</small> data type.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>SQL_DATETIME_SUB</small></b>
: The subtype code for datetime and interval data types.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>CHAR_OCTET_LENGTH</small></b>
: The maximum length in bytes of a character or binary data
type column.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>ORDINAL_POSITION</small></b>
: The column sequence number (starting with 1).</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>IS_NULLABLE</small></b>
: Indicates if the column can accept NULLs. Possible values
are: &rsquo; <small>NO</small> &rsquo;, &rsquo;
<small>YES</small> &rsquo; and &rsquo;&rsquo;.</p>


<p style="margin-left:11%; margin-top: 1em"><small>SQL/CLI</small>
defines the following additional columns:</p>

<pre style="margin-left:11%; margin-top: 1em">  CHAR_SET_CAT
  CHAR_SET_SCHEM
  CHAR_SET_NAME
  COLLATION_CAT
  COLLATION_SCHEM
  COLLATION_NAME
  UDT_CAT
  UDT_SCHEM
  UDT_NAME
  DOMAIN_CAT
  DOMAIN_SCHEM
  DOMAIN_NAME
  SCOPE_CAT
  SCOPE_SCHEM
  SCOPE_NAME
  MAX_CARDINALITY
  DTD_IDENTIFIER
  IS_SELF_REF</pre>


<p style="margin-left:11%; margin-top: 1em">Drivers capable
of supplying any of those values should do so in the
corresponding column and supply undef values for the
others.</p>

<p style="margin-left:11%; margin-top: 1em">Drivers wishing
to provide extra database/driver specific information should
do so in extra columns beyond all those listed above, and
use lowercase field names with the driver-specific prefix
(i.e., &rsquo;ora_...&rsquo;). Applications accessing such
fields should do so by name and not by column number.</p>

<p style="margin-left:11%; margin-top: 1em">The result set
is ordered by <small>TABLE_CAT, TABLE_SCHEM,
TABLE_NAME</small> and <small>ORDINAL_POSITION.</small></p>

<p style="margin-left:11%; margin-top: 1em">Note: There is
some overlap with statement handle attributes (in perl) and
SQLDescribeCol (in <small>ODBC</small> ). However,
SQLColumns provides more metadata.</p>

<p style="margin-left:11%; margin-top: 1em">See also
&quot;Catalog Methods&quot; and &quot;Standards Reference
Information&quot;.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;primary_key_info&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  $sth = $dbh&minus;&gt;primary_key_info( $catalog, $schema, $table );
  # then $sth&minus;&gt;fetchall_arrayref or $sth&minus;&gt;fetchall_hashref etc</pre>


<p style="margin-left:11%; margin-top: 1em">Returns an
active statement handle that can be used to fetch
information about columns that make up the primary key for a
table. The arguments don&rsquo;t accept search patterns
(unlike <i>table_info()</i>).</p>

<p style="margin-left:11%; margin-top: 1em">The statement
handle will return one row per column, ordered by
<small>TABLE_CAT, TABLE_SCHEM, TABLE_NAME,</small> and
<small>KEY_SEQ.</small> If there is no primary key then the
statement handle will fetch no rows.</p>

<p style="margin-left:11%; margin-top: 1em">Note: The
support for the selection criteria, such as
<tt>$catalog</tt>, is driver specific. If the driver
doesn&rsquo;t support catalogs and/or schemas, it may ignore
these criteria.</p>

<p style="margin-left:11%; margin-top: 1em">The statement
handle returned has at least the following fields in the
order shown below. Other fields, after these, may also be
present.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>TABLE_CAT</small></b>
: The catalog identifier. This field is <small>NULL</small>
(<tt>&quot;undef&quot;</tt>) if not applicable to the data
source, which is often the case. This field is empty if not
applicable to the table.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>TABLE_SCHEM</small></b>
: The schema identifier. This field is <small>NULL</small>
(<tt>&quot;undef&quot;</tt>) if not applicable to the data
source, and empty if not applicable to the table.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>TABLE_NAME</small></b>
: The table identifier.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>COLUMN_NAME</small></b>
: The column identifier.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>KEY_SEQ</small></b>
: The column sequence number (starting with 1). Note: This
field is named <b><small>ORDINAL_POSITION</small></b> in
<small>SQL/CLI.</small></p>


<p style="margin-left:11%; margin-top: 1em"><small><b>PK_NAME</b></small>
: The primary key constraint identifier. This field is
<small>NULL</small> (<tt>&quot;undef&quot;</tt>) if not
applicable to the data source.</p>

<p style="margin-left:11%; margin-top: 1em">See also
&quot;Catalog Methods&quot; and &quot;Standards Reference
Information&quot;.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;primary_key&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  @key_column_names = $dbh&minus;&gt;primary_key( $catalog, $schema, $table );</pre>


<p style="margin-left:11%; margin-top: 1em">Simple
interface to the <i>primary_key_info()</i> method. Returns a
list of the column names that comprise the primary key of
the specified table. The list is in primary key column
sequence order. If there is no primary key then an empty
list is returned.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;foreign_key_info&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  $sth = $dbh&minus;&gt;foreign_key_info( $pk_catalog, $pk_schema, $pk_table
                               , $fk_catalog, $fk_schema, $fk_table );
  $sth = $dbh&minus;&gt;foreign_key_info( $pk_catalog, $pk_schema, $pk_table
                               , $fk_catalog, $fk_schema, $fk_table
                               , \%attr );
  # then $sth&minus;&gt;fetchall_arrayref or $sth&minus;&gt;fetchall_hashref etc</pre>


<p style="margin-left:11%; margin-top: 1em">Returns an
active statement handle that can be used to fetch
information about foreign keys in and/or referencing the
specified table(s). The arguments don&rsquo;t accept search
patterns (unlike <i>table_info()</i>).</p>


<p style="margin-left:11%; margin-top: 1em"><tt>$pk_catalog</tt>,
<tt>$pk_schema</tt>, <tt>$pk_table</tt> identify the primary
(unique) key table ( <b><small>PKT</small></b> ).</p>


<p style="margin-left:11%; margin-top: 1em"><tt>$fk_catalog</tt>,
<tt>$fk_schema</tt>, <tt>$fk_table</tt> identify the foreign
key table ( <b><small>FKT</small></b> ).</p>

<p style="margin-left:11%; margin-top: 1em">If both
<b><small>PKT</small></b> and <b><small>FKT</small></b> are
given, the function returns the foreign key, if any, in
table <b><small>FKT</small></b> that refers to the primary
(unique) key of table <b><small>PKT</small></b> . (Note: In
<small>SQL/CLI,</small> the result is
implementation-defined.)</p>

<p style="margin-left:11%; margin-top: 1em">If only
<b><small>PKT</small></b> is given, then the result set
contains the primary key of that table and all foreign keys
that refer to it.</p>

<p style="margin-left:11%; margin-top: 1em">If only
<b><small>FKT</small></b> is given, then the result set
contains all foreign keys in that table and the primary keys
to which they refer. (Note: In <small>SQL/CLI,</small> the
result includes unique keys too.)</p>

<p style="margin-left:11%; margin-top: 1em">For
example:</p>

<pre style="margin-left:11%; margin-top: 1em">  $sth = $dbh&minus;&gt;foreign_key_info( undef, $user, 'master');
  $sth = $dbh&minus;&gt;foreign_key_info( undef, undef,   undef , undef, $user, 'detail');
  $sth = $dbh&minus;&gt;foreign_key_info( undef, $user, 'master', undef, $user, 'detail');
  # then $sth&minus;&gt;fetchall_arrayref or $sth&minus;&gt;fetchall_hashref etc</pre>


<p style="margin-left:11%; margin-top: 1em">Note: The
support for the selection criteria, such as
<tt>$catalog</tt>, is driver specific. If the driver
doesn&rsquo;t support catalogs and/or schemas, it may ignore
these criteria.</p>

<p style="margin-left:11%; margin-top: 1em">The statement
handle returned has the following fields in the order shown
below. Because <small>ODBC</small> never includes unique
keys, they define different columns in the result set than
<small>SQL/CLI. SQL/CLI</small> column names are shown in
parentheses.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>PKTABLE_CAT</small>
( <small>UK_TABLE_CAT</small> )</b>: The primary (unique)
key table catalog identifier. This field is
<small>NULL</small> (<tt>&quot;undef&quot;</tt>) if not
applicable to the data source, which is often the case. This
field is empty if not applicable to the table.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>PKTABLE_SCHEM</small>
( <small>UK_TABLE_SCHEM</small> )</b>: The primary (unique)
key table schema identifier. This field is
<small>NULL</small> (<tt>&quot;undef&quot;</tt>) if not
applicable to the data source, and empty if not applicable
to the table.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>PKTABLE_NAME</small>
( <small>UK_TABLE_NAME</small> )</b>: The primary (unique)
key table identifier.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>PKCOLUMN_NAME</small>
( <small>UK_COLUMN_NAME</small> )</b>: The primary (unique)
key column identifier.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>FKTABLE_CAT</small>
( <small>FK_TABLE_CAT</small> )</b>: The foreign key table
catalog identifier. This field is <small>NULL</small>
(<tt>&quot;undef&quot;</tt>) if not applicable to the data
source, which is often the case. This field is empty if not
applicable to the table.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>FKTABLE_SCHEM</small>
( <small>FK_TABLE_SCHEM</small> )</b>: The foreign key table
schema identifier. This field is <small>NULL</small>
(<tt>&quot;undef&quot;</tt>) if not applicable to the data
source, and empty if not applicable to the table.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>FKTABLE_NAME</small>
( <small>FK_TABLE_NAME</small> )</b>: The foreign key table
identifier.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>FKCOLUMN_NAME</small>
( <small>FK_COLUMN_NAME</small> )</b>: The foreign key
column identifier.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>KEY_SEQ</small>
( <small>ORDINAL_POSITION</small> )</b>: The column sequence
number (starting with 1).</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>UPDATE_RULE</small>
( <small>UPDATE_RULE</small> )</b>: The referential action
for the <small>UPDATE</small> rule. The following codes are
defined:</p>

<pre style="margin-left:11%; margin-top: 1em">  CASCADE              0
  RESTRICT             1
  SET NULL             2
  NO ACTION            3
  SET DEFAULT          4</pre>



<p style="margin-left:11%; margin-top: 1em"><b><small>DELETE_RULE</small>
( <small>DELETE_RULE</small> )</b>: The referential action
for the <small>DELETE</small> rule. The codes are the same
as for <small>UPDATE_RULE.</small></p>


<p style="margin-left:11%; margin-top: 1em"><small><b>FK_NAME</b></small>
<b>( <small>FK_NAME</small> )</b>: The foreign key name.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>PK_NAME</small>
( <small>UK_NAME</small> )</b>: The primary (unique) key
name.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>DEFERRABILITY</small>
( <small>DEFERABILITY</small> )</b>: The deferrability of
the foreign key constraint. The following codes are
defined:</p>

<pre style="margin-left:11%; margin-top: 1em">  INITIALLY DEFERRED   5
  INITIALLY IMMEDIATE  6
  NOT DEFERRABLE       7</pre>


<p style="margin-left:11%; margin-top: 1em"><b>(
<small>UNIQUE_OR_PRIMARY</small> )</b>: This column is
necessary if a driver includes all candidate (i.e. primary
and alternate) keys in the result set (as specified by
<small>SQL/CLI</small> ). The value of this column is
<small>UNIQUE</small> if the foreign key references an
alternate key and <small>PRIMARY</small> if the foreign key
references a primary key, or it may be undefined if the
driver doesn&rsquo;t have access to the information.</p>

<p style="margin-left:11%; margin-top: 1em">See also
&quot;Catalog Methods&quot; and &quot;Standards Reference
Information&quot;.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;statistics_info&quot;</i></p>


<p style="margin-left:11%; margin-top: 1em"><b>Warning:</b>
This method is experimental and may change.</p>

<pre style="margin-left:11%; margin-top: 1em">  $sth = $dbh&minus;&gt;statistics_info( $catalog, $schema, $table, $unique_only, $quick );
  # then $sth&minus;&gt;fetchall_arrayref or $sth&minus;&gt;fetchall_hashref etc</pre>


<p style="margin-left:11%; margin-top: 1em">Returns an
active statement handle that can be used to fetch
statistical information about a table and its indexes.</p>

<p style="margin-left:11%; margin-top: 1em">The arguments
don&rsquo;t accept search patterns (unlike
&quot;table_info&quot;).</p>

<p style="margin-left:11%; margin-top: 1em">If the boolean
argument <tt>$unique_only</tt> is true, only
<small>UNIQUE</small> indexes will be returned in the result
set, otherwise all indexes will be returned.</p>

<p style="margin-left:11%; margin-top: 1em">If the boolean
argument <tt>$quick</tt> is set, the actual statistical
information columns ( <small>CARDINALITY</small> and
<small>PAGES</small> ) will only be returned if they are
readily available from the server, and might not be current.
Some databases may return stale statistics or no statistics
at all with this flag set.</p>

<p style="margin-left:11%; margin-top: 1em">The statement
handle will return at most one row per column name per
index, plus at most one row for the entire table itself,
ordered by <small>NON_UNIQUE, TYPE, INDEX_QUALIFIER,
INDEX_NAME,</small> and <small>ORDINAL_POSITION.</small></p>

<p style="margin-left:11%; margin-top: 1em">Note: The
support for the selection criteria, such as
<tt>$catalog</tt>, is driver specific. If the driver
doesn&rsquo;t support catalogs and/or schemas, it may ignore
these criteria.</p>

<p style="margin-left:11%; margin-top: 1em">The statement
handle returned has at least the following fields in the
order shown below. Other fields, after these, may also be
present.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>TABLE_CAT</small></b>
: The catalog identifier. This field is <small>NULL</small>
(<tt>&quot;undef&quot;</tt>) if not applicable to the data
source, which is often the case. This field is empty if not
applicable to the table.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>TABLE_SCHEM</small></b>
: The schema identifier. This field is <small>NULL</small>
(<tt>&quot;undef&quot;</tt>) if not applicable to the data
source, and empty if not applicable to the table.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>TABLE_NAME</small></b>
: The table identifier.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>NON_UNIQUE</small></b>
: Unique index indicator. Returns 0 for unique indexes, 1
for non-unique indexes</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>INDEX_QUALIFIER</small></b>
: Index qualifier identifier. The identifier that is used to
qualify the index name when doing a <tt>&quot;DROP
INDEX&quot;</tt>; <small>NULL</small>
(<tt>&quot;undef&quot;</tt>) is returned if an index
qualifier is not supported by the data source. If a non-NULL
(defined) value is returned in this column, it must be used
to qualify the index name on a <tt>&quot;DROP
INDEX&quot;</tt> statement; otherwise, the
<small>TABLE_SCHEM</small> should be used to qualify the
index name.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>INDEX_NAME</small></b>
: The index identifier.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>TYPE</small></b>
: The type of information being returned. Can be any of the
following values: &rsquo;table&rsquo;, &rsquo;btree&rsquo;,
&rsquo;clustered&rsquo;, &rsquo;content&rsquo;,
&rsquo;hashed&rsquo;, or &rsquo;other&rsquo;.</p>

<p style="margin-left:11%; margin-top: 1em">In the case
that this field is &rsquo;table&rsquo;, all fields other
than <small>TABLE_CAT, TABLE_SCHEM, TABLE_NAME, TYPE,
CARDINALITY,</small> and <small>PAGES</small> will be
<small>NULL</small> (<tt>&quot;undef&quot;</tt>).</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>ORDINAL_POSITION</small></b>
: Column sequence number (starting with 1).</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>COLUMN_NAME</small></b>
: The column identifier.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>ASC_OR_DESC</small></b>
: Column sort sequence. <tt>&quot;A&quot;</tt> for
Ascending, <tt>&quot;D&quot;</tt> for Descending, or
<small>NULL</small> (<tt>&quot;undef&quot;</tt>) if not
supported for this index.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>CARDINALITY</small></b>
: Cardinality of the table or index. For indexes, this is
the number of unique values in the index. For tables, this
is the number of rows in the table. If not supported, the
value will be <small>NULL</small>
(<tt>&quot;undef&quot;</tt>).</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>PAGES</small></b>
: Number of storage pages used by this table or index. If
not supported, the value will be <small>NULL</small>
(<tt>&quot;undef&quot;</tt>).</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>FILTER_CONDITION</small></b>
: The index filter condition as a string. If the index is
not a filtered index, or it cannot be determined whether the
index is a filtered index, this value is <small>NULL</small>
(<tt>&quot;undef&quot;</tt>). If the index is a filtered
index, but the filter condition cannot be determined, this
value is the empty string <tt>''</tt>. Otherwise it will be
the literal filter condition as a string, such as
<tt>&quot;SALARY &lt;= 4500&quot;</tt>.</p>

<p style="margin-left:11%; margin-top: 1em">See also
&quot;Catalog Methods&quot; and &quot;Standards Reference
Information&quot;.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;tables&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  @names = $dbh&minus;&gt;tables( $catalog, $schema, $table, $type );
  @names = $dbh&minus;&gt;tables;        # deprecated</pre>


<p style="margin-left:11%; margin-top: 1em">Simple
interface to <i>table_info()</i>. Returns a list of matching
table names, possibly including a catalog/schema prefix.</p>

<p style="margin-left:11%; margin-top: 1em">See
&quot;table_info&quot; for a description of the
parameters.</p>

<p style="margin-left:11%; margin-top: 1em">If
<tt>&quot;$dbh&minus;&gt;get_info(29)&quot;</tt> returns
true (29 is <small>SQL_IDENTIFIER_QUOTE_CHAR</small> ) then
the table names are constructed and quoted by
&quot;quote_identifier&quot; to ensure they are usable even
if they contain whitespace or reserved words etc. This means
that the table names returned will include quote
characters.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;type_info_all&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  $type_info_all = $dbh&minus;&gt;type_info_all;</pre>


<p style="margin-left:11%; margin-top: 1em">Returns a
reference to an array which holds information about each
data type variant supported by the database and driver. The
array and its contents should be treated as read-only.</p>

<p style="margin-left:11%; margin-top: 1em">The first item
is a reference to an &rsquo;index&rsquo; hash of
<tt>&quot;Name =&quot;</tt>&gt; <tt>&quot;Index&quot;</tt>
pairs. The items following that are references to arrays,
one per supported data type variant. The leading index hash
defines the names and order of the fields within the arrays
that follow it. For example:</p>

<pre style="margin-left:11%; margin-top: 1em">  $type_info_all = [
    {   TYPE_NAME         =&gt; 0,
        DATA_TYPE         =&gt; 1,
        COLUMN_SIZE       =&gt; 2,     # was PRECISION originally
        LITERAL_PREFIX    =&gt; 3,
        LITERAL_SUFFIX    =&gt; 4,
        CREATE_PARAMS     =&gt; 5,
        NULLABLE          =&gt; 6,
        CASE_SENSITIVE    =&gt; 7,
        SEARCHABLE        =&gt; 8,
        UNSIGNED_ATTRIBUTE=&gt; 9,
        FIXED_PREC_SCALE  =&gt; 10,    # was MONEY originally
        AUTO_UNIQUE_VALUE =&gt; 11,    # was AUTO_INCREMENT originally
        LOCAL_TYPE_NAME   =&gt; 12,
        MINIMUM_SCALE     =&gt; 13,
        MAXIMUM_SCALE     =&gt; 14,
        SQL_DATA_TYPE     =&gt; 15,
        SQL_DATETIME_SUB  =&gt; 16,
        NUM_PREC_RADIX    =&gt; 17,
        INTERVAL_PRECISION=&gt; 18,
    },
    [ 'VARCHAR', SQL_VARCHAR,
        undef, &quot;'&quot;,&quot;'&quot;, undef,0, 1,1,0,0,0,undef,1,255, undef
    ],
    [ 'INTEGER', SQL_INTEGER,
        undef,  &quot;&quot;, &quot;&quot;, undef,0, 0,1,0,0,0,undef,0,  0, 10
    ],
  ];</pre>


<p style="margin-left:11%; margin-top: 1em">More than one
row may have the same value in the
<tt>&quot;DATA_TYPE&quot;</tt> field if there are different
ways to spell the type name and/or there are variants of the
type with different attributes (e.g., with and without
<tt>&quot;AUTO_UNIQUE_VALUE&quot;</tt> set, with and without
<tt>&quot;UNSIGNED_ATTRIBUTE&quot;</tt>, etc).</p>

<p style="margin-left:11%; margin-top: 1em">The rows are
ordered by <tt>&quot;DATA_TYPE&quot;</tt> first and then by
how closely each type maps to the corresponding <small>ODBC
SQL</small> data type, closest first.</p>

<p style="margin-left:11%; margin-top: 1em">The meaning of
the fields is described in the documentation for the
&quot;type_info&quot; method.</p>

<p style="margin-left:11%; margin-top: 1em">An
&rsquo;index&rsquo; hash is provided so you don&rsquo;t need
to rely on index values defined above. However, using
<small>DBD::ODBC</small> with some old <small>ODBC</small>
drivers may return older names, shown as comments in the
example above. Another issue with the index hash is that the
lettercase of the keys is not defined. It is usually
uppercase, as show here, but drivers may return names with
any lettercase.</p>

<p style="margin-left:11%; margin-top: 1em">Drivers are
also free to return extra driver-specific columns of
information &minus; though it&rsquo;s recommended that they
start at column index 50 to leave room for expansion of the
<small>DBI/ODBC</small> specification.</p>

<p style="margin-left:11%; margin-top: 1em">The
<i>type_info_all()</i> method is not normally used directly.
The &quot;type_info&quot; method provides a more usable and
useful interface to the data.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;type_info&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  @type_info = $dbh&minus;&gt;type_info($data_type);</pre>


<p style="margin-left:11%; margin-top: 1em">Returns a list
of hash references holding information about one or more
variants of <tt>$data_type</tt>. The list is ordered by
<tt>&quot;DATA_TYPE&quot;</tt> first and then by how closely
each type maps to the corresponding <small>ODBC SQL</small>
data type, closest first. If called in a scalar context then
only the first (best) element is returned.</p>

<p style="margin-left:11%; margin-top: 1em">If
<tt>$data_type</tt> is undefined or
<tt>&quot;SQL_ALL_TYPES&quot;</tt>, then the list will
contain hashes for all data type variants supported by the
database and driver.</p>

<p style="margin-left:11%; margin-top: 1em">If
<tt>$data_type</tt> is an array reference then
<tt>&quot;type_info&quot;</tt> returns the information for
the <i>first</i> type in the array that has any matches.</p>

<p style="margin-left:11%; margin-top: 1em">The keys of the
hash follow the same letter case conventions as the rest of
the <small>DBI</small> (see &quot;Naming Conventions and
Name Space&quot;). The following uppercase items should
always exist, though may be undef: <small><br>
TYPE_NAME</small> (string)</p>

<p style="margin-left:17%;">Data type name for use in
<small>CREATE TABLE</small> statements etc.</p>

<p style="margin-left:11%;"><small>DATA_TYPE</small>
(integer)</p>

<p style="margin-left:17%;"><small>SQL</small> data type
number.</p>

<p style="margin-left:11%;"><small>COLUMN_SIZE</small>
(integer)</p>

<p style="margin-left:17%;">For numeric types, this is
either the total number of digits (if the
<small>NUM_PREC_RADIX</small> value is 10) or the total
number of bits allowed in the column (if
<small>NUM_PREC_RADIX</small> is 2).</p>

<p style="margin-left:17%; margin-top: 1em">For string
types, this is the maximum size of the string in
characters.</p>

<p style="margin-left:17%; margin-top: 1em">For date and
interval types, this is the maximum number of characters
needed to display the value.</p>

<p style="margin-left:11%;"><small>LITERAL_PREFIX</small>
(string)</p>

<p style="margin-left:17%;">Characters used to prefix a
literal. A typical prefix is
&quot;<tt>&quot;'&quot;</tt>&quot; for characters, or
possibly &quot;<tt>&quot;0x&quot;</tt>&quot; for binary
values passed as hexadecimal. <small>NULL</small>
(<tt>&quot;undef&quot;</tt>) is returned for data types for
which this is not applicable.</p>

<p style="margin-left:11%;"><small>LITERAL_SUFFIX</small>
(string)</p>

<p style="margin-left:17%;">Characters used to suffix a
literal. Typically &quot;<tt>&quot;'&quot;</tt>&quot; for
characters. <small>NULL</small> (<tt>&quot;undef&quot;</tt>)
is returned for data types where this is not applicable.</p>

<p style="margin-left:11%;"><small>CREATE_PARAMS</small>
(string)</p>

<p style="margin-left:17%;">Parameter names for data type
definition. For example, <tt>&quot;CREATE_PARAMS&quot;</tt>
for a <tt>&quot;DECIMAL&quot;</tt> would be
&quot;<tt>&quot;precision,scale&quot;</tt>&quot; if the
<small>DECIMAL</small> type should be declared as
<tt>&quot;DECIMAL(&quot;</tt><i>precision,scale</i><tt>&quot;)&quot;</tt>
where <i>precision</i> and <i>scale</i> are integer values.
For a <tt>&quot;VARCHAR&quot;</tt> it would be
&quot;<tt>&quot;max length&quot;</tt>&quot;.
<small>NULL</small> (<tt>&quot;undef&quot;</tt>) is returned
for data types for which this is not applicable.</p>

<p style="margin-left:11%;"><small>NULLABLE</small>
(integer)</p>

<p style="margin-left:17%;">Indicates whether the data type
accepts a <small>NULL</small> value: <tt>0</tt> or an empty
string = no, <tt>1</tt> = yes, <tt>2</tt> = unknown.</p>

<p style="margin-left:11%;"><small>CASE_SENSITIVE</small>
(boolean)</p>

<p style="margin-left:17%;">Indicates whether the data type
is case sensitive in collations and comparisons.</p>

<p style="margin-left:11%;"><small>SEARCHABLE</small>
(integer)</p>

<p style="margin-left:17%;">Indicates how the data type can
be used in a <small>WHERE</small> clause, as follows:</p>

<pre style="margin-left:17%; margin-top: 1em">  0 &minus; Cannot be used in a WHERE clause
  1 &minus; Only with a LIKE predicate
  2 &minus; All comparison operators except LIKE
  3 &minus; Can be used in a WHERE clause with any comparison operator</pre>



<p style="margin-left:11%;"><small>UNSIGNED_ATTRIBUTE</small>
(boolean)</p>

<p style="margin-left:17%;">Indicates whether the data type
is unsigned. <small>NULL</small>
(<tt>&quot;undef&quot;</tt>) is returned for data types for
which this is not applicable.</p>


<p style="margin-left:11%;"><small>FIXED_PREC_SCALE</small>
(boolean)</p>

<p style="margin-left:17%;">Indicates whether the data type
always has the same precision and scale (such as a money
type). <small>NULL</small> (<tt>&quot;undef&quot;</tt>) is
returned for data types for which this is not
applicable.</p>


<p style="margin-left:11%;"><small>AUTO_UNIQUE_VALUE</small>
(boolean)</p>

<p style="margin-left:17%;">Indicates whether a column of
this data type is automatically set to a unique value
whenever a new row is inserted. <small>NULL</small>
(<tt>&quot;undef&quot;</tt>) is returned for data types for
which this is not applicable.</p>

<p style="margin-left:11%;"><small>LOCAL_TYPE_NAME</small>
(string)</p>

<p style="margin-left:17%;">Localized version of the
<tt>&quot;TYPE_NAME&quot;</tt> for use in dialog with users.
<small>NULL</small> (<tt>&quot;undef&quot;</tt>) is returned
if a localized name is not available (in which case
<tt>&quot;TYPE_NAME&quot;</tt> should be used).</p>

<p style="margin-left:11%;"><small>MINIMUM_SCALE</small>
(integer)</p>

<p style="margin-left:17%;">The minimum scale of the data
type. If a data type has a fixed scale, then
<tt>&quot;MAXIMUM_SCALE&quot;</tt> holds the same value.
<small>NULL</small> (<tt>&quot;undef&quot;</tt>) is returned
for data types for which this is not applicable.</p>

<p style="margin-left:11%;"><small>MAXIMUM_SCALE</small>
(integer)</p>

<p style="margin-left:17%;">The maximum scale of the data
type. If a data type has a fixed scale, then
<tt>&quot;MINIMUM_SCALE&quot;</tt> holds the same value.
<small>NULL</small> (<tt>&quot;undef&quot;</tt>) is returned
for data types for which this is not applicable.</p>

<p style="margin-left:11%;"><small>SQL_DATA_TYPE</small>
(integer)</p>

<p style="margin-left:17%;">This column is the same as the
<tt>&quot;DATA_TYPE&quot;</tt> column, except for interval
and datetime data types. For interval and datetime data
types, the <tt>&quot;SQL_DATA_TYPE&quot;</tt> field will
return <tt>&quot;SQL_INTERVAL&quot;</tt> or
<tt>&quot;SQL_DATETIME&quot;</tt>, and the
<tt>&quot;SQL_DATETIME_SUB&quot;</tt> field below will
return the subcode for the specific interval or datetime
data type. If this field is <small>NULL,</small> then the
driver does not support or report on interval or datetime
subtypes.</p>


<p style="margin-left:11%;"><small>SQL_DATETIME_SUB</small>
(integer)</p>

<p style="margin-left:17%;">For interval or datetime data
types, where the <tt>&quot;SQL_DATA_TYPE&quot;</tt> field
above is <tt>&quot;SQL_INTERVAL&quot;</tt> or
<tt>&quot;SQL_DATETIME&quot;</tt>, this field will hold the
<i>subcode</i> for the specific interval or datetime data
type. Otherwise it will be <small>NULL</small>
(<tt>&quot;undef&quot;</tt>).</p>

<p style="margin-left:17%; margin-top: 1em">Although not
mentioned explicitly in the standards, it seems there is a
simple relationship between these values:</p>

<pre style="margin-left:17%; margin-top: 1em">  DATA_TYPE == (10 * SQL_DATA_TYPE) + SQL_DATETIME_SUB</pre>


<p style="margin-left:11%;"><small>NUM_PREC_RADIX</small>
(integer)</p>

<p style="margin-left:17%;">The radix value of the data
type. For approximate numeric types,
<tt>&quot;NUM_PREC_RADIX&quot;</tt> contains the value 2 and
<tt>&quot;COLUMN_SIZE&quot;</tt> holds the number of bits.
For exact numeric types, <tt>&quot;NUM_PREC_RADIX&quot;</tt>
contains the value 10 and <tt>&quot;COLUMN_SIZE&quot;</tt>
holds the number of decimal digits. <small>NULL</small>
(<tt>&quot;undef&quot;</tt>) is returned either for data
types for which this is not applicable or if the driver
cannot report this information.</p>


<p style="margin-left:11%;"><small>INTERVAL_PRECISION</small>
(integer)</p>

<p style="margin-left:17%;">The interval leading precision
for interval types. <small>NULL</small> is returned either
for data types for which this is not applicable or if the
driver cannot report this information.</p>

<p style="margin-left:11%; margin-top: 1em">For example, to
find the type name for the fields in a select statement you
can do:</p>

<pre style="margin-left:11%; margin-top: 1em">  @names = map { scalar $dbh&minus;&gt;type_info($_)&minus;&gt;{TYPE_NAME} } @{ $sth&minus;&gt;{TYPE} }</pre>


<p style="margin-left:11%; margin-top: 1em">Since
<small>DBI</small> and <small>ODBC</small> drivers vary in
how they map their types into the <small>ISO</small>
standard types you may need to search for more than one
type. Here&rsquo;s an example looking for a usable type to
store a date:</p>

<pre style="margin-left:11%; margin-top: 1em">  $my_date_type = $dbh&minus;&gt;type_info( [ SQL_DATE, SQL_TIMESTAMP ] );</pre>


<p style="margin-left:11%; margin-top: 1em">Similarly, to
more reliably find a type to store small integers, you could
use a list starting with <tt>&quot;SQL_SMALLINT&quot;</tt>,
<tt>&quot;SQL_INTEGER&quot;</tt>,
<tt>&quot;SQL_DECIMAL&quot;</tt>, etc.</p>

<p style="margin-left:11%; margin-top: 1em">See also
&quot;Standards Reference Information&quot;.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;quote&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  $sql = $dbh&minus;&gt;quote($value);
  $sql = $dbh&minus;&gt;quote($value, $data_type);</pre>


<p style="margin-left:11%; margin-top: 1em">Quote a string
literal for use as a literal value in an <small>SQL</small>
statement, by escaping any special characters (such as
quotation marks) contained within the string and adding the
required type of outer quotation marks.</p>

<pre style="margin-left:11%; margin-top: 1em">  $sql = sprintf &quot;SELECT foo FROM bar WHERE baz = %s&quot;,
                $dbh&minus;&gt;quote(&quot;Don't&quot;);</pre>


<p style="margin-left:11%; margin-top: 1em">For most
database types, at least those that conform to
<small>SQL</small> standards, quote would return
<tt>'Don''t'</tt> (including the outer quotation marks). For
others it may return something like <tt>'Don\'t'</tt></p>

<p style="margin-left:11%; margin-top: 1em">An undefined
<tt>$value</tt> value will be returned as the string
<tt>&quot;NULL&quot;</tt> (without single quotation marks)
to match how NULLs are represented in
<small>SQL.</small></p>

<p style="margin-left:11%; margin-top: 1em">If
<tt>$data_type</tt> is supplied, it is used to try to
determine the required quoting behaviour by using the
information returned by &quot;type_info&quot;. As a special
case, the standard numeric types are optimized to return
<tt>$value</tt> without calling
<tt>&quot;type_info&quot;</tt>.</p>

<p style="margin-left:11%; margin-top: 1em">Quote will
probably <i>not</i> be able to deal with all possible input
(such as binary data or data containing newlines), and is
not related in any way with escaping or quoting shell
meta-characters.</p>

<p style="margin-left:11%; margin-top: 1em">It is valid for
the <i>quote()</i> method to return an <small>SQL</small>
expression that evaluates to the desired string. For
example:</p>

<pre style="margin-left:11%; margin-top: 1em">  $quoted = $dbh&minus;&gt;quote(&quot;one\ntwo\0three&quot;)</pre>


<p style="margin-left:11%; margin-top: 1em">may return
something like:</p>

<pre style="margin-left:11%; margin-top: 1em">  CONCAT('one', CHAR(12), 'two', CHAR(0), 'three')</pre>


<p style="margin-left:11%; margin-top: 1em">The
<i>quote()</i> method should <i>not</i> be used with
&quot;Placeholders and Bind Values&quot;.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;quote_identifier&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  $sql = $dbh&minus;&gt;quote_identifier( $name );
  $sql = $dbh&minus;&gt;quote_identifier( $catalog, $schema, $table, \%attr );</pre>


<p style="margin-left:11%; margin-top: 1em">Quote an
identifier (table name etc.) for use in an
<small>SQL</small> statement, by escaping any special
characters (such as double quotation marks) it contains and
adding the required type of outer quotation marks.</p>

<p style="margin-left:11%; margin-top: 1em">Undefined names
are ignored and the remainder are quoted and then joined
together, typically with a dot (<tt>&quot;.&quot;</tt>)
character. For example:</p>

<pre style="margin-left:11%; margin-top: 1em">  $id = $dbh&minus;&gt;quote_identifier( undef, 'Her schema', 'My table' );</pre>


<p style="margin-left:11%; margin-top: 1em">would, for most
database types, return <tt>&quot;Her schema&quot;.&quot;My
table&quot;</tt> (including all the double quotation
marks).</p>

<p style="margin-left:11%; margin-top: 1em">If three names
are supplied then the first is assumed to be a catalog name
and special rules may be applied based on what
&quot;get_info&quot; returns for
<small>SQL_CATALOG_NAME_SEPARATOR</small> (41) and
<small>SQL_CATALOG_LOCATION</small> (114). For example, for
Oracle:</p>

<pre style="margin-left:11%; margin-top: 1em">  $id = $dbh&minus;&gt;quote_identifier( 'link', 'schema', 'table' );</pre>


<p style="margin-left:11%; margin-top: 1em">would return
<tt>&quot;schema&quot;.&quot;table&quot;@&quot;link&quot;</tt>.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;take_imp_data&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  $imp_data = $dbh&minus;&gt;take_imp_data;</pre>


<p style="margin-left:11%; margin-top: 1em">Leaves the
<tt>$dbh</tt> in an almost dead, zombie-like, state and
returns a binary string of raw implementation data from the
driver which describes the current database connection.
Effectively it detaches the underlying database
<small>API</small> connection data from the
<small>DBI</small> handle. After calling
<i>take_imp_data()</i>, all other methods except
<tt>&quot;DESTROY&quot;</tt> will generate a warning and
return undef.</p>

<p style="margin-left:11%; margin-top: 1em">Why would you
want to do this? You don&rsquo;t, forget I even mentioned
it. Unless, that is, you&rsquo;re implementing something
advanced like a multi-threaded connection pool. See
DBI::Pool.</p>

<p style="margin-left:11%; margin-top: 1em">The returned
<tt>$imp_data</tt> can be passed as a
<tt>&quot;dbi_imp_data&quot;</tt> attribute to a later
<i>connect()</i> call, even in a separate thread in the same
process, where the driver can use it to &rsquo;adopt&rsquo;
the existing connection that the implementation data was
taken from.</p>

<p style="margin-left:11%; margin-top: 1em">Some things to
keep in mind...</p>

<p style="margin-left:11%; margin-top: 1em"><b>*</b> the
<tt>$imp_data</tt> holds the only reference to the
underlying database <small>API</small> connection data. That
connection is still &rsquo;live&rsquo; and won&rsquo;t be
cleaned up properly unless the <tt>$imp_data</tt> is used to
create a new <tt>$dbh</tt> which is then allowed to
<i>disconnect()</i> normally.</p>

<p style="margin-left:11%; margin-top: 1em"><b>*</b> using
the same <tt>$imp_data</tt> to create more than one other
new <tt>$dbh</tt> at a time may well lead to unpleasant
problems. Don&rsquo;t do that.</p>

<p style="margin-left:11%; margin-top: 1em">Any child
statement handles are effectively destroyed when
<i>take_imp_data()</i> is called.</p>

<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;take_imp_data&quot;</tt> method was added in
<small>DBI 1.36</small> but wasn&rsquo;t useful till
1.49.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Database
Handle Attributes</b> <br>
This section describes attributes specific to database
handles.</p>

<p style="margin-left:11%; margin-top: 1em">Changes to
these database handle attributes do not affect any other
existing or future database handles.</p>

<p style="margin-left:11%; margin-top: 1em">Attempting to
set or get the value of an unknown attribute generates a
warning, except for private driver-specific attributes
(which all have names starting with a lowercase letter).</p>

<p style="margin-left:11%; margin-top: 1em">Example:</p>

<pre style="margin-left:11%; margin-top: 1em">  $h&minus;&gt;{AutoCommit} = ...;       # set/write
  ... = $h&minus;&gt;{AutoCommit};       # get/read</pre>



<p style="margin-left:11%; margin-top: 1em"><i>&quot;AutoCommit&quot;</i></p>

<p style="margin-left:11%; margin-top: 1em">Type:
boolean</p>

<p style="margin-left:11%; margin-top: 1em">If true, then
database changes cannot be rolled-back (undone). If false,
then database changes automatically occur within a
&quot;transaction&quot;, which must either be committed or
rolled back using the <tt>&quot;commit&quot;</tt> or
<tt>&quot;rollback&quot;</tt> methods.</p>

<p style="margin-left:11%; margin-top: 1em">Drivers should
always default to <tt>&quot;AutoCommit&quot;</tt> mode (an
unfortunate choice largely forced on the <small>DBI</small>
by <small>ODBC</small> and <small>JDBC</small>
conventions.)</p>

<p style="margin-left:11%; margin-top: 1em">Attempting to
set <tt>&quot;AutoCommit&quot;</tt> to an unsupported value
is a fatal error. This is an important feature of the
<small>DBI.</small> Applications that need full transaction
behaviour can set <tt>&quot;$dbh&minus;&gt;{AutoCommit} =
0&quot;</tt> (or set <tt>&quot;AutoCommit&quot;</tt> to 0
via &quot;connect&quot;) without having to check that the
value was assigned successfully.</p>

<p style="margin-left:11%; margin-top: 1em">For the
purposes of this description, we can divide databases into
three categories:</p>

<pre style="margin-left:11%; margin-top: 1em">  Databases which don't support transactions at all.
  Databases in which a transaction is always active.
  Databases in which a transaction must be explicitly started (C&lt;'BEGIN WORK'&gt;).</pre>


<p style="margin-left:11%; margin-top: 1em"><b>* Databases
which don&rsquo;t support transactions at all</b></p>

<p style="margin-left:11%; margin-top: 1em">For these
databases, attempting to turn
<tt>&quot;AutoCommit&quot;</tt> off is a fatal error.
<tt>&quot;commit&quot;</tt> and
<tt>&quot;rollback&quot;</tt> both issue warnings about
being ineffective while <tt>&quot;AutoCommit&quot;</tt> is
in effect.</p>

<p style="margin-left:11%; margin-top: 1em"><b>* Databases
in which a transaction is always active</b></p>

<p style="margin-left:11%; margin-top: 1em">These are
typically mainstream commercial relational databases with
&quot; <small>ANSI</small> standard&quot; transaction
behaviour. If <tt>&quot;AutoCommit&quot;</tt> is off, then
changes to the database won&rsquo;t have any lasting effect
unless &quot;commit&quot; is called (but see also
&quot;disconnect&quot;). If &quot;rollback&quot; is called
then any changes since the last commit are undone.</p>

<p style="margin-left:11%; margin-top: 1em">If
<tt>&quot;AutoCommit&quot;</tt> is on, then the effect is
the same as if the <small>DBI</small> called
<tt>&quot;commit&quot;</tt> automatically after every
successful database operation. So calling
<tt>&quot;commit&quot;</tt> or <tt>&quot;rollback&quot;</tt>
explicitly while <tt>&quot;AutoCommit&quot;</tt> is on would
be ineffective because the changes would have already been
committed.</p>

<p style="margin-left:11%; margin-top: 1em">Changing
<tt>&quot;AutoCommit&quot;</tt> from off to on will trigger
a &quot;commit&quot;.</p>

<p style="margin-left:11%; margin-top: 1em">For databases
which don&rsquo;t support a specific auto-commit mode, the
driver has to commit each statement automatically using an
explicit <tt>&quot;COMMIT&quot;</tt> after it completes
successfully (and roll it back using an explicit
<tt>&quot;ROLLBACK&quot;</tt> if it fails). The error
information reported to the application will correspond to
the statement which was executed, unless it succeeded and
the commit or rollback failed.</p>

<p style="margin-left:11%; margin-top: 1em"><b>* Databases
in which a transaction must be explicitly started</b></p>

<p style="margin-left:11%; margin-top: 1em">For these
databases, the intention is to have them act like databases
in which a transaction is always active (as described
above).</p>

<p style="margin-left:11%; margin-top: 1em">To do this, the
driver will automatically begin an explicit transaction when
<tt>&quot;AutoCommit&quot;</tt> is turned off, or after a
&quot;commit&quot; or &quot;rollback&quot; (or when the
application issues the next database operation after one of
those events).</p>

<p style="margin-left:11%; margin-top: 1em">In this way,
the application does not have to treat these databases as a
special case.</p>

<p style="margin-left:11%; margin-top: 1em">See
&quot;commit&quot;, &quot;disconnect&quot; and
&quot;Transactions&quot; for other important notes about
transactions.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;Driver&quot;</i></p>

<p style="margin-left:11%; margin-top: 1em">Type:
handle</p>

<p style="margin-left:11%; margin-top: 1em">Holds the
handle of the parent driver. The only recommended use for
this is to find the name of the driver using:</p>

<pre style="margin-left:11%; margin-top: 1em">  $dbh&minus;&gt;{Driver}&minus;&gt;{Name}</pre>



<p style="margin-left:11%; margin-top: 1em"><i>&quot;Name&quot;</i></p>

<p style="margin-left:11%; margin-top: 1em">Type:
string</p>

<p style="margin-left:11%; margin-top: 1em">Holds the
&quot;name&quot; of the database. Usually (and recommended
to be) the same as the
&quot;<tt>&quot;dbi:DriverName:...&quot;</tt>&quot; string
used to connect to the database, but with the leading
&quot;<tt>&quot;dbi:DriverName:&quot;</tt>&quot;
removed.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;Statement&quot;</i></p>

<p style="margin-left:11%; margin-top: 1em">Type: string,
read-only</p>

<p style="margin-left:11%; margin-top: 1em">Returns the
statement string passed to the most recent
&quot;prepare&quot; or &quot;do&quot; method called in this
database handle, even if that method failed. This is
especially useful where <tt>&quot;RaiseError&quot;</tt> is
enabled and the exception handler checks $@ and sees that a
&rsquo;prepare&rsquo; method call failed.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;RowCacheSize&quot;</i></p>

<p style="margin-left:11%; margin-top: 1em">Type:
integer</p>

<p style="margin-left:11%; margin-top: 1em">A hint to the
driver indicating the size of the local row cache that the
application would like the driver to use for future
<tt>&quot;SELECT&quot;</tt> statements. If a row cache is
not implemented, then setting
<tt>&quot;RowCacheSize&quot;</tt> is ignored and getting the
value returns <tt>&quot;undef&quot;</tt>.</p>

<p style="margin-left:11%; margin-top: 1em">Some
<tt>&quot;RowCacheSize&quot;</tt> values have special
meaning, as follows:</p>

<pre style="margin-left:11%; margin-top: 1em">  0 &minus; Automatically determine a reasonable cache size for each C&lt;SELECT&gt;
  1 &minus; Disable the local row cache
 &gt;1 &minus; Cache this many rows
 &lt;0 &minus; Cache as many rows that will fit into this much memory for each C&lt;SELECT&gt;.</pre>


<p style="margin-left:11%; margin-top: 1em">Note that large
cache sizes may require a very large amount of memory
(<i>cached rows * maximum size of row</i>). Also, a large
cache will cause a longer delay not only for the first
fetch, but also whenever the cache needs refilling.</p>

<p style="margin-left:11%; margin-top: 1em">See also the
&quot;RowsInCache&quot; statement handle attribute.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;Username&quot;</i></p>

<p style="margin-left:11%; margin-top: 1em">Type:
string</p>

<p style="margin-left:11%; margin-top: 1em">Returns the
username used to connect to the database.</p>

<h2>DBI STATEMENT HANDLE OBJECTS
<a name="DBI STATEMENT HANDLE OBJECTS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">This section
lists the methods and attributes associated with
<small>DBI</small> statement handles.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Statement
Handle Methods</b> <br>
The <small>DBI</small> defines the following methods for use
on <small>DBI</small> statement handles:</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;bind_param&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  $sth&minus;&gt;bind_param($p_num, $bind_value)
  $sth&minus;&gt;bind_param($p_num, $bind_value, \%attr)
  $sth&minus;&gt;bind_param($p_num, $bind_value, $bind_type)</pre>


<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;bind_param&quot;</tt> method takes a copy of
<tt>$bind_value</tt> and associates it (binds it) with a
placeholder, identified by <tt>$p_num</tt>, embedded in the
prepared statement. Placeholders are indicated with question
mark character (<tt>&quot;?&quot;</tt>). For example:</p>

<pre style="margin-left:11%; margin-top: 1em">  $dbh&minus;&gt;{RaiseError} = 1;        # save having to check each method call
  $sth = $dbh&minus;&gt;prepare(&quot;SELECT name, age FROM people WHERE name LIKE ?&quot;);
  $sth&minus;&gt;bind_param(1, &quot;John%&quot;);  # placeholders are numbered from 1
  $sth&minus;&gt;execute;
  DBI::dump_results($sth);</pre>


<p style="margin-left:11%; margin-top: 1em">See
&quot;Placeholders and Bind Values&quot; for more
information.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Data Types
for Placeholders</b></p>

<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;\%attr&quot;</tt> parameter can be used to hint at
the data type the placeholder should have. This is rarely
needed. Typically, the driver is only interested in knowing
if the placeholder should be bound as a number or a
string.</p>

<pre style="margin-left:11%; margin-top: 1em">  $sth&minus;&gt;bind_param(1, $value, { TYPE =&gt; SQL_INTEGER });</pre>


<p style="margin-left:11%; margin-top: 1em">As a short-cut
for the common case, the data type can be passed directly,
in place of the <tt>&quot;\%attr&quot;</tt> hash reference.
This example is equivalent to the one above:</p>

<pre style="margin-left:11%; margin-top: 1em">  $sth&minus;&gt;bind_param(1, $value, SQL_INTEGER);</pre>


<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;TYPE&quot;</tt> value indicates the standard
(non-driver-specific) type for this parameter. To specify
the driver-specific type, the driver may support a
driver-specific attribute, such as <tt>&quot;{ ora_type
=&gt; 97 }&quot;</tt>.</p>

<p style="margin-left:11%; margin-top: 1em">The
<small>SQL_INTEGER</small> and other related constants can
be imported using</p>

<pre style="margin-left:11%; margin-top: 1em">  use DBI qw(:sql_types);</pre>


<p style="margin-left:11%; margin-top: 1em">See &quot;
<small>DBI</small> Constants&quot; for more information.</p>

<p style="margin-left:11%; margin-top: 1em">The data type
is &rsquo;sticky&rsquo; in that bind values passed to
<i>execute()</i> are bound with the data type specified by
earlier <i>bind_param()</i> calls, if any. Portable
applications should not rely on being able to change the
data type after the first <tt>&quot;bind_param&quot;</tt>
call.</p>

<p style="margin-left:11%; margin-top: 1em">Perl only has
string and number scalar data types. All database types that
aren&rsquo;t numbers are bound as strings and must be in a
format the database will understand except where the
<i>bind_param()</i> <small>TYPE</small> attribute specifies
a type that implies a particular format. For example,
given:</p>

<pre style="margin-left:11%; margin-top: 1em">  $sth&minus;&gt;bind_param(1, $value, SQL_DATETIME);</pre>


<p style="margin-left:11%; margin-top: 1em">the driver
should expect <tt>$value</tt> to be in the
<small>ODBC</small> standard <small>SQL_DATETIME</small>
format, which is &rsquo; <small>YYYY&minus;MM&minus;DD
HH:MM:SS</small> &rsquo;. Similarly for <small>SQL_DATE,
SQL_TIME</small> etc.</p>

<p style="margin-left:11%; margin-top: 1em">As an
alternative to specifying the data type in the
<tt>&quot;bind_param&quot;</tt> call, you can let the driver
pass the value as the default type
(<tt>&quot;VARCHAR&quot;</tt>). You can then use an
<small>SQL</small> function to convert the type within the
statement. For example:</p>

<pre style="margin-left:11%; margin-top: 1em">  INSERT INTO price(code, price) VALUES (?, CONVERT(MONEY,?))</pre>


<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;CONVERT&quot;</tt> function used here is just an
example. The actual function and syntax will vary between
different databases and is non-portable.</p>

<p style="margin-left:11%; margin-top: 1em">See also
&quot;Placeholders and Bind Values&quot; for more
information.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;bind_param_inout&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  $rc = $sth&minus;&gt;bind_param_inout($p_num, \$bind_value, $max_len)  or die $sth&minus;&gt;errstr;
  $rv = $sth&minus;&gt;bind_param_inout($p_num, \$bind_value, $max_len, \%attr)     or ...
  $rv = $sth&minus;&gt;bind_param_inout($p_num, \$bind_value, $max_len, $bind_type) or ...</pre>


<p style="margin-left:11%; margin-top: 1em">This method
acts like &quot;bind_param&quot;, but also enables values to
be updated by the statement. The statement is typically a
call to a stored procedure. The <tt>$bind_value</tt> must be
passed as a reference to the actual value to be used.</p>

<p style="margin-left:11%; margin-top: 1em">Note that
unlike &quot;bind_param&quot;, the <tt>$bind_value</tt>
variable is not copied when
<tt>&quot;bind_param_inout&quot;</tt> is called. Instead,
the value in the variable is read at the time
&quot;execute&quot; is called.</p>

<p style="margin-left:11%; margin-top: 1em">The additional
<tt>$max_len</tt> parameter specifies the minimum amount of
memory to allocate to <tt>$bind_value</tt> for the new
value. If the value returned from the database is too big to
fit, then the execution should fail. If unsure what value to
use, pick a generous length, i.e., a length larger than the
longest value that would ever be returned. The only cost of
using a larger value than needed is wasted memory.</p>

<p style="margin-left:11%; margin-top: 1em">Undefined
values or <tt>&quot;undef&quot;</tt> are used to indicate
null values. See also &quot;Placeholders and Bind
Values&quot; for more information.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;bind_param_array&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  $rc = $sth&minus;&gt;bind_param_array($p_num, $array_ref_or_value)
  $rc = $sth&minus;&gt;bind_param_array($p_num, $array_ref_or_value, \%attr)
  $rc = $sth&minus;&gt;bind_param_array($p_num, $array_ref_or_value, $bind_type)</pre>


<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;bind_param_array&quot;</tt> method is used to bind
an array of values to a placeholder embedded in the prepared
statement which is to be executed with
&quot;execute_array&quot;. For example:</p>

<pre style="margin-left:11%; margin-top: 1em">  $dbh&minus;&gt;{RaiseError} = 1;        # save having to check each method call
  $sth = $dbh&minus;&gt;prepare(&quot;INSERT INTO staff (first_name, last_name, dept) VALUES(?, ?, ?)&quot;);
  $sth&minus;&gt;bind_param_array(1, [ 'John', 'Mary', 'Tim' ]);
  $sth&minus;&gt;bind_param_array(2, [ 'Booth', 'Todd', 'Robinson' ]);
  $sth&minus;&gt;bind_param_array(3, &quot;SALES&quot;); # scalar will be reused for each row
  $sth&minus;&gt;execute_array( { ArrayTupleStatus =&gt; \my @tuple_status } );</pre>


<p style="margin-left:11%; margin-top: 1em">The
<tt>%attr</tt> ($bind_type) argument is the same as defined
for &quot;bind_param&quot;. Refer to &quot;bind_param&quot;
for general details on using placeholders.</p>

<p style="margin-left:11%; margin-top: 1em">(Note that
<i>bind_param_array()</i> can <i>not</i> be used to expand a
placeholder into a list of values for a statement like
&quot; <small>SELECT</small> foo <small>WHERE</small> bar
<small>IN</small> (?)&quot;. A placeholder can only ever
represent one value per execution.)</p>

<p style="margin-left:11%; margin-top: 1em">Scalar values,
including <tt>&quot;undef&quot;</tt>, may also be bound by
<tt>&quot;bind_param_array&quot;</tt>. In which case the
same value will be used for each &quot;execute&quot; call.
Driver-specific implementations may behave differently,
e.g., when binding to a stored procedure call, some
databases may permit mixing scalars and arrays as
arguments.</p>

<p style="margin-left:11%; margin-top: 1em">The default
implementation provided by <small>DBI</small> (for drivers
that have not implemented array binding) is to iteratively
call &quot;execute&quot; for each parameter tuple provided
in the bound arrays. Drivers may provide more optimized
implementations using whatever bulk operation support the
database <small>API</small> provides. The default driver
behaviour should match the default <small>DBI</small>
behaviour, but always consult your driver documentation as
there may be driver specific issues to consider.</p>

<p style="margin-left:11%; margin-top: 1em">Note that the
default implementation currently only supports non-data
returning statements ( <small>INSERT, UPDATE,</small> but
not <small>SELECT</small> ). Also,
<tt>&quot;bind_param_array&quot;</tt> and
&quot;bind_param&quot; cannot be mixed in the same statement
execution, and <tt>&quot;bind_param_array&quot;</tt> must be
used with &quot;execute_array&quot;; using
<tt>&quot;bind_param_array&quot;</tt> will have no effect
for &quot;execute&quot;.</p>

<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;bind_param_array&quot;</tt> method was added in
<small>DBI 1.22.</small></p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;execute&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  $rv = $sth&minus;&gt;execute                or die $sth&minus;&gt;errstr;
  $rv = $sth&minus;&gt;execute(@bind_values)  or die $sth&minus;&gt;errstr;</pre>


<p style="margin-left:11%; margin-top: 1em">Perform
whatever processing is necessary to execute the prepared
statement. An <tt>&quot;undef&quot;</tt> is returned if an
error occurs. A successful <tt>&quot;execute&quot;</tt>
always returns true regardless of the number of rows
affected, even if it&rsquo;s zero (see below). It is always
important to check the return status of
<tt>&quot;execute&quot;</tt> (and most other
<small>DBI</small> methods) for errors if you&rsquo;re not
using &quot;RaiseError&quot;.</p>

<p style="margin-left:11%; margin-top: 1em">For a
<i>non</i>&minus;<tt>&quot;SELECT&quot;</tt> statement,
<tt>&quot;execute&quot;</tt> returns the number of rows
affected, if known. If no rows were affected, then
<tt>&quot;execute&quot;</tt> returns
&quot;<tt>0E0</tt>&quot;, which Perl will treat as 0 but
will regard as true. Note that it is <i>not</i> an error for
no rows to be affected by a statement. If the number of rows
affected is not known, then <tt>&quot;execute&quot;</tt>
returns &minus;1.</p>

<p style="margin-left:11%; margin-top: 1em">For
<tt>&quot;SELECT&quot;</tt> statements, execute simply
&quot;starts&quot; the query within the database engine. Use
one of the fetch methods to retrieve the data after calling
<tt>&quot;execute&quot;</tt>. The
<tt>&quot;execute&quot;</tt> method does <i>not</i> return
the number of rows that will be returned by the query
(because most databases can&rsquo;t tell in advance), it
simply returns a true value.</p>

<p style="margin-left:11%; margin-top: 1em">You can tell if
the statement was a <tt>&quot;SELECT&quot;</tt> statement by
checking if
<tt>&quot;$sth&minus;&gt;{NUM_OF_FIELDS}&quot;</tt> is
greater than zero after calling
<tt>&quot;execute&quot;</tt>.</p>

<p style="margin-left:11%; margin-top: 1em">If any
arguments are given, then <tt>&quot;execute&quot;</tt> will
effectively call &quot;bind_param&quot; for each value
before executing the statement. Values bound in this way are
usually treated as <tt>&quot;SQL_VARCHAR&quot;</tt> types
unless the driver can determine the correct type (which is
rare), or unless <tt>&quot;bind_param&quot;</tt> (or
<tt>&quot;bind_param_inout&quot;</tt>) has already been used
to specify the type.</p>

<p style="margin-left:11%; margin-top: 1em">Note that
passing <tt>&quot;execute&quot;</tt> an empty array is the
same as passing no arguments at all, which will execute the
statement with previously bound values. That&rsquo;s
probably not what you want.</p>

<p style="margin-left:11%; margin-top: 1em">If
<i>execute()</i> is called on a statement handle
that&rsquo;s still active ($sth&minus;&gt;{Active} is true)
then it should effectively call <i>finish()</i> to tidy up
the previous execution results before starting this new
execution.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;execute_array&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  $tuples = $sth&minus;&gt;execute_array(\%attr) or die $sth&minus;&gt;errstr;
  $tuples = $sth&minus;&gt;execute_array(\%attr, @bind_values) or die $sth&minus;&gt;errstr;
  ($tuples, $rows) = $sth&minus;&gt;execute_array(\%attr) or die $sth&minus;&gt;errstr;
  ($tuples, $rows) = $sth&minus;&gt;execute_array(\%attr, @bind_values) or die $sth&minus;&gt;errstr;</pre>


<p style="margin-left:11%; margin-top: 1em">Execute the
prepared statement once for each parameter tuple (group of
values) provided either in the <tt>@bind_values</tt>, or by
prior calls to &quot;bind_param_array&quot;, or via a
reference passed in \%attr.</p>

<p style="margin-left:11%; margin-top: 1em">When called in
scalar context the <i>execute_array()</i> method returns the
number of tuples executed, or <tt>&quot;undef&quot;</tt> if
an error occurred. Like <i>execute()</i>, a successful
<i>execute_array()</i> always returns true regardless of the
number of tuples executed, even if it&rsquo;s zero. If there
were any errors the ArrayTupleStatus array can be used to
discover which tuples failed and with what errors.</p>

<p style="margin-left:11%; margin-top: 1em">When called in
list context the <i>execute_array()</i> method returns two
scalars; <tt>$tuples</tt> is the same as calling
<i>execute_array()</i> in scalar context and <tt>$rows</tt>
is the number of rows affected for each tuple, if available
or &minus;1 if the driver cannot determine this.
<small>NOTE,</small> some drivers cannot determine the
number of rows affected per tuple but can provide the number
of rows affected for the batch. If you are doing an update
operation the returned rows affected may not be what you
expect if, for instance, one or more of the tuples affected
the same row multiple times. Some drivers may not yet
support list context, in which case <tt>$rows</tt> will be
undef, or may not be able to provide the number of rows
affected when performing this batch operation, in which case
<tt>$rows</tt> will be &minus;1.</p>

<p style="margin-left:11%; margin-top: 1em">Bind values for
the tuples to be executed may be supplied row-wise by an
<tt>&quot;ArrayTupleFetch&quot;</tt> attribute, or else
column-wise in the <tt>@bind_values</tt> argument, or else
column-wise by prior calls to
&quot;bind_param_array&quot;.</p>

<p style="margin-left:11%; margin-top: 1em">Where
column-wise binding is used (via the <tt>@bind_values</tt>
argument or calls to <i>bind_param_array()</i>) the maximum
number of elements in any one of the bound value arrays
determines the number of tuples executed. Placeholders with
fewer values in their parameter arrays are treated as if
padded with undef ( <small>NULL</small> ) values.</p>

<p style="margin-left:11%; margin-top: 1em">If a scalar
value is bound, instead of an array reference, it is treated
as a <i>variable</i> length array with all elements having
the same value. It does not influence the number of tuples
executed, so if all bound arrays have zero elements then
zero tuples will be executed. If <i>all</i> bound values are
scalars then one tuple will be executed, making
<i>execute_array()</i> act just like <i>execute()</i>.</p>

<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;ArrayTupleFetch&quot;</tt> attribute can be used
to specify a reference to a subroutine that will be called
to provide the bind values for each tuple execution. The
subroutine should return an reference to an array which
contains the appropriate number of bind values, or return an
undef if there is no more data to execute.</p>

<p style="margin-left:11%; margin-top: 1em">As a
convenience, the <tt>&quot;ArrayTupleFetch&quot;</tt>
attribute can also be used to specify a statement handle. In
which case the <i>fetchrow_arrayref()</i> method will be
called on the given statement handle in order to provide the
bind values for each tuple execution.</p>

<p style="margin-left:11%; margin-top: 1em">The values
specified via <i>bind_param_array()</i> or the
<tt>@bind_values</tt> parameter may be either scalars, or
arrayrefs. If any <tt>@bind_values</tt> are given, then
<tt>&quot;execute_array&quot;</tt> will effectively call
&quot;bind_param_array&quot; for each value before executing
the statement. Values bound in this way are usually treated
as <tt>&quot;SQL_VARCHAR&quot;</tt> types unless the driver
can determine the correct type (which is rare), or unless
<tt>&quot;bind_param&quot;</tt>,
<tt>&quot;bind_param_inout&quot;</tt>,
<tt>&quot;bind_param_array&quot;</tt>, or
<tt>&quot;bind_param_inout_array&quot;</tt> has already been
used to specify the type. See &quot;bind_param_array&quot;
for details.</p>

<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;ArrayTupleStatus&quot;</tt> attribute can be used
to specify a reference to an array which will receive the
execute status of each executed parameter tuple. Note the
<tt>&quot;ArrayTupleStatus&quot;</tt> attribute was
mandatory until <small>DBI 1.38.</small></p>

<p style="margin-left:11%; margin-top: 1em">For tuples
which are successfully executed, the element at the same
ordinal position in the status array is the resulting
rowcount (or &minus;1 if unknown). If the execution of a
tuple causes an error, then the corresponding status array
element will be set to a reference to an array containing
&quot;err&quot;, &quot;errstr&quot; and &quot;state&quot;
set by the failed execution.</p>

<p style="margin-left:11%; margin-top: 1em">If <b>any</b>
tuple execution returns an error,
<tt>&quot;execute_array&quot;</tt> will return
<tt>&quot;undef&quot;</tt>. In that case, the application
should inspect the status array to determine which parameter
tuples failed. Some databases may not continue executing
tuples beyond the first failure. In this case the status
array will either hold fewer elements, or the elements
beyond the failure will be undef.</p>

<p style="margin-left:11%; margin-top: 1em">If all
parameter tuples are successfully executed,
<tt>&quot;execute_array&quot;</tt> returns the number tuples
executed. If no tuples were executed, then
<i>execute_array()</i> returns &quot;<tt>0E0</tt>&quot;,
just like <i>execute()</i> does, which Perl will treat as 0
but will regard as true.</p>

<p style="margin-left:11%; margin-top: 1em">For
example:</p>

<pre style="margin-left:11%; margin-top: 1em">  $sth = $dbh&minus;&gt;prepare(&quot;INSERT INTO staff (first_name, last_name) VALUES (?, ?)&quot;);
  my $tuples = $sth&minus;&gt;execute_array(
      { ArrayTupleStatus =&gt; \my @tuple_status },
      \@first_names,
      \@last_names,
  );
  if ($tuples) {
      print &quot;Successfully inserted $tuples records\n&quot;;
  }
  else {
      for my $tuple (0..@last_names&minus;1) {
          my $status = $tuple_status[$tuple];
          $status = [0, &quot;Skipped&quot;] unless defined $status;
          next unless ref $status;
          printf &quot;Failed to insert (%s, %s): %s\n&quot;,
              $first_names[$tuple], $last_names[$tuple], $status&minus;&gt;[1];
      }
  }</pre>


<p style="margin-left:11%; margin-top: 1em">Support for
data returning statements such as <small>SELECT</small> is
driver-specific and subject to change. At present, the
default implementation provided by <small>DBI</small> only
supports non-data returning statements.</p>

<p style="margin-left:11%; margin-top: 1em">Transaction
semantics when using array binding are driver and database
specific. If <tt>&quot;AutoCommit&quot;</tt> is on, the
default <small>DBI</small> implementation will cause each
parameter tuple to be individually committed (or rolled back
in the event of an error). If
<tt>&quot;AutoCommit&quot;</tt> is off, the application is
responsible for explicitly committing the entire set of
bound parameter tuples. Note that different drivers and
databases may have different behaviours when some parameter
tuples cause failures. In some cases, the driver or database
may automatically rollback the effect of all prior parameter
tuples that succeeded in the transaction; other drivers or
databases may retain the effect of prior successfully
executed parameter tuples. Be sure to check your driver and
database for its specific behaviour.</p>

<p style="margin-left:11%; margin-top: 1em">Note that, in
general, performance will usually be better with
<tt>&quot;AutoCommit&quot;</tt> turned off, and using
explicit <tt>&quot;commit&quot;</tt> after each
<tt>&quot;execute_array&quot;</tt> call.</p>

<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;execute_array&quot;</tt> method was added in
<small>DBI 1.22,</small> and ArrayTupleFetch was added in
1.36.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;execute_for_fetch&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  $tuples = $sth&minus;&gt;execute_for_fetch($fetch_tuple_sub);
  $tuples = $sth&minus;&gt;execute_for_fetch($fetch_tuple_sub, \@tuple_status);
  ($tuples, $rows) = $sth&minus;&gt;execute_for_fetch($fetch_tuple_sub);
  ($tuples, $rows) = $sth&minus;&gt;execute_for_fetch($fetch_tuple_sub, \@tuple_status);</pre>


<p style="margin-left:11%; margin-top: 1em">The
<i>execute_for_fetch()</i> method is used to perform bulk
operations and although it is most often used via the
<i>execute_array()</i> method you can use it directly. The
main difference between execute_array and execute_for_fetch
is the former does column or row-wise binding and the latter
uses row-wise binding.</p>

<p style="margin-left:11%; margin-top: 1em">The fetch
subroutine, referenced by <tt>$fetch_tuple_sub</tt>, is
expected to return a reference to an array (known as a
&rsquo;tuple&rsquo;) or undef.</p>

<p style="margin-left:11%; margin-top: 1em">The
<i>execute_for_fetch()</i> method calls
<tt>$fetch_tuple_sub</tt>, without any parameters, until it
returns a false value. Each tuple returned is used to
provide bind values for an
<tt>$sth</tt>&minus;&gt;execute(@$tuple) call.</p>

<p style="margin-left:11%; margin-top: 1em">In scalar
context <i>execute_for_fetch()</i> returns
<tt>&quot;undef&quot;</tt> if there were any errors and the
number of tuples executed otherwise. Like <i>execute()</i>
and <i>execute_array()</i> a zero is returned as
&quot;0E0&quot; so <i>execute_for_fetch()</i> is only false
on error. If there were any errors the
<tt>@tuple_status</tt> array can be used to discover which
tuples failed and with what errors.</p>

<p style="margin-left:11%; margin-top: 1em">When called in
list context <i>execute_for_fetch()</i> returns two scalars;
<tt>$tuples</tt> is the same as calling
<i>execute_for_fetch()</i> in scalar context and
<tt>$rows</tt> is the sum of the number of rows affected for
each tuple, if available or &minus;1 if the driver cannot
determine this. If you are doing an update operation the
returned rows affected may not be what you expect if, for
instance, one or more of the tuples affected the same row
multiple times. Some drivers may not yet support list
context, in which case <tt>$rows</tt> will be undef, or may
not be able to provide the number of rows affected when
performing this batch operation, in which case
<tt>$rows</tt> will be &minus;1.</p>

<p style="margin-left:11%; margin-top: 1em">If
\@tuple_status is passed then the execute_for_fetch method
uses it to return status information. The tuple_status array
holds one element per tuple. If the corresponding
<i>execute()</i> did not fail then the element holds the
return value from <i>execute()</i>, which is typically a row
count. If the <i>execute()</i> did fail then the element
holds a reference to an array containing
($sth&minus;&gt;err, <tt>$sth</tt>&minus;&gt;errstr,
<tt>$sth</tt>&minus;&gt;state).</p>

<p style="margin-left:11%; margin-top: 1em">If the driver
detects an error that it knows means no further tuples can
be executed then it may return, with an error status, even
though <tt>$fetch_tuple_sub</tt> may still have more tuples
to be executed.</p>

<p style="margin-left:11%; margin-top: 1em">Although each
tuple returned by <tt>$fetch_tuple_sub</tt> is effectively
used to call
<tt>$sth</tt>&minus;&gt;execute(@$tuple_array_ref) the exact
timing may vary. Drivers are free to accumulate sets of
tuples to pass to the database server in bulk group
operations for more efficient execution. However, the
<tt>$fetch_tuple_sub</tt> is specifically allowed to return
the same array reference each time (which is what
<i>fetchrow_arrayref()</i> usually does).</p>

<p style="margin-left:11%; margin-top: 1em">For
example:</p>

<pre style="margin-left:11%; margin-top: 1em">  my $sel = $dbh1&minus;&gt;prepare(&quot;select foo, bar from table1&quot;);
  $sel&minus;&gt;execute;
  my $ins = $dbh2&minus;&gt;prepare(&quot;insert into table2 (foo, bar) values (?,?)&quot;);
  my $fetch_tuple_sub = sub { $sel&minus;&gt;fetchrow_arrayref };
  my @tuple_status;
  $rc = $ins&minus;&gt;execute_for_fetch($fetch_tuple_sub, \@tuple_status);
  my @errors = grep { ref $_ } @tuple_status;</pre>


<p style="margin-left:11%; margin-top: 1em">Similarly, if
you already have an array containing the data rows to be
processed you&rsquo;d use a subroutine to shift off and
return each array ref in turn:</p>

<pre style="margin-left:11%; margin-top: 1em">  $ins&minus;&gt;execute_for_fetch( sub { shift @array_of_arrays }, \@tuple_status);</pre>


<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;execute_for_fetch&quot;</tt> method was added in
<small>DBI 1.38.</small></p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;fetchrow_arrayref&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  $ary_ref = $sth&minus;&gt;fetchrow_arrayref;
  $ary_ref = $sth&minus;&gt;fetch;    # alias</pre>


<p style="margin-left:11%; margin-top: 1em">Fetches the
next row of data and returns a reference to an array holding
the field values. Null fields are returned as
<tt>&quot;undef&quot;</tt> values in the array. This is the
fastest way to fetch data, particularly if used with
<tt>&quot;$sth&minus;&gt;bind_columns&quot;</tt>.</p>

<p style="margin-left:11%; margin-top: 1em">If there are no
more rows or if an error occurs, then
<tt>&quot;fetchrow_arrayref&quot;</tt> returns an
<tt>&quot;undef&quot;</tt>. You should check
<tt>&quot;$sth&minus;&gt;err&quot;</tt> afterwards (or use
the <tt>&quot;RaiseError&quot;</tt> attribute) to discover
if the <tt>&quot;undef&quot;</tt> returned was due to an
error.</p>

<p style="margin-left:11%; margin-top: 1em">Note that the
same array reference is returned for each fetch, so
don&rsquo;t store the reference and then use it after a
later fetch. Also, the elements of the array are also reused
for each row, so take care if you want to take a reference
to an element. See also &quot;bind_columns&quot;.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;fetchrow_array&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em"> @ary = $sth&minus;&gt;fetchrow_array;</pre>


<p style="margin-left:11%; margin-top: 1em">An alternative
to <tt>&quot;fetchrow_arrayref&quot;</tt>. Fetches the next
row of data and returns it as a list containing the field
values. Null fields are returned as
<tt>&quot;undef&quot;</tt> values in the list.</p>

<p style="margin-left:11%; margin-top: 1em">If there are no
more rows or if an error occurs, then
<tt>&quot;fetchrow_array&quot;</tt> returns an empty list.
You should check <tt>&quot;$sth&minus;&gt;err&quot;</tt>
afterwards (or use the <tt>&quot;RaiseError&quot;</tt>
attribute) to discover if the empty list returned was due to
an error.</p>

<p style="margin-left:11%; margin-top: 1em">If called in a
scalar context for a statement handle that has more than one
column, it is undefined whether the driver will return the
value of the first column or the last. So don&rsquo;t do
that. Also, in a scalar context, an
<tt>&quot;undef&quot;</tt> is returned if there are no more
rows or if an error occurred. That
<tt>&quot;undef&quot;</tt> can&rsquo;t be distinguished from
an <tt>&quot;undef&quot;</tt> returned because the first
field value was <small>NULL.</small> For these reasons you
should exercise some caution if you use
<tt>&quot;fetchrow_array&quot;</tt> in a scalar context.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;fetchrow_hashref&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em"> $hash_ref = $sth&minus;&gt;fetchrow_hashref;
 $hash_ref = $sth&minus;&gt;fetchrow_hashref($name);</pre>


<p style="margin-left:11%; margin-top: 1em">An alternative
to <tt>&quot;fetchrow_arrayref&quot;</tt>. Fetches the next
row of data and returns it as a reference to a hash
containing field name and field value pairs. Null fields are
returned as <tt>&quot;undef&quot;</tt> values in the
hash.</p>

<p style="margin-left:11%; margin-top: 1em">If there are no
more rows or if an error occurs, then
<tt>&quot;fetchrow_hashref&quot;</tt> returns an
<tt>&quot;undef&quot;</tt>. You should check
<tt>&quot;$sth&minus;&gt;err&quot;</tt> afterwards (or use
the <tt>&quot;RaiseError&quot;</tt> attribute) to discover
if the <tt>&quot;undef&quot;</tt> returned was due to an
error.</p>

<p style="margin-left:11%; margin-top: 1em">The optional
<tt>$name</tt> parameter specifies the name of the statement
handle attribute. For historical reasons it defaults to
&quot;<tt>&quot;NAME&quot;</tt>&quot;, however using either
&quot;<tt>&quot;NAME_lc&quot;</tt>&quot; or
&quot;<tt>&quot;NAME_uc&quot;</tt>&quot; is recommended for
portability.</p>

<p style="margin-left:11%; margin-top: 1em">The keys of the
hash are the same names returned by
<tt>&quot;$sth&minus;&gt;{$name}&quot;</tt>. If more than
one field has the same name, there will only be one entry in
the returned hash for those fields, so statements like
&quot;<tt>&quot;select foo, foo from bar&quot;</tt>&quot;
will return only a single key from
<tt>&quot;fetchrow_hashref&quot;</tt>. In these cases use
column aliases or <tt>&quot;fetchrow_arrayref&quot;</tt>.
Note that it is the database server (and not the
<small>DBD</small> implementation) which provides the
<i>name</i> for fields containing functions like
&quot;<tt>count(*)</tt>&quot; or
&quot;<tt>&quot;max(c_foo)&quot;</tt>&quot; and they may
clash with existing column names (most databases don&rsquo;t
care about duplicate column names in a result-set). If you
want these to return as unique names that are the same
across databases, use <i>aliases</i>, as in
&quot;<tt>&quot;select count(*) as cnt&quot;</tt>&quot; or
&quot;<tt>&quot;select max(c_foo) mx_foo,
...&quot;</tt>&quot; depending on the syntax your database
supports.</p>

<p style="margin-left:11%; margin-top: 1em">Because of the
extra work <tt>&quot;fetchrow_hashref&quot;</tt> and Perl
have to perform, it is not as efficient as
<tt>&quot;fetchrow_arrayref&quot;</tt> or
<tt>&quot;fetchrow_array&quot;</tt>.</p>

<p style="margin-left:11%; margin-top: 1em">By default a
reference to a new hash is returned for each row. It is
likely that a future version of the <small>DBI</small> will
support an attribute which will enable the same hash to be
reused for each row. This will give a significant
performance boost, but it won&rsquo;t be enabled by default
because of the risk of breaking old code.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;fetchall_arrayref&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  $tbl_ary_ref = $sth&minus;&gt;fetchall_arrayref;
  $tbl_ary_ref = $sth&minus;&gt;fetchall_arrayref( $slice );
  $tbl_ary_ref = $sth&minus;&gt;fetchall_arrayref( $slice, $max_rows  );</pre>


<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;fetchall_arrayref&quot;</tt> method can be used to
fetch all the data to be returned from a prepared and
executed statement handle. It returns a reference to an
array that contains one reference per row.</p>

<p style="margin-left:11%; margin-top: 1em">If called on an
<i>inactive</i> statement handle,
<tt>&quot;fetchall_arrayref&quot;</tt> returns undef.</p>

<p style="margin-left:11%; margin-top: 1em">If there are no
rows left to return from an <i>active</i> statement handle,
<tt>&quot;fetchall_arrayref&quot;</tt> returns a reference
to an empty array. If an error occurs,
<tt>&quot;fetchall_arrayref&quot;</tt> returns the data
fetched thus far, which may be none. You should check
<tt>&quot;$sth&minus;&gt;err&quot;</tt> afterwards (or use
the <tt>&quot;RaiseError&quot;</tt> attribute) to discover
if the data is complete or was truncated due to an
error.</p>

<p style="margin-left:11%; margin-top: 1em">If
<tt>$slice</tt> is an array reference,
<tt>&quot;fetchall_arrayref&quot;</tt> uses
&quot;fetchrow_arrayref&quot; to fetch each row as an array
ref. If the <tt>$slice</tt> array is not empty then it is
used as a slice to select individual columns by perl array
index number (starting at 0, unlike column and parameter
numbers which start at 1).</p>

<p style="margin-left:11%; margin-top: 1em">With no
parameters, or if <tt>$slice</tt> is undefined,
<tt>&quot;fetchall_arrayref&quot;</tt> acts as if passed an
empty array ref.</p>

<p style="margin-left:11%; margin-top: 1em">For example, to
fetch just the first column of every row:</p>

<pre style="margin-left:11%; margin-top: 1em">  $tbl_ary_ref = $sth&minus;&gt;fetchall_arrayref([0]);</pre>


<p style="margin-left:11%; margin-top: 1em">To fetch the
second to last and last column of every row:</p>

<pre style="margin-left:11%; margin-top: 1em">  $tbl_ary_ref = $sth&minus;&gt;fetchall_arrayref([&minus;2,&minus;1]);</pre>


<p style="margin-left:11%; margin-top: 1em">Those two
examples both return a reference to an array of array
refs.</p>

<p style="margin-left:11%; margin-top: 1em">If
<tt>$slice</tt> is a hash reference,
<tt>&quot;fetchall_arrayref&quot;</tt> fetches each row as a
hash reference. If the <tt>$slice</tt> hash is empty then
the keys in the hashes have whatever name lettercase is
returned by default. (See &quot;FetchHashKeyName&quot;
attribute.) If the <tt>$slice</tt> hash is <i>not</i> empty,
then it is used as a slice to select individual columns by
name. The values of the hash should be set to 1. The key
names of the returned hashes match the letter case of the
names in the parameter hash, regardless of the
&quot;FetchHashKeyName&quot; attribute.</p>

<p style="margin-left:11%; margin-top: 1em">For example, to
fetch all fields of every row as a hash ref:</p>

<pre style="margin-left:11%; margin-top: 1em">  $tbl_ary_ref = $sth&minus;&gt;fetchall_arrayref({});</pre>


<p style="margin-left:11%; margin-top: 1em">To fetch only
the fields called &quot;foo&quot; and &quot;bar&quot; of
every row as a hash ref (with keys named &quot;foo&quot; and
&quot; <small>BAR&quot;,</small> regardless of the original
capitalization):</p>

<pre style="margin-left:11%; margin-top: 1em">  $tbl_ary_ref = $sth&minus;&gt;fetchall_arrayref({ foo=&gt;1, BAR=&gt;1 });</pre>


<p style="margin-left:11%; margin-top: 1em">Those two
examples both return a reference to an array of hash
refs.</p>

<p style="margin-left:11%; margin-top: 1em">If
<tt>$slice</tt> is a <i>reference to a hash reference</i>,
that hash is used to select and rename columns. The keys are
0&minus;based column index numbers and the values are the
corresponding keys for the returned row hashes.</p>

<p style="margin-left:11%; margin-top: 1em">For example, to
fetch only the first and second columns of every row as a
hash ref (with keys named &quot;k&quot; and &quot;v&quot;
regardless of their original names):</p>

<pre style="margin-left:11%; margin-top: 1em">  $tbl_ary_ref = $sth&minus;&gt;fetchall_arrayref( \{ 0 =&gt; 'k', 1 =&gt; 'v' } );</pre>


<p style="margin-left:11%; margin-top: 1em">If
<tt>$max_rows</tt> is defined and greater than or equal to
zero then it is used to limit the number of rows fetched
before returning. <i>fetchall_arrayref()</i> can then be
called again to fetch more rows. This is especially useful
when you need the better performance of
<i>fetchall_arrayref()</i> but don&rsquo;t have enough
memory to fetch and return all the rows in one go.</p>

<p style="margin-left:11%; margin-top: 1em">Here&rsquo;s an
example (assumes RaiseError is enabled):</p>

<pre style="margin-left:11%; margin-top: 1em">  my $rows = []; # cache for batches of rows
  while( my $row = ( shift(@$rows) || # get row from cache, or reload cache:
                     shift(@{$rows=$sth&minus;&gt;fetchall_arrayref(undef,10_000)||[]}) )
  ) {
    ...
  }</pre>


<p style="margin-left:11%; margin-top: 1em">That
<i>might</i> be the fastest way to fetch and process lots of
rows using the <small>DBI,</small> but it depends on the
relative cost of method calls vs memory allocation.</p>

<p style="margin-left:11%; margin-top: 1em">A standard
<tt>&quot;while&quot;</tt> loop with column binding is often
faster because the cost of allocating memory for the batch
of rows is greater than the saving by reducing method calls.
It&rsquo;s possible that the <small>DBI</small> may provide
a way to reuse the memory of a previous batch in future,
which would then shift the balance back towards
<i>fetchall_arrayref()</i>.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;fetchall_hashref&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  $hash_ref = $sth&minus;&gt;fetchall_hashref($key_field);</pre>


<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;fetchall_hashref&quot;</tt> method can be used to
fetch all the data to be returned from a prepared and
executed statement handle. It returns a reference to a hash
containing a key for each distinct value of the
<tt>$key_field</tt> column that was fetched. For each key
the corresponding value is a reference to a hash containing
all the selected columns and their values, as returned by
<tt>&quot;fetchrow_hashref()&quot;</tt>.</p>

<p style="margin-left:11%; margin-top: 1em">If there are no
rows to return, <tt>&quot;fetchall_hashref&quot;</tt>
returns a reference to an empty hash. If an error occurs,
<tt>&quot;fetchall_hashref&quot;</tt> returns the data
fetched thus far, which may be none. You should check
<tt>&quot;$sth&minus;&gt;err&quot;</tt> afterwards (or use
the <tt>&quot;RaiseError&quot;</tt> attribute) to discover
if the data is complete or was truncated due to an
error.</p>

<p style="margin-left:11%; margin-top: 1em">The
<tt>$key_field</tt> parameter provides the name of the field
that holds the value to be used for the key for the returned
hash. For example:</p>

<pre style="margin-left:11%; margin-top: 1em">  $dbh&minus;&gt;{FetchHashKeyName} = 'NAME_lc';
  $sth = $dbh&minus;&gt;prepare(&quot;SELECT FOO, BAR, ID, NAME, BAZ FROM TABLE&quot;);
  $sth&minus;&gt;execute;
  $hash_ref = $sth&minus;&gt;fetchall_hashref('id');
  print &quot;Name for id 42 is $hash_ref&minus;&gt;{42}&minus;&gt;{name}\n&quot;;</pre>


<p style="margin-left:11%; margin-top: 1em">The
<tt>$key_field</tt> parameter can also be specified as an
integer column number (counting from 1). If
<tt>$key_field</tt> doesn&rsquo;t match any column in the
statement, as a name first then as a number, then an error
is returned.</p>

<p style="margin-left:11%; margin-top: 1em">For queries
returning more than one &rsquo;key&rsquo; column, you can
specify multiple column names by passing <tt>$key_field</tt>
as a reference to an array containing one or more key column
names (or index numbers). For example:</p>

<pre style="margin-left:11%; margin-top: 1em">  $sth = $dbh&minus;&gt;prepare(&quot;SELECT foo, bar, baz FROM table&quot;);
  $sth&minus;&gt;execute;
  $hash_ref = $sth&minus;&gt;fetchall_hashref( [ qw(foo bar) ] );
  print &quot;For foo 42 and bar 38, baz is $hash_ref&minus;&gt;{42}&minus;&gt;{38}&minus;&gt;{baz}\n&quot;;</pre>


<p style="margin-left:11%; margin-top: 1em">The
<i>fetchall_hashref()</i> method is normally used only where
the key fields values for each row are unique. If multiple
rows are returned with the same values for the key fields
then later rows overwrite earlier ones.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;finish&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  $rc  = $sth&minus;&gt;finish;</pre>


<p style="margin-left:11%; margin-top: 1em">Indicate that
no more data will be fetched from this statement handle
before it is either executed again or destroyed. You almost
certainly do <i>not</i> need to call this method.</p>

<p style="margin-left:11%; margin-top: 1em">Adding calls to
<tt>&quot;finish&quot;</tt> after loop that fetches all rows
is a common mistake, don&rsquo;t do it, it can mask genuine
problems like uncaught fetch errors.</p>

<p style="margin-left:11%; margin-top: 1em">When all the
data has been fetched from a <tt>&quot;SELECT&quot;</tt>
statement, the driver will automatically call
<tt>&quot;finish&quot;</tt> for you. So you should
<i>not</i> call it explicitly <i>except</i> when you know
that you&rsquo;ve not fetched all the data from a statement
handle <i>and</i> the handle won&rsquo;t be destroyed
soon.</p>

<p style="margin-left:11%; margin-top: 1em">The most common
example is when you only want to fetch just one row, but in
that case the <tt>&quot;selectrow_*&quot;</tt> methods are
usually better anyway.</p>

<p style="margin-left:11%; margin-top: 1em">Consider a
query like:</p>

<pre style="margin-left:11%; margin-top: 1em">  SELECT foo FROM table WHERE bar=? ORDER BY baz</pre>


<p style="margin-left:11%; margin-top: 1em">on a very large
table. When executed, the database server will have to use
temporary buffer space to store the sorted rows. If, after
executing the handle and selecting just a few rows, the
handle won&rsquo;t be re-executed for some time and
won&rsquo;t be destroyed, the <tt>&quot;finish&quot;</tt>
method can be used to tell the server that the buffer space
can be freed.</p>

<p style="margin-left:11%; margin-top: 1em">Calling
<tt>&quot;finish&quot;</tt> resets the &quot;Active&quot;
attribute for the statement. It may also make some statement
handle attributes (such as <tt>&quot;NAME&quot;</tt> and
<tt>&quot;TYPE&quot;</tt>) unavailable if they have not
already been accessed (and thus cached).</p>

<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;finish&quot;</tt> method does not affect the
transaction status of the database connection. It has
nothing to do with transactions. It&rsquo;s mostly an
internal &quot;housekeeping&quot; method that is rarely
needed. See also &quot;disconnect&quot; and the
&quot;Active&quot; attribute.</p>

<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;finish&quot;</tt> method should have been called
<tt>&quot;discard_pending_rows&quot;</tt>.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;rows&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  $rv = $sth&minus;&gt;rows;</pre>


<p style="margin-left:11%; margin-top: 1em">Returns the
number of rows affected by the last row affecting command,
or &minus;1 if the number of rows is not known or not
available.</p>

<p style="margin-left:11%; margin-top: 1em">Generally, you
can only rely on a row count after a
<i>non</i>&minus;<tt>&quot;SELECT&quot;
&quot;execute&quot;</tt> (for some specific operations like
<tt>&quot;UPDATE&quot;</tt> and
<tt>&quot;DELETE&quot;</tt>), or after fetching all the rows
of a <tt>&quot;SELECT&quot;</tt> statement.</p>

<p style="margin-left:11%; margin-top: 1em">For
<tt>&quot;SELECT&quot;</tt> statements, it is generally not
possible to know how many rows will be returned except by
fetching them all. Some drivers will return the number of
rows the application has fetched so far, but others may
return &minus;1 until all rows have been fetched. So use of
the <tt>&quot;rows&quot;</tt> method or <tt>$DBI::rows</tt>
with <tt>&quot;SELECT&quot;</tt> statements is not
recommended.</p>

<p style="margin-left:11%; margin-top: 1em">One alternative
method to get a row count for a <tt>&quot;SELECT&quot;</tt>
is to execute a &quot; <small>SELECT COUNT</small> (*)
<small>FROM ...&quot; SQL</small> statement with the same
&quot;...&quot; as your query and then fetch the row count
from that.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;bind_col&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  $rc = $sth&minus;&gt;bind_col($column_number, \$var_to_bind);
  $rc = $sth&minus;&gt;bind_col($column_number, \$var_to_bind, \%attr );
  $rc = $sth&minus;&gt;bind_col($column_number, \$var_to_bind, $bind_type );</pre>


<p style="margin-left:11%; margin-top: 1em">Binds a Perl
variable and/or some attributes to an output column (field)
of a <tt>&quot;SELECT&quot;</tt> statement. Column numbers
count up from 1. You do not need to bind output columns in
order to fetch data. For maximum portability between
drivers, <i>bind_col()</i> should be called after
<i>execute()</i> and not before. See also
&quot;bind_columns&quot; for an example.</p>

<p style="margin-left:11%; margin-top: 1em">The binding is
performed at a low level using Perl aliasing. Whenever a row
is fetched from the database <tt>$var_to_bind</tt> appears
to be automatically updated simply because it now refers to
the same memory location as the corresponding column value.
This makes using bound variables very efficient. Binding a
tied variable doesn&rsquo;t work, currently.</p>

<p style="margin-left:11%; margin-top: 1em">The
&quot;bind_param&quot; method performs a similar, but
opposite, function for input variables.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Data Types
for Column Binding</b></p>

<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;\%attr&quot;</tt> parameter can be used to hint at
the data type formatting the column should have. For
example, you can use:</p>

<pre style="margin-left:11%; margin-top: 1em">  $sth&minus;&gt;bind_col(1, undef, { TYPE =&gt; SQL_DATETIME });</pre>


<p style="margin-left:11%; margin-top: 1em">to specify that
you&rsquo;d like the column (which presumably is some kind
of datetime type) to be returned in the standard format for
<small>SQL_DATETIME,</small> which is &rsquo;
<small>YYYY&minus;MM&minus;DD HH:MM:SS</small> &rsquo;,
rather than the native formatting the database would
normally use.</p>

<p style="margin-left:11%; margin-top: 1em">There&rsquo;s
no <tt>$var_to_bind</tt> in that example to emphasize the
point that <i>bind_col()</i> works on the underlying column
and not just a particular bound variable.</p>

<p style="margin-left:11%; margin-top: 1em">As a short-cut
for the common case, the data type can be passed directly,
in place of the <tt>&quot;\%attr&quot;</tt> hash reference.
This example is equivalent to the one above:</p>

<pre style="margin-left:11%; margin-top: 1em">  $sth&minus;&gt;bind_col(1, undef, SQL_DATETIME);</pre>


<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;TYPE&quot;</tt> value indicates the standard
(non-driver-specific) type for this parameter. To specify
the driver-specific type, the driver may support a
driver-specific attribute, such as <tt>&quot;{ ora_type
=&gt; 97 }&quot;</tt>.</p>

<p style="margin-left:11%; margin-top: 1em">The
<small>SQL_DATETIME</small> and other related constants can
be imported using</p>

<pre style="margin-left:11%; margin-top: 1em">  use DBI qw(:sql_types);</pre>


<p style="margin-left:11%; margin-top: 1em">See &quot;
<small>DBI</small> Constants&quot; for more information.</p>

<p style="margin-left:11%; margin-top: 1em">Few drivers
support specifying a data type via a
<tt>&quot;bind_col&quot;</tt> call (most will simply ignore
the data type). Fewer still allow the data type to be
altered once set.</p>

<p style="margin-left:11%; margin-top: 1em">The
<small>TYPE</small> attribute for <i>bind_col()</i> was
first specified in <small>DBI 1.41.</small></p>

<p style="margin-left:11%; margin-top: 1em">From <small>DBI
1.611,</small> drivers can use the <tt>&quot;TYPE&quot;</tt>
attribute to attempt to cast the bound scalar to a perl type
which more closely matches <tt>&quot;TYPE&quot;</tt>. At
present <small>DBI</small> supports
<tt>&quot;SQL_INTEGER&quot;</tt>,
<tt>&quot;SQL_DOUBLE&quot;</tt> and
<tt>&quot;SQL_NUMERIC&quot;</tt>. See
&quot;sql_type_cast&quot; for details of how types are
cast.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Other
attributes for Column Binding</b></p>

<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;\%attr&quot;</tt> parameter may also contain the
following attributes: <br>
&quot;StrictlyTyped&quot;</p>

<p style="margin-left:17%;">If a <tt>&quot;TYPE&quot;</tt>
attribute is passed to bind_col, then the driver will
attempt to change the bound perl scalar to match the type
more closely. If the bound value cannot be cast to the
requested <tt>&quot;TYPE&quot;</tt> then by default it is
left untouched and no error is generated. If you specify
<tt>&quot;StrictlyTyped&quot;</tt> as 1 and the cast fails,
this will generate an error.</p>

<p style="margin-left:17%; margin-top: 1em">This attribute
was first added in <small>DBI 1.611.</small> When 1.611 was
released few drivers actually supported this attribute but
DBD::Oracle and <small>DBD::ODBC</small> should from
versions 1.24.</p>

<p style="margin-left:11%;">&quot;DiscardString&quot;</p>

<p style="margin-left:17%;">When the
<tt>&quot;TYPE&quot;</tt> attribute is passed to
&quot;bind_col&quot; and the driver successfully casts the
bound perl scalar to a non-string type then if
<tt>&quot;DiscardString&quot;</tt> is set to 1, the string
portion of the scalar will be discarded. By default,
<tt>&quot;DiscardString&quot;</tt> is not set.</p>

<p style="margin-left:17%; margin-top: 1em">This attribute
was first added in <small>DBI 1.611.</small> When 1.611 was
released few drivers actually supported this attribute but
DBD::Oracle and <small>DBD::ODBC</small> should from
versions 1.24.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;bind_columns&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  $rc = $sth&minus;&gt;bind_columns(@list_of_refs_to_vars_to_bind);</pre>


<p style="margin-left:11%; margin-top: 1em">Calls
&quot;bind_col&quot; for each column of the
<tt>&quot;SELECT&quot;</tt> statement.</p>

<p style="margin-left:11%; margin-top: 1em">The list of
references should have the same number of elements as the
number of columns in the <tt>&quot;SELECT&quot;</tt>
statement. If it doesn&rsquo;t then
<tt>&quot;bind_columns&quot;</tt> will bind the elements
given, up to the number of columns, and then return an
error.</p>

<p style="margin-left:11%; margin-top: 1em">For maximum
portability between drivers, <i>bind_columns()</i> should be
called after <i>execute()</i> and not before.</p>

<p style="margin-left:11%; margin-top: 1em">For
example:</p>

<pre style="margin-left:11%; margin-top: 1em">  $dbh&minus;&gt;{RaiseError} = 1; # do this, or check every call for errors
  $sth = $dbh&minus;&gt;prepare(q{ SELECT region, sales FROM sales_by_region });
  $sth&minus;&gt;execute;
  my ($region, $sales);
  # Bind Perl variables to columns:
  $rv = $sth&minus;&gt;bind_columns(\$region, \$sales);
  # you can also use Perl's \(...) syntax (see perlref docs):
  #     $sth&minus;&gt;bind_columns(\($region, $sales));
  # Column binding is the most efficient way to fetch data
  while ($sth&minus;&gt;fetch) {
      print &quot;$region: $sales\n&quot;;
  }</pre>


<p style="margin-left:11%; margin-top: 1em">For
compatibility with old scripts, the first parameter will be
ignored if it is <tt>&quot;undef&quot;</tt> or a hash
reference.</p>

<p style="margin-left:11%; margin-top: 1em">Here&rsquo;s a
more fancy example that binds columns to the values
<i>inside</i> a hash (thanks to H.Merijn Brand):</p>

<pre style="margin-left:11%; margin-top: 1em">  $sth&minus;&gt;execute;
  my %row;
  $sth&minus;&gt;bind_columns( \( @row{ @{$sth&minus;&gt;{NAME_lc} } } ));
  while ($sth&minus;&gt;fetch) {
      print &quot;$row{region}: $row{sales}\n&quot;;
  }</pre>



<p style="margin-left:11%; margin-top: 1em"><i>&quot;dump_results&quot;</i></p>


<pre style="margin-left:11%; margin-top: 1em">  $rows = $sth&minus;&gt;dump_results($maxlen, $lsep, $fsep, $fh);</pre>


<p style="margin-left:11%; margin-top: 1em">Fetches all the
rows from <tt>$sth</tt>, calls
<tt>&quot;DBI::neat_list&quot;</tt> for each row, and prints
the results to <tt>$fh</tt> (defaults to
<tt>&quot;STDOUT&quot;</tt>) separated by <tt>$lsep</tt>
(default <tt>&quot;\n&quot;</tt>). <tt>$fsep</tt> defaults
to <tt>&quot;, &quot;</tt> and <tt>$maxlen</tt> defaults to
35.</p>

<p style="margin-left:11%; margin-top: 1em">This method is
designed as a handy utility for prototyping and testing
queries. Since it uses &quot;neat_list&quot; to format and
edit the string for reading by humans, it is not recommended
for data transfer applications.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Statement
Handle Attributes</b> <br>
This section describes attributes specific to statement
handles. Most of these attributes are read-only.</p>

<p style="margin-left:11%; margin-top: 1em">Changes to
these statement handle attributes do not affect any other
existing or future statement handles.</p>

<p style="margin-left:11%; margin-top: 1em">Attempting to
set or get the value of an unknown attribute generates a
warning, except for private driver specific attributes
(which all have names starting with a lowercase letter).</p>

<p style="margin-left:11%; margin-top: 1em">Example:</p>

<pre style="margin-left:11%; margin-top: 1em">  ... = $h&minus;&gt;{NUM_OF_FIELDS};    # get/read</pre>


<p style="margin-left:11%; margin-top: 1em">Some drivers
cannot provide valid values for some or all of these
attributes until after
<tt>&quot;$sth&minus;&gt;execute&quot;</tt> has been
successfully called. Typically the attribute will be
<tt>&quot;undef&quot;</tt> in these situations.</p>

<p style="margin-left:11%; margin-top: 1em">Some
attributes, like <small>NAME,</small> are not appropriate to
some types of statement, like <small>SELECT.</small>
Typically the attribute will be <tt>&quot;undef&quot;</tt>
in these situations.</p>

<p style="margin-left:11%; margin-top: 1em">For drivers
which support stored procedures and multiple result sets
(see &quot;more_results&quot;) these attributes relate to
the <i>current</i> result set.</p>

<p style="margin-left:11%; margin-top: 1em">See also
&quot;finish&quot; to learn more about the effect it may
have on some attributes.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;NUM_OF_FIELDS&quot;</i></p>

<p style="margin-left:11%; margin-top: 1em">Type: integer,
read-only</p>

<p style="margin-left:11%; margin-top: 1em">Number of
fields (columns) in the data the prepared statement may
return. Statements that don&rsquo;t return rows of data,
like <tt>&quot;DELETE&quot;</tt> and
<tt>&quot;CREATE&quot;</tt> set
<tt>&quot;NUM_OF_FIELDS&quot;</tt> to 0 (though it may be
undef in some drivers).</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;NUM_OF_PARAMS&quot;</i></p>

<p style="margin-left:11%; margin-top: 1em">Type: integer,
read-only</p>

<p style="margin-left:11%; margin-top: 1em">The number of
parameters (placeholders) in the prepared statement. See
<small>SUBSTITUTION VARIABLES</small> below for more
details.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;NAME&quot;</i></p>

<p style="margin-left:11%; margin-top: 1em">Type:
array-ref, read-only</p>

<p style="margin-left:11%; margin-top: 1em">Returns a
reference to an array of field names for each column. The
names may contain spaces but should not be truncated or have
any trailing space. Note that the names have the letter case
(upper, lower or mixed) as returned by the driver being
used. Portable applications should use &quot;NAME_lc&quot;
or &quot;NAME_uc&quot;.</p>

<pre style="margin-left:11%; margin-top: 1em">  print &quot;First column name: $sth&minus;&gt;{NAME}&minus;&gt;[0]\n&quot;;</pre>


<p style="margin-left:11%; margin-top: 1em">Also note that
the name returned for (aggregate) functions like
<tt>count(*)</tt> or <tt>&quot;max(c_foo)&quot;</tt> is
determined by the database server and not by
<tt>&quot;DBI&quot;</tt> or the <tt>&quot;DBD&quot;</tt>
backend.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;NAME_lc&quot;</i></p>

<p style="margin-left:11%; margin-top: 1em">Type:
array-ref, read-only</p>

<p style="margin-left:11%; margin-top: 1em">Like
<tt>&quot;/NAME&quot;</tt> but always returns lowercase
names.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;NAME_uc&quot;</i></p>

<p style="margin-left:11%; margin-top: 1em">Type:
array-ref, read-only</p>

<p style="margin-left:11%; margin-top: 1em">Like
<tt>&quot;/NAME&quot;</tt> but always returns uppercase
names.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;NAME_hash&quot;</i></p>

<p style="margin-left:11%; margin-top: 1em">Type: hash-ref,
read-only</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;NAME_lc_hash&quot;</i></p>

<p style="margin-left:11%; margin-top: 1em">Type: hash-ref,
read-only</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;NAME_uc_hash&quot;</i></p>

<p style="margin-left:11%; margin-top: 1em">Type: hash-ref,
read-only</p>

<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;NAME_hash&quot;</tt>,
<tt>&quot;NAME_lc_hash&quot;</tt>, and
<tt>&quot;NAME_uc_hash&quot;</tt> attributes return column
name information as a reference to a hash.</p>

<p style="margin-left:11%; margin-top: 1em">The keys of the
hash are the names of the columns. The letter case of the
keys corresponds to the letter case returned by the
<tt>&quot;NAME&quot;</tt>, <tt>&quot;NAME_lc&quot;</tt>, and
<tt>&quot;NAME_uc&quot;</tt> attributes respectively (as
described above).</p>

<p style="margin-left:11%; margin-top: 1em">The value of
each hash entry is the perl index number of the
corresponding column (counting from 0). For example:</p>

<pre style="margin-left:11%; margin-top: 1em">  $sth = $dbh&minus;&gt;prepare(&quot;select Id, Name from table&quot;);
  $sth&minus;&gt;execute;
  @row = $sth&minus;&gt;fetchrow_array;
  print &quot;Name $row[ $sth&minus;&gt;{NAME_lc_hash}{name} ]\n&quot;;</pre>



<p style="margin-left:11%; margin-top: 1em"><i>&quot;TYPE&quot;</i></p>

<p style="margin-left:11%; margin-top: 1em">Type:
array-ref, read-only</p>

<p style="margin-left:11%; margin-top: 1em">Returns a
reference to an array of integer values for each column. The
value indicates the data type of the corresponding
column.</p>

<p style="margin-left:11%; margin-top: 1em">The values
correspond to the international standards ( <small>ANSI
X3.135</small> and <small>ISO/IEC 9075</small> ) which, in
general terms, means <small>ODBC.</small> Driver-specific
types that don&rsquo;t exactly match standard types should
generally return the same values as an <small>ODBC</small>
driver supplied by the makers of the database. That might
include private type numbers in ranges the vendor has
officially registered with the <small>ISO</small> working
group:</p>

<pre style="margin-left:11%; margin-top: 1em">  ftp://sqlstandards.org/SC32/SQL_Registry/</pre>


<p style="margin-left:11%; margin-top: 1em">Where
there&rsquo;s no vendor-supplied <small>ODBC</small> driver
to be compatible with, the <small>DBI</small> driver can use
type numbers in the range that is now officially reserved
for use by the <small>DBI: &minus;9999</small> to
&minus;9000.</p>

<p style="margin-left:11%; margin-top: 1em">All possible
values for <tt>&quot;TYPE&quot;</tt> should have at least
one entry in the output of the
<tt>&quot;type_info_all&quot;</tt> method (see
&quot;type_info_all&quot;).</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;PRECISION&quot;</i></p>

<p style="margin-left:11%; margin-top: 1em">Type:
array-ref, read-only</p>

<p style="margin-left:11%; margin-top: 1em">Returns a
reference to an array of integer values for each column.</p>

<p style="margin-left:11%; margin-top: 1em">For numeric
columns, the value is the maximum number of digits (without
considering a sign character or decimal point). Note that
the &quot;display size&quot; for floating point types (
<small>REAL, FLOAT, DOUBLE</small> ) can be up to 7
characters greater than the precision (for the sign +
decimal point + the letter E + a sign + 2 or 3 digits).</p>

<p style="margin-left:11%; margin-top: 1em">For any
character type column the value is the
<small>OCTET_LENGTH,</small> in other words the number of
bytes, not characters.</p>

<p style="margin-left:11%; margin-top: 1em">(More recent
standards refer to this as <small>COLUMN_SIZE</small> but we
stick with <small>PRECISION</small> for backwards
compatibility.)</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;SCALE&quot;</i></p>

<p style="margin-left:11%; margin-top: 1em">Type:
array-ref, read-only</p>

<p style="margin-left:11%; margin-top: 1em">Returns a
reference to an array of integer values for each column.
<small>NULL</small> (<tt>&quot;undef&quot;</tt>) values
indicate columns where scale is not applicable.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;NULLABLE&quot;</i></p>

<p style="margin-left:11%; margin-top: 1em">Type:
array-ref, read-only</p>

<p style="margin-left:11%; margin-top: 1em">Returns a
reference to an array indicating the possibility of each
column returning a null. Possible values are <tt>0</tt> (or
an empty string) = no, <tt>1</tt> = yes, <tt>2</tt> =
unknown.</p>

<pre style="margin-left:11%; margin-top: 1em">  print &quot;First column may return NULL\n&quot; if $sth&minus;&gt;{NULLABLE}&minus;&gt;[0];</pre>



<p style="margin-left:11%; margin-top: 1em"><i>&quot;CursorName&quot;</i></p>

<p style="margin-left:11%; margin-top: 1em">Type: string,
read-only</p>

<p style="margin-left:11%; margin-top: 1em">Returns the
name of the cursor associated with the statement handle, if
available. If not available or if the database driver does
not support the <tt>&quot;where current of ...&quot;</tt>
<small>SQL</small> syntax, then it returns
<tt>&quot;undef&quot;</tt>.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;Database&quot;</i></p>

<p style="margin-left:11%; margin-top: 1em">Type: dbh,
read-only</p>

<p style="margin-left:11%; margin-top: 1em">Returns the
parent <tt>$dbh</tt> of the statement handle.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;Statement&quot;</i></p>

<p style="margin-left:11%; margin-top: 1em">Type: string,
read-only</p>

<p style="margin-left:11%; margin-top: 1em">Returns the
statement string passed to the &quot;prepare&quot;
method.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;ParamValues&quot;</i></p>

<p style="margin-left:11%; margin-top: 1em">Type: hash ref,
read-only</p>

<p style="margin-left:11%; margin-top: 1em">Returns a
reference to a hash containing the values currently bound to
placeholders. The keys of the hash are the
&rsquo;names&rsquo; of the placeholders, typically integers
starting at 1. Returns undef if not supported by the
driver.</p>

<p style="margin-left:11%; margin-top: 1em">See
&quot;ShowErrorStatement&quot; for an example of how this is
used.</p>

<p style="margin-left:11%; margin-top: 1em">* Keys:</p>

<p style="margin-left:11%; margin-top: 1em">If the driver
supports <tt>&quot;ParamValues&quot;</tt> but no values have
been bound yet then the driver should return a hash with
placeholders names in the keys but all the values undef, but
some drivers may return a ref to an empty hash because they
can&rsquo;t pre-determine the names.</p>

<p style="margin-left:11%; margin-top: 1em">It is possible
that the keys in the hash returned by
<tt>&quot;ParamValues&quot;</tt> are not exactly the same as
those implied by the prepared statement. For example,
DBD::Oracle translates &rsquo;<tt>&quot;?&quot;</tt>&rsquo;
placeholders into &rsquo;<tt>&quot;:pN&quot;</tt>&rsquo;
where N is a sequence number starting at 1.</p>

<p style="margin-left:11%; margin-top: 1em">* Values:</p>

<p style="margin-left:11%; margin-top: 1em">It is possible
that the values in the hash returned by
<tt>&quot;ParamValues&quot;</tt> are not <i>exactly</i> the
same as those passed to <i>bind_param()</i> or
<i>execute()</i>. The driver may have slightly modified
values in some way based on the <small>TYPE</small> the
value was bound with. For example a floating point value
bound as an <small>SQL_INTEGER</small> type may be returned
as an integer. The values returned by
<tt>&quot;ParamValues&quot;</tt> can be passed to another
<i>bind_param()</i> method with the same <small>TYPE</small>
and will be seen by the database as the same value. See also
&quot;ParamTypes&quot; below.</p>

<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;ParamValues&quot;</tt> attribute was added in
<small>DBI 1.28.</small></p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;ParamTypes&quot;</i></p>

<p style="margin-left:11%; margin-top: 1em">Type: hash ref,
read-only</p>

<p style="margin-left:11%; margin-top: 1em">Returns a
reference to a hash containing the type information
currently bound to placeholders. Returns undef if not
supported by the driver.</p>

<p style="margin-left:11%; margin-top: 1em">* Keys:</p>

<p style="margin-left:11%; margin-top: 1em">See
&quot;ParamValues&quot; above.</p>

<p style="margin-left:11%; margin-top: 1em">* Values:</p>

<p style="margin-left:11%; margin-top: 1em">The hash values
are hashrefs of type information in the same form as that
passed to the various <i>bind_param()</i> methods (See
&quot;bind_param&quot; for the format and values).</p>

<p style="margin-left:11%; margin-top: 1em">It is possible
that the values in the hash returned by
<tt>&quot;ParamTypes&quot;</tt> are not exactly the same as
those passed to <i>bind_param()</i> or <i>execute()</i>.
Param attributes specified using the abbreviated form, like
this:</p>

<pre style="margin-left:11%; margin-top: 1em">    $sth&minus;&gt;bind_param(1, SQL_INTEGER);</pre>


<p style="margin-left:11%; margin-top: 1em">are returned in
the expanded form, as if called like this:</p>

<pre style="margin-left:11%; margin-top: 1em">    $sth&minus;&gt;bind_param(1, { TYPE =&gt; SQL_INTEGER });</pre>


<p style="margin-left:11%; margin-top: 1em">The driver may
have modified the type information in some way based on the
bound values, other hints provided by the
<i>prepare()</i>&rsquo;d <small>SQL</small> statement, or
alternate type mappings required by the driver or target
database system. The driver may also add private keys (with
names beginning with the drivers reserved prefix, e.g.,
odbc_xxx).</p>

<p style="margin-left:11%; margin-top: 1em">* Example:</p>

<p style="margin-left:11%; margin-top: 1em">The keys and
values in the returned hash can be passed to the various
<i>bind_param()</i> methods to effectively reproduce a
previous param binding. For example:</p>

<pre style="margin-left:11%; margin-top: 1em">  # assuming $sth1 is a previously prepared statement handle
  my $sth2 = $dbh&minus;&gt;prepare( $sth1&minus;&gt;{Statement} );
  my $ParamValues = $sth1&minus;&gt;{ParamValues} || {};
  my $ParamTypes  = $sth1&minus;&gt;{ParamTypes}  || {};
  $sth2&minus;&gt;bind_param($_, $ParamValues&minus;&gt;{$_} $ParamTypes&minus;&gt;{$_})
    for keys %{ {%$ParamValues, %$ParamTypes} };
  $sth2&minus;&gt;execute();</pre>


<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;ParamTypes&quot;</tt> attribute was added in
<small>DBI 1.49.</small> Implementation is the
responsibility of individual drivers; the <small>DBI</small>
layer default implementation simply returns undef.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;ParamArrays&quot;</i></p>

<p style="margin-left:11%; margin-top: 1em">Type: hash ref,
read-only</p>

<p style="margin-left:11%; margin-top: 1em">Returns a
reference to a hash containing the values currently bound to
placeholders with &quot;execute_array&quot; or
&quot;bind_param_array&quot;. The keys of the hash are the
&rsquo;names&rsquo; of the placeholders, typically integers
starting at 1. Returns undef if not supported by the driver
or no arrays of parameters are bound.</p>

<p style="margin-left:11%; margin-top: 1em">Each key value
is an array reference containing a list of the bound
parameters for that column.</p>

<p style="margin-left:11%; margin-top: 1em">For
example:</p>

<pre style="margin-left:11%; margin-top: 1em">  $sth = $dbh&minus;&gt;prepare(&quot;INSERT INTO staff (id, name) values (?,?)&quot;);
  $sth&minus;&gt;execute_array({},[1,2], ['fred','dave']);
  if ($sth&minus;&gt;{ParamArrays}) {
      foreach $param (keys %{$sth&minus;&gt;{ParamArrays}}) {
          printf &quot;Parameters for %s : %s\n&quot;, $param,
          join(&quot;,&quot;, @{$sth&minus;&gt;{ParamArrays}&minus;&gt;{$param}});
      }
  }</pre>


<p style="margin-left:11%; margin-top: 1em">It is possible
that the values in the hash returned by
<tt>&quot;ParamArrays&quot;</tt> are not <i>exactly</i> the
same as those passed to &quot;bind_param_array&quot; or
&quot;execute_array&quot;. The driver may have slightly
modified values in some way based on the <small>TYPE</small>
the value was bound with. For example a floating point value
bound as an <small>SQL_INTEGER</small> type may be returned
as an integer.</p>

<p style="margin-left:11%; margin-top: 1em">It is also
possible that the keys in the hash returned by
<tt>&quot;ParamArrays&quot;</tt> are not exactly the same as
those implied by the prepared statement. For example,
DBD::Oracle translates &rsquo;<tt>&quot;?&quot;</tt>&rsquo;
placeholders into &rsquo;<tt>&quot;:pN&quot;</tt>&rsquo;
where N is a sequence number starting at 1.</p>


<p style="margin-left:11%; margin-top: 1em"><i>&quot;RowsInCache&quot;</i></p>

<p style="margin-left:11%; margin-top: 1em">Type: integer,
read-only</p>

<p style="margin-left:11%; margin-top: 1em">If the driver
supports a local row cache for <tt>&quot;SELECT&quot;</tt>
statements, then this attribute holds the number of
un-fetched rows in the cache. If the driver doesn&rsquo;t,
then it returns <tt>&quot;undef&quot;</tt>. Note that some
drivers pre-fetch rows on execute, whereas others wait till
the first fetch.</p>

<p style="margin-left:11%; margin-top: 1em">See also the
&quot;RowCacheSize&quot; database handle attribute.</p>

<h2>FURTHER INFORMATION
<a name="FURTHER INFORMATION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>Catalog
Methods</b> <br>
An application can retrieve metadata information from the
<small>DBMS</small> by issuing appropriate queries on the
views of the Information Schema. Unfortunately,
<tt>&quot;INFORMATION_SCHEMA&quot;</tt> views are seldom
supported by the <small>DBMS.</small> Special methods
(catalog methods) are available to return result sets for a
small but important portion of that metadata:</p>

<pre style="margin-left:11%; margin-top: 1em">  column_info
  foreign_key_info
  primary_key_info
  table_info
  statistics_info</pre>


<p style="margin-left:11%; margin-top: 1em">All catalog
methods accept arguments in order to restrict the result
sets. Passing <tt>&quot;undef&quot;</tt> to an optional
argument does not constrain the search for that argument.
However, an empty string (&rsquo;&rsquo;) is treated as a
regular search criteria and will only match an empty
value.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Note</b>:
<small>SQL/CLI</small> and <small>ODBC</small> differ in the
handling of empty strings. An empty string will not restrict
the result set in <small>SQL/CLI.</small></p>

<p style="margin-left:11%; margin-top: 1em">Most arguments
in the catalog methods accept only <i>ordinary values</i>,
e.g. the arguments of
<tt>&quot;primary_key_info()&quot;</tt>. Such arguments are
treated as a literal string, i.e. the case is significant
and quote characters are taken literally.</p>

<p style="margin-left:11%; margin-top: 1em">Some arguments
in the catalog methods accept <i>search patterns</i>
(strings containing &rsquo;_&rsquo; and/or &rsquo;%&rsquo;),
e.g. the <tt>$table</tt> argument of
<tt>&quot;column_info()&quot;</tt>. Passing &rsquo;%&rsquo;
is equivalent to leaving the argument
<tt>&quot;undef&quot;</tt>.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Caveat</b>:
The underscore (&rsquo;_&rsquo;) is valid and often used in
<small>SQL</small> identifiers. Passing such a value to a
search pattern argument may return more rows than expected!
To include pattern characters as literals, they must be
preceded by an escape character which can be achieved
with</p>

<pre style="margin-left:11%; margin-top: 1em">  $esc = $dbh&minus;&gt;get_info( 14 );  # SQL_SEARCH_PATTERN_ESCAPE
  $search_pattern =~ s/([_%])/$esc$1/g;</pre>


<p style="margin-left:11%; margin-top: 1em">The
<small>ODBC</small> and <small>SQL/CLI</small>
specifications define a way to change the default behaviour
described above: All arguments (except <i>list value
arguments</i>) are treated as <i>identifier</i> if the
<tt>&quot;SQL_ATTR_METADATA_ID&quot;</tt> attribute is set
to <tt>&quot;SQL_TRUE&quot;</tt>. <i>Quoted identifiers</i>
are very similar to <i>ordinary values</i>, i.e. their body
(the string within the quotes) is interpreted literally.
<i>Unquoted identifiers</i> are compared in
<small>UPPERCASE.</small></p>

<p style="margin-left:11%; margin-top: 1em">The
<small>DBI</small> (currently) does not support the
<tt>&quot;SQL_ATTR_METADATA_ID&quot;</tt> attribute, i.e. it
behaves like an <small>ODBC</small> driver where
<tt>&quot;SQL_ATTR_METADATA_ID&quot;</tt> is set to
<tt>&quot;SQL_FALSE&quot;</tt>.</p>


<p style="margin-left:11%; margin-top: 1em"><b>Transactions</b>
<br>
Transactions are a fundamental part of any robust database
system. They protect against errors and database corruption
by ensuring that sets of related changes to the database
take place in atomic (indivisible, all-or-nothing)
units.</p>

<p style="margin-left:11%; margin-top: 1em">This section
applies to databases that support transactions and where
<tt>&quot;AutoCommit&quot;</tt> is off. See
&quot;AutoCommit&quot; for details of using
<tt>&quot;AutoCommit&quot;</tt> with various types of
databases.</p>

<p style="margin-left:11%; margin-top: 1em">The recommended
way to implement robust transactions in Perl applications is
to use <tt>&quot;RaiseError&quot;</tt> and
<tt>&quot;eval&nbsp;{&nbsp;...&nbsp;}&quot;</tt> (which is
very fast, unlike
<tt>&quot;eval&nbsp;&quot;...&quot;&quot;</tt>). For
example:</p>

<pre style="margin-left:11%; margin-top: 1em">  $dbh&minus;&gt;{AutoCommit} = 0;  # enable transactions, if possible
  $dbh&minus;&gt;{RaiseError} = 1;
  eval {
      foo(...)        # do lots of work here
      bar(...)        # including inserts
      baz(...)        # and updates
      $dbh&minus;&gt;commit;   # commit the changes if we get this far
  };
  if ($@) {
      warn &quot;Transaction aborted because $@&quot;;
      # now rollback to undo the incomplete changes
      # but do it in an eval{} as it may also fail
      eval { $dbh&minus;&gt;rollback };
      # add other application on&minus;error&minus;clean&minus;up code here
  }</pre>


<p style="margin-left:11%; margin-top: 1em">If the
<tt>&quot;RaiseError&quot;</tt> attribute is not set, then
<small>DBI</small> calls would need to be manually checked
for errors, typically like this:</p>

<pre style="margin-left:11%; margin-top: 1em">  $h&minus;&gt;method(@args) or die $h&minus;&gt;errstr;</pre>


<p style="margin-left:11%; margin-top: 1em">With
<tt>&quot;RaiseError&quot;</tt> set, the <small>DBI</small>
will automatically <tt>&quot;die&quot;</tt> if any
<small>DBI</small> method call on that handle (or a child
handle) fails, so you don&rsquo;t have to test the return
value of each method call. See &quot;RaiseError&quot; for
more details.</p>

<p style="margin-left:11%; margin-top: 1em">A major
advantage of the <tt>&quot;eval&quot;</tt> approach is that
the transaction will be properly rolled back if <i>any</i>
code (not just <small>DBI</small> calls) in the inner
application dies for any reason. The major advantage of
using the <tt>&quot;$h&minus;&gt;{RaiseError}&quot;</tt>
attribute is that all <small>DBI</small> calls will be
checked automatically. Both techniques are strongly
recommended.</p>

<p style="margin-left:11%; margin-top: 1em">After calling
<tt>&quot;commit&quot;</tt> or <tt>&quot;rollback&quot;</tt>
many drivers will not let you fetch from a previously active
<tt>&quot;SELECT&quot;</tt> statement handle that&rsquo;s a
child of the same database handle. A typical way round this
is to connect the the database twice and use one connection
for <tt>&quot;SELECT&quot;</tt> statements.</p>

<p style="margin-left:11%; margin-top: 1em">See
&quot;AutoCommit&quot; and &quot;disconnect&quot; for other
important information about transactions.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Handling
<small>BLOB / LONG /</small> Memo Fields</b> <br>
Many databases support &quot;blob&quot; (binary large
objects), &quot;long&quot;, or similar datatypes for holding
very long strings or large amounts of binary data in a
single field. Some databases support variable length long
values over 2,000,000,000 bytes in length.</p>

<p style="margin-left:11%; margin-top: 1em">Since values of
that size can&rsquo;t usually be held in memory, and because
databases can&rsquo;t usually know in advance the length of
the longest long that will be returned from a
<tt>&quot;SELECT&quot;</tt> statement (unlike other data
types), some special handling is required.</p>

<p style="margin-left:11%; margin-top: 1em">In this
situation, the value of the
<tt>&quot;$h&minus;&gt;{LongReadLen}&quot;</tt> attribute is
used to determine how much buffer space to allocate when
fetching such fields. The
<tt>&quot;$h&minus;&gt;{LongTruncOk}&quot;</tt> attribute is
used to determine how to behave if a fetched value
can&rsquo;t fit into the buffer.</p>

<p style="margin-left:11%; margin-top: 1em">See the
description of &quot;LongReadLen&quot; for more
information.</p>

<p style="margin-left:11%; margin-top: 1em">When trying to
insert long or binary values, placeholders should be used
since there are often limits on the maximum size of an
<tt>&quot;INSERT&quot;</tt> statement and the
&quot;quote&quot; method generally can&rsquo;t cope with
binary data. See &quot;Placeholders and Bind
Values&quot;.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Simple
Examples</b> <br>
Here&rsquo;s a complete example program to select and fetch
some data:</p>

<pre style="margin-left:11%; margin-top: 1em">  my $data_source = &quot;dbi::DriverName:db_name&quot;;
  my $dbh = DBI&minus;&gt;connect($data_source, $user, $password)
      or die &quot;Can't connect to $data_source: $DBI::errstr&quot;;
  my $sth = $dbh&minus;&gt;prepare( q{
          SELECT name, phone
          FROM mytelbook
  }) or die &quot;Can't prepare statement: $DBI::errstr&quot;;
  my $rc = $sth&minus;&gt;execute
      or die &quot;Can't execute statement: $DBI::errstr&quot;;
  print &quot;Query will return $sth&minus;&gt;{NUM_OF_FIELDS} fields.\n\n&quot;;
  print &quot;Field names: @{ $sth&minus;&gt;{NAME} }\n&quot;;
  while (($name, $phone) = $sth&minus;&gt;fetchrow_array) {
      print &quot;$name: $phone\n&quot;;
  }
  # check for problems which may have terminated the fetch early
  die $sth&minus;&gt;errstr if $sth&minus;&gt;err;
  $dbh&minus;&gt;disconnect;</pre>


<p style="margin-left:11%; margin-top: 1em">Here&rsquo;s a
complete example program to insert some data from a file.
(This example uses <tt>&quot;RaiseError&quot;</tt> to avoid
needing to check each call).</p>

<pre style="margin-left:11%; margin-top: 1em">  my $dbh = DBI&minus;&gt;connect(&quot;dbi:DriverName:db_name&quot;, $user, $password, {
      RaiseError =&gt; 1, AutoCommit =&gt; 0
  });
  my $sth = $dbh&minus;&gt;prepare( q{
      INSERT INTO table (name, phone) VALUES (?, ?)
  });
  open FH, &quot;&lt;phone.csv&quot; or die &quot;Unable to open phone.csv: $!&quot;;
  while (&lt;FH&gt;) {
      chomp;
      my ($name, $phone) = split /,/;
      $sth&minus;&gt;execute($name, $phone);
  }
  close FH;
  $dbh&minus;&gt;commit;
  $dbh&minus;&gt;disconnect;</pre>


<p style="margin-left:11%; margin-top: 1em">Here&rsquo;s
how to convert fetched NULLs (undefined values) into empty
strings:</p>

<pre style="margin-left:11%; margin-top: 1em">  while($row = $sth&minus;&gt;fetchrow_arrayref) {
    # this is a fast and simple way to deal with nulls:
    foreach (@$row) { $_ = '' unless defined }
    print &quot;@$row\n&quot;;
  }</pre>


<p style="margin-left:11%; margin-top: 1em">The
<tt>&quot;q{...}&quot;</tt> style quoting used in these
examples avoids clashing with quotes that may be used in the
<small>SQL</small> statement. Use the double-quote like
<tt>&quot;qq{...}&quot;</tt> operator if you want to
interpolate variables into the string. See &quot;Quote and
Quote-like Operators&quot; in perlop for more details.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Threads and
Thread Safety</b> <br>
Perl 5.7 and later support a new threading model called
iThreads. (The old &quot;5.005 style&quot; threads are not
supported by the <small>DBI.</small> )</p>

<p style="margin-left:11%; margin-top: 1em">In the iThreads
model each thread has its own copy of the perl interpreter.
When a new thread is created the original perl interpreter
is &rsquo;cloned&rsquo; to create a new copy for the new
thread.</p>

<p style="margin-left:11%; margin-top: 1em">If the
<small>DBI</small> and drivers are loaded and handles
created before the thread is created then it will get a
cloned copy of the <small>DBI,</small> the drivers and the
handles.</p>

<p style="margin-left:11%; margin-top: 1em">However, the
internal pointer data within the handles will refer to the
<small>DBI</small> and drivers in the original interpreter.
Using those handles in the new interpreter thread is not
safe, so the <small>DBI</small> detects this and croaks on
any method call using handles that don&rsquo;t belong to the
current thread (except for <small>DESTROY</small> ).</p>

<p style="margin-left:11%; margin-top: 1em">Because of this
(possibly temporary) restriction, newly created threads must
make their own connections to the database. Handles
can&rsquo;t be shared across threads.</p>

<p style="margin-left:11%; margin-top: 1em">But
<small>BEWARE,</small> some underlying database APIs (the
code the <small>DBD</small> driver uses to talk to the
database, often supplied by the database vendor) are not
thread safe. If it&rsquo;s not thread safe, then allowing
more than one thread to enter the code at the same time may
cause subtle/serious problems. In some cases allowing more
than one thread to enter the code, even if <i>not</i> at the
same time, can cause problems. You have been warned.</p>

<p style="margin-left:11%; margin-top: 1em">Using
<small>DBI</small> with perl threads is not yet recommended
for production environments. For more information see
&lt;http://www.perlmonks.org/index.pl?node_id=288022&gt;</p>

<p style="margin-left:11%; margin-top: 1em">Note: There is
a bug in perl 5.8.2 when configured with threads and
debugging enabled (bug #24463) which causes a
<small>DBI</small> test to fail.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Signal
Handling and Canceling Operations</b> <br>
[The following only applies to systems with unix-like signal
handling. I&rsquo;d welcome additions for other systems,
especially Windows.]</p>

<p style="margin-left:11%; margin-top: 1em">The first thing
to say is that signal handling in Perl versions less than
5.8 is <i>not</i> safe. There is always a small risk of Perl
crashing and/or core dumping when, or after, handling a
signal because the signal could arrive and be handled while
internal data structures are being changed. If the signal
handling code used those same internal data structures it
could cause all manner of subtle and not-so-subtle problems.
The risk was reduced with 5.4.4 but was still present in all
perls up through 5.8.0.</p>

<p style="margin-left:11%; margin-top: 1em">Beginning in
perl 5.8.0 perl implements &rsquo;safe&rsquo; signal
handling if your system has the <small>POSIX</small>
<i>sigaction()</i> routine. Now when a signal is delivered
perl just makes a note of it but does <i>not</i> run the
<tt>%SIG</tt> handler. The handling is
&rsquo;deferred&rsquo; until a &rsquo;safe&rsquo;
moment.</p>

<p style="margin-left:11%; margin-top: 1em">Although this
change made signal handling safe, it also lead to a problem
with signals being deferred for longer than you&rsquo;d
like. If a signal arrived while executing a system call,
such as waiting for data on a network connection, the signal
is noted and then the system call that was executing returns
with an <small>EINTR</small> error code to indicate that it
was interrupted. All fine so far.</p>

<p style="margin-left:11%; margin-top: 1em">The problem
comes when the code that made the system call sees the
<small>EINTR</small> code and decides it&rsquo;s going to
call it again. Perl doesn&rsquo;t do that, but database code
sometimes does. If that happens then the signal handler
doesn&rsquo;t get called until later. Maybe much later.</p>

<p style="margin-left:11%; margin-top: 1em">Fortunately
there are ways around this which we&rsquo;ll discuss below.
Unfortunately they make signals unsafe again.</p>

<p style="margin-left:11%; margin-top: 1em">The two most
common uses of signals in relation to the <small>DBI</small>
are for canceling operations when the user types Ctrl-C
(interrupt), and for implementing a timeout using
<tt>&quot;alarm()&quot;</tt> and <tt>$SIG{ALRM}</tt>. <br>
Cancel</p>

<p style="margin-left:17%;">The <small>DBI</small> provides
a <tt>&quot;cancel&quot;</tt> method for statement handles.
The <tt>&quot;cancel&quot;</tt> method should abort the
current operation and is designed to be called from a signal
handler. For example:</p>

<pre style="margin-left:17%; margin-top: 1em">  $SIG{INT} = sub { $sth&minus;&gt;cancel };</pre>


<p style="margin-left:17%; margin-top: 1em">However, few
drivers implement this (the <small>DBI</small> provides a
default method that just returns <tt>&quot;undef&quot;</tt>)
and, even if implemented, there is still a possibility that
the statement handle, and even the parent database handle,
will not be usable afterwards.</p>

<p style="margin-left:17%; margin-top: 1em">If
<tt>&quot;cancel&quot;</tt> returns true, then it has
successfully invoked the database engine&rsquo;s own cancel
function. If it returns false, then
<tt>&quot;cancel&quot;</tt> failed. If it returns
<tt>&quot;undef&quot;</tt>, then the database driver does
not have cancel implemented &minus; very few do.</p>

<p style="margin-left:11%;">Timeout</p>

<p style="margin-left:17%;">The traditional way to
implement a timeout is to set <tt>$SIG{ALRM}</tt> to refer
to some code that will be executed when an
<small>ALRM</small> signal arrives and then to call
alarm($seconds) to schedule an <small>ALRM</small> signal to
be delivered <tt>$seconds</tt> in the future. For
example:</p>

<pre style="margin-left:17%; margin-top: 1em">  eval {
    local $SIG{ALRM} = sub { die &quot;TIMEOUT\n&quot; }; # N.B. \n required
    eval {
      alarm($seconds);
      ... code to execute with timeout here (which may die) ...
    };
    # outer eval catches alarm that might fire JUST before this alarm(0)
    alarm(0);  # cancel alarm (if code ran fast)
    die &quot;$@&quot; if $@;
  };
  if ( $@ eq &quot;TIMEOUT\n&quot; ) { ... }
  elsif ($@) { ... } # some other error</pre>


<p style="margin-left:17%; margin-top: 1em">The first
(outer) eval is used to avoid the unlikely but possible
chance that the &quot;code to execute&quot; dies and the
alarm fires before it is cancelled. Without the outer eval,
if this happened your program will die if you have no
<small>ALRM</small> handler or a non-local alarm handler
will be called.</p>

<p style="margin-left:17%; margin-top: 1em">Unfortunately,
as described above, this won&rsquo;t always work as
expected, depending on your perl version and the underlying
database code.</p>

<p style="margin-left:17%; margin-top: 1em">With Oracle for
instance (DBD::Oracle), if the system which hosts the
database is down the <small>DBI&minus;</small>
&gt;<i>connect()</i> call will hang for several minutes
before returning an error.</p>

<p style="margin-left:11%; margin-top: 1em">The solution on
these systems is to use the
<tt>&quot;POSIX::sigaction()&quot;</tt> routine to gain low
level access to how the signal handler is installed.</p>

<p style="margin-left:11%; margin-top: 1em">The code would
look something like this (for the DBD-Oracle
<i>connect()</i>):</p>

<pre style="margin-left:11%; margin-top: 1em">   use POSIX qw(:signal_h);
   my $mask = POSIX::SigSet&minus;&gt;new( SIGALRM ); # signals to mask in the handler
   my $action = POSIX::SigAction&minus;&gt;new(
       sub { die &quot;connect timeout\n&quot; },        # the handler code ref
       $mask,
       # not using (perl 5.8.2 and later) 'safe' switch or sa_flags
   );
   my $oldaction = POSIX::SigAction&minus;&gt;new();
   sigaction( SIGALRM, $action, $oldaction );
   my $dbh;
   eval {
      eval {
        alarm(5); # seconds before time out
        $dbh = DBI&minus;&gt;connect(&quot;dbi:Oracle:$dsn&quot; ... );
      };
      alarm(0); # cancel alarm (if connect worked fast)
      die &quot;$@\n&quot; if $@; # connect died
   };
   sigaction( SIGALRM, $oldaction );  # restore original signal handler
   if ( $@ ) {
     if ($@ eq &quot;connect timeout\n&quot;) {...}
     else { # connect died }
   }</pre>


<p style="margin-left:11%; margin-top: 1em">See previous
example for the reasoning around the double eval.</p>

<p style="margin-left:11%; margin-top: 1em">Similar
techniques can be used for canceling statement
execution.</p>

<p style="margin-left:11%; margin-top: 1em">Unfortunately,
this solution is somewhat messy, and it does <i>not</i> work
with perl versions less than perl 5.8 where
<tt>&quot;POSIX::sigaction()&quot;</tt> appears to be
broken.</p>

<p style="margin-left:11%; margin-top: 1em">For a cleaner
implementation that works across perl versions, see Lincoln
Baxter&rsquo;s Sys::SigAction module at
&lt;http://search.cpan.org/~lbaxter/Sys&minus;SigAction/&gt;.
The documentation for Sys::SigAction includes an longer
discussion of this problem, and a DBD::Oracle test
script.</p>

<p style="margin-left:11%; margin-top: 1em">Be sure to read
all the signal handling sections of the perlipc manual.</p>

<p style="margin-left:11%; margin-top: 1em">And finally,
two more points to keep firmly in mind. Firstly, remember
that what we&rsquo;ve done here is essentially revert to old
style <i>unsafe</i> handling of these signals. So do as
little as possible in the handler. Ideally just
<i>die()</i>. Secondly, the handles in use at the time the
signal is handled may not be safe to use afterwards.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Subclassing
the <small>DBI</small></b> <small><br>
DBI</small> can be subclassed and extended just like any
other object oriented module. Before we talk about how to do
that, it&rsquo;s important to be clear about the various
<small>DBI</small> classes and how they work together.</p>

<p style="margin-left:11%; margin-top: 1em">By default
<tt>&quot;$dbh = DBI&minus;&gt;connect(...)&quot;</tt>
returns a <tt>$dbh</tt> blessed into the
<tt>&quot;DBI::db&quot;</tt> class. And the
<tt>&quot;$dbh&minus;&gt;prepare&quot;</tt> method returns
an <tt>$sth</tt> blessed into the
<tt>&quot;DBI::st&quot;</tt> class (actually it simply
changes the last four characters of the calling handle class
to be <tt>&quot;::st&quot;</tt>).</p>

<p style="margin-left:11%; margin-top: 1em">The leading
&rsquo;<tt>&quot;DBI&quot;</tt>&rsquo; is known as the
&rsquo;root class&rsquo; and the extra
&rsquo;<tt>&quot;::db&quot;</tt>&rsquo; or
&rsquo;<tt>&quot;::st&quot;</tt>&rsquo; are the
&rsquo;handle type suffixes&rsquo;. If you want to subclass
the <small>DBI</small> you&rsquo;ll need to put your
overriding methods into the appropriate classes. For
example, if you want to use a root class of
<tt>&quot;MySubDBI&quot;</tt> and override the <i>do()</i>,
<i>prepare()</i> and <i>execute()</i> methods, then your
<i>do()</i> and <i>prepare()</i> methods should be in the
<tt>&quot;MySubDBI::db&quot;</tt> class and the
<i>execute()</i> method should be in the
<tt>&quot;MySubDBI::st&quot;</tt> class.</p>

<p style="margin-left:11%; margin-top: 1em">To setup the
inheritance hierarchy the <tt>@ISA</tt> variable in
<tt>&quot;MySubDBI::db&quot;</tt> should include
<tt>&quot;DBI::db&quot;</tt> and the <tt>@ISA</tt> variable
in <tt>&quot;MySubDBI::st&quot;</tt> should include
<tt>&quot;DBI::st&quot;</tt>. The
<tt>&quot;MySubDBI&quot;</tt> root class itself isn&rsquo;t
currently used for anything visible and so, apart from
setting <tt>@ISA</tt> to include <tt>&quot;DBI&quot;</tt>,
it can be left empty.</p>

<p style="margin-left:11%; margin-top: 1em">So, having put
your overriding methods into the right classes, and setup
the inheritance hierarchy, how do you get the
<small>DBI</small> to use them? You have two choices, either
a static method call using the name of your subclass:</p>

<pre style="margin-left:11%; margin-top: 1em">  $dbh = MySubDBI&minus;&gt;connect(...);</pre>


<p style="margin-left:11%; margin-top: 1em">or specifying a
<tt>&quot;RootClass&quot;</tt> attribute:</p>

<pre style="margin-left:11%; margin-top: 1em">  $dbh = DBI&minus;&gt;connect(..., { RootClass =&gt; 'MySubDBI' });</pre>


<p style="margin-left:11%; margin-top: 1em">If both forms
are used then the attribute takes precedence.</p>

<p style="margin-left:11%; margin-top: 1em">The only
differences between the two are that using an explicit
RootClass attribute will a) make the <small>DBI</small>
automatically attempt to load a module by that name if the
class doesn&rsquo;t exist, and b) won&rsquo;t call your
<i>MySubDBI::connect()</i> method, if you have one.</p>

<p style="margin-left:11%; margin-top: 1em">When
subclassing is being used then, after a successful new
connect, the <small>DBI&minus;</small> &gt;connect method
automatically calls:</p>

<pre style="margin-left:11%; margin-top: 1em">  $dbh&minus;&gt;connected($dsn, $user, $pass, \%attr);</pre>


<p style="margin-left:11%; margin-top: 1em">The default
method does nothing. The call is made just to simplify any
post-connection setup that your subclass may want to
perform. The parameters are the same as passed to
<small>DBI&minus;</small> &gt;connect. If your subclass
supplies a connected method, it should be part of the
MySubDBI::db package.</p>

<p style="margin-left:11%; margin-top: 1em">One more thing
to note: you must let the <small>DBI</small> do the handle
creation. If you want to override the <i>connect()</i>
method in your *::dr class then it must still call
SUPER::connect to get a <tt>$dbh</tt> to work with.
Similarly, an overridden <i>prepare()</i> method in *::db
must still call SUPER::prepare to get a <tt>$sth</tt>. If
you try to create your own handles using <i>bless()</i> then
you&rsquo;ll find the <small>DBI</small> will reject them
with an &quot;is not a <small>DBI</small> handle (has no
magic)&quot; error.</p>

<p style="margin-left:11%; margin-top: 1em">Here&rsquo;s a
brief example of a <small>DBI</small> subclass. A more
thorough example can be found in <i>t/subclass.t</i> in the
<small>DBI</small> distribution.</p>

<pre style="margin-left:11%; margin-top: 1em">  package MySubDBI;
  use strict;
  use DBI;
  use vars qw(@ISA);
  @ISA = qw(DBI);
  package MySubDBI::db;
  use vars qw(@ISA);
  @ISA = qw(DBI::db);
  sub prepare {
    my ($dbh, @args) = @_;
    my $sth = $dbh&minus;&gt;SUPER::prepare(@args)
        or return;
    $sth&minus;&gt;{private_mysubdbi_info} = { foo =&gt; 'bar' };
    return $sth;
  }
  package MySubDBI::st;
  use vars qw(@ISA);
  @ISA = qw(DBI::st);
  sub fetch {
    my ($sth, @args) = @_;
    my $row = $sth&minus;&gt;SUPER::fetch(@args)
        or return;
    do_something_magical_with_row_data($row)
        or return $sth&minus;&gt;set_err(1234, &quot;The magic failed&quot;, undef, &quot;fetch&quot;);
    return $row;
  }</pre>


<p style="margin-left:11%; margin-top: 1em">When calling a
SUPER::method that returns a handle, be careful to check the
return value before trying to do other things with it in
your overridden method. This is especially important if you
want to set a hash attribute on the handle, as Perl&rsquo;s
autovivification will bite you by (in)conveniently creating
an unblessed hashref, which your method will then return
with usually baffling results later on like the error
&quot;dbih_getcom handle <small>HASH</small> (0xa4451a8) is
not a <small>DBI</small> handle (has no magic&quot;.
It&rsquo;s best to check right after the call and return
undef immediately on error, just like <small>DBI</small>
would and just like the example above.</p>

<p style="margin-left:11%; margin-top: 1em">If your method
needs to record an error it should call the <i>set_err()</i>
method with the error code and error string, as shown in the
example above. The error code and error string will be
recorded in the handle and available via
<tt>&quot;$h&minus;&gt;err&quot;</tt> and
<tt>$DBI::errstr</tt> etc. The <i>set_err()</i> method
always returns an undef or empty list as appropriate. Since
your method should nearly always return an undef or empty
list as soon as an error is detected it&rsquo;s handy to
simply return what <i>set_err()</i> returns, as shown in the
example above.</p>

<p style="margin-left:11%; margin-top: 1em">If the handle
has <tt>&quot;RaiseError&quot;</tt>,
<tt>&quot;PrintError&quot;</tt>, or
<tt>&quot;HandleError&quot;</tt> etc. set then the
<i>set_err()</i> method will honour them. This means that if
<tt>&quot;RaiseError&quot;</tt> is set then <i>set_err()</i>
won&rsquo;t return in the normal way but will &rsquo;throw
an exception&rsquo; that can be caught with an
<tt>&quot;eval&quot;</tt> block.</p>

<p style="margin-left:11%; margin-top: 1em">You can stash
private data into <small>DBI</small> handles via
<tt>&quot;$h&minus;&gt;{private_..._*}&quot;</tt>. See the
entry under &quot; <small>ATTRIBUTES COMMON TO ALL
HANDLES&quot;</small> for info and important caveats.</p>

<h2>TRACING
<a name="TRACING"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The
<small>DBI</small> has a powerful tracing mechanism built
in. It enables you to see what&rsquo;s going on
&rsquo;behind the scenes&rsquo;, both within the
<small>DBI</small> and the drivers you&rsquo;re using.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Trace
Settings</b> <br>
Which details are written to the trace output is controlled
by a combination of a <i>trace level</i>, an integer from 0
to 15, and a set of <i>trace flags</i> that are either on or
off. Together these are known as the <i>trace settings</i>
and are stored together in a single integer. For normal use
you only need to set the trace level, and generally only to
a value between 1 and 4.</p>

<p style="margin-left:11%; margin-top: 1em">Each handle has
its own trace settings, and so does the <small>DBI.</small>
When you call a method the <small>DBI</small> merges the
handles settings into its own for the duration of the call:
the trace flags of the handle are <small>OR</small> &rsquo;d
into the trace flags of the <small>DBI,</small> and if the
handle has a higher trace level then the <small>DBI</small>
trace level is raised to match it. The previous
<small>DBI</small> trace settings are restored when the
called method returns.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Trace
Levels</b> <br>
Trace <i>levels</i> are as follows:</p>

<pre style="margin-left:11%; margin-top: 1em">  0 &minus; Trace disabled.
  1 &minus; Trace top&minus;level DBI method calls returning with results or errors.
  2 &minus; As above, adding tracing of top&minus;level method entry with parameters.
  3 &minus; As above, adding some high&minus;level information from the driver
      and some internal information from the DBI.
  4 &minus; As above, adding more detailed information from the driver.
      This is the first level to trace all the rows being fetched.
  5 to 15 &minus; As above but with more and more internal information.</pre>


<p style="margin-left:11%; margin-top: 1em">Trace level 1
is best for a simple overview of what&rsquo;s happening.
Trace levels 2 thru 4 a good choice for general purpose
tracing. Levels 5 and above are best reserved for
investigating a specific problem, when you need to see
&quot;inside&quot; the driver and <small>DBI.</small></p>

<p style="margin-left:11%; margin-top: 1em">The trace
output is detailed and typically very useful. Much of the
trace output is formatted using the &quot;neat&quot;
function, so strings in the trace output may be edited and
truncated by that function.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Trace
Flags</b> <br>
Trace <i>flags</i> are used to enable tracing of specific
activities within the <small>DBI</small> and drivers. The
<small>DBI</small> defines some trace flags and drivers can
define others. <small>DBI</small> trace flag names begin
with a capital letter and driver specific names begin with a
lowercase letter, as usual.</p>

<p style="margin-left:11%; margin-top: 1em">Currently the
<small>DBI</small> defines these trace flags:</p>

<pre style="margin-left:11%; margin-top: 1em">  ALL &minus; turn on all DBI and driver flags (not recommended)
  SQL &minus; trace SQL statements executed
        (not yet implemented in DBI but implemented in some DBDs)
  CON &minus; trace connection process
  ENC &minus; trace encoding (unicode translations etc)
        (not yet implemented in DBI but implemented in some DBDs)
  DBD &minus; trace only DBD messages
        (not implemented by all DBDs yet)
  TXN &minus; trace transactions
        (not implemented in all DBDs yet)</pre>


<p style="margin-left:11%; margin-top: 1em">The
&quot;parse_trace_flags&quot; and
&quot;parse_trace_flag&quot; methods are used to convert
trace flag names into the corresponding integer bit
flags.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Enabling
Trace</b> <br>
The <tt>&quot;$h&minus;&gt;trace&quot;</tt> method sets the
trace settings for a handle and
<tt>&quot;DBI&minus;&gt;trace&quot;</tt> does the same for
the <small>DBI.</small></p>

<p style="margin-left:11%; margin-top: 1em">In addition to
the &quot;trace&quot; method, you can enable the same trace
information, and direct the output to a file, by setting the
<tt>&quot;DBI_TRACE&quot;</tt> environment variable before
starting Perl. See &quot; <small>DBI_TRACE&quot;</small> for
more information.</p>

<p style="margin-left:11%; margin-top: 1em">Finally, you
can set, or get, the trace settings for a handle using the
<tt>&quot;TraceLevel&quot;</tt> attribute.</p>

<p style="margin-left:11%; margin-top: 1em">All of those
methods use <i>parse_trace_flags()</i> and so allow you set
both the trace level and multiple trace flags by using a
string containing the trace level and/or flag names
separated by vertical bar
(&quot;<tt>&quot;|&quot;</tt>&quot;) or comma
(&quot;<tt>&quot;,&quot;</tt>&quot;) characters. For
example:</p>

<pre style="margin-left:11%; margin-top: 1em">  local $h&minus;&gt;{TraceLevel} = &quot;3|SQL|foo&quot;;</pre>


<p style="margin-left:11%; margin-top: 1em"><b>Trace
Output</b> <br>
Initially trace output is written to
<tt>&quot;STDERR&quot;</tt>. Both the
<tt>&quot;$h&minus;&gt;trace&quot;</tt> and
<tt>&quot;DBI&minus;&gt;trace&quot;</tt> methods take an
optional <tt>$trace_file</tt> parameter, which may be either
the name of a file to be opened by <small>DBI</small> in
append mode, or a reference to an existing writable
(possibly layered) filehandle. If <tt>$trace_file</tt> is a
filename, and can be opened in append mode, or
<tt>$trace_file</tt> is a writable filehandle, then
<i>all</i> trace output (currently including that from other
handles) is redirected to that file. A warning is generated
if <tt>$trace_file</tt> can&rsquo;t be opened or is not
writable.</p>

<p style="margin-left:11%; margin-top: 1em">Further calls
to <i>trace()</i> without <tt>$trace_file</tt> do not alter
where the trace output is sent. If <tt>$trace_file</tt> is
undefined, then trace output is sent to
<tt>&quot;STDERR&quot;</tt> and, if the prior trace was
opened with <tt>$trace_file</tt> as a filename, the previous
trace file is closed; if <tt>$trace_file</tt> was a
filehandle, the filehandle is <b>not</b> closed.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>NOTE</small></b>
: If <tt>$trace_file</tt> is specified as a filehandle, the
filehandle should not be closed until all <small>DBI</small>
operations are completed, or the application has reset the
trace file via another call to <tt>&quot;trace()&quot;</tt>
that changes the trace file.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Tracing to
Layered Filehandles <small><br>
NOTE</small></b> :</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="83%">


<p>Tied filehandles are not currently supported, as tie
operations are not available to the PerlIO methods used by
the <small>DBI.</small></p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="5%"></td>
<td width="83%">


<p>PerlIO layer support requires Perl version 5.8 or
higher.</p> </td></tr>
</table>

<p style="margin-left:11%; margin-top: 1em">As of version
5.8, Perl provides the ability to layer various
&quot;disciplines&quot; on an open filehandle via the PerlIO
module.</p>

<p style="margin-left:11%; margin-top: 1em">A simple
example of using PerlIO layers is to use a scalar as the
output:</p>

<pre style="margin-left:11%; margin-top: 1em">    my $scalar = '';
    open( my $fh, &quot;+&gt;:scalar&quot;, \$scalar );
    $dbh&minus;&gt;trace( 2, $fh );</pre>


<p style="margin-left:11%; margin-top: 1em">Now all trace
output is simply appended to <tt>$scalar</tt>.</p>

<p style="margin-left:11%; margin-top: 1em">A more complex
application of tracing to a layered filehandle is the use of
a custom layer (<i>Refer to</i> Perlio::via <i>for details
on creating custom PerlIO layers.</i>). Consider an
application with the following logger module:</p>

<pre style="margin-left:11%; margin-top: 1em">    package MyFancyLogger;
    sub new
    {
        my $self = {};
        my $fh;
        open $fh, '&gt;', 'fancylog.log';
        $self&minus;&gt;{_fh} = $fh;
        $self&minus;&gt;{_buf} = '';
        return bless $self, shift;
    }
    sub log
    {
        my $self = shift;
        return unless exists $self&minus;&gt;{_fh};
        my $fh = $self&minus;&gt;{_fh};
        $self&minus;&gt;{_buf} .= shift;
    #
    # DBI feeds us pieces at a time, so accumulate a complete line
    # before outputing
    #
        print $fh &quot;At &quot;, scalar localtime(), ':', $self&minus;&gt;{_buf}, &quot;\n&quot; and
        $self&minus;&gt;{_buf} = ''
            if $self&minus;&gt;{_buf}=~tr/\n//;
    }
    sub close {
        my $self = shift;
        return unless exists $self&minus;&gt;{_fh};
        my $fh = $self&minus;&gt;{_fh};
        print $fh &quot;At &quot;, scalar localtime(), ':', $self&minus;&gt;{_buf}, &quot;\n&quot; and
        $self&minus;&gt;{_buf} = ''
            if $self&minus;&gt;{_buf};
        close $fh;
        delete $self&minus;&gt;{_fh};
    }
    1;</pre>


<p style="margin-left:11%; margin-top: 1em">To redirect
<small>DBI</small> traces to this logger requires creating a
package for the layer:</p>

<pre style="margin-left:11%; margin-top: 1em">    package PerlIO::via::MyFancyLogLayer;
    sub PUSHED
    {
        my ($class,$mode,$fh) = @_;
        my $logger;
        return bless \$logger,$class;
    }
    sub OPEN {
        my ($self, $path, $mode, $fh) = @_;
        #
        # $path is actually our logger object
        #
        $$self = $path;
        return 1;
    }
    sub WRITE
    {
        my ($self, $buf, $fh) = @_;
        $$self&minus;&gt;log($buf);
        return length($buf);
    }
    sub CLOSE {
        my $self = shift;
        $$self&minus;&gt;close();
        return 0;
    }
    1;</pre>


<p style="margin-left:11%; margin-top: 1em">The application
can then cause <small>DBI</small> traces to be routed to the
logger using</p>

<pre style="margin-left:11%; margin-top: 1em">    use PerlIO::via::MyFancyLogLayer;
    open my $fh, '&gt;:via(MyFancyLogLayer)', MyFancyLogger&minus;&gt;new();
    $dbh&minus;&gt;trace('SQL', $fh);</pre>


<p style="margin-left:11%; margin-top: 1em">Now all trace
output will be processed by MyFancyLogger&rsquo;s
<i>log()</i> method.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Trace
Content</b> <br>
Many of the values embedded in trace output are formatted
using the <i>neat()</i> utility function. This means they
may be quoted, sanitized, and possibly truncated if longer
than <tt>$DBI::neat_maxlen</tt>. See &quot;neat&quot; for
more details.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Tracing
Tips</b> <br>
You can add tracing to your own application code using the
&quot;trace_msg&quot; method.</p>

<p style="margin-left:11%; margin-top: 1em">It can
sometimes be handy to compare trace files from two different
runs of the same script. However using a tool like
<tt>&quot;diff&quot;</tt> on the original log output
doesn&rsquo;t work well because the trace file is full of
object addresses that may differ on each run.</p>

<p style="margin-left:11%; margin-top: 1em">The
<small>DBI</small> includes a handy utility called
dbilogstrip that can be used to &rsquo;normalize&rsquo; the
log content. It can be used as a filter like this:</p>

<pre style="margin-left:11%; margin-top: 1em">    DBI_TRACE=2 perl yourscript.pl ...args1... 2&gt;&amp;1 | dbilogstrip &gt; dbitrace1.log
    DBI_TRACE=2 perl yourscript.pl ...args2... 2&gt;&amp;1 | dbilogstrip &gt; dbitrace2.log
    diff &minus;u dbitrace1.log dbitrace2.log</pre>


<p style="margin-left:11%; margin-top: 1em">See dbilogstrip
for more information.</p>

<h2>DBI ENVIRONMENT VARIABLES
<a name="DBI ENVIRONMENT VARIABLES"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The
<small>DBI</small> module recognizes a number of environment
variables, but most of them should not be used most of the
time. It is better to be explicit about what you are doing
to avoid the need for environment variables, especially in a
web serving system where web servers are stingy about which
environment variables are available.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>DBI_DSN</small></b>
<br>
The <small>DBI_DSN</small> environment variable is used by
<small>DBI&minus;</small> &gt;connect if you do not specify
a data source when you issue the connect. It should have a
format such as &quot;dbi:Driver:databasename&quot;.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>DBI_DRIVER</small></b>
<br>
The <small>DBI_DRIVER</small> environment variable is used
to fill in the database driver name in
<small>DBI&minus;</small> &gt;connect if the data source
string starts &quot;dbi::&quot; (thereby omitting the
driver). If <small>DBI_DSN</small> omits the driver name,
<small>DBI_DRIVER</small> can fill the gap.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>DBI_AUTOPROXY</small></b>
<br>
The <small>DBI_AUTOPROXY</small> environment variable takes
a string value that starts &quot;dbi:Proxy:&quot; and is
typically followed by &quot;hostname=...;port=...&quot;. It
is used to alter the behaviour of <small>DBI&minus;</small>
&gt;connect. For full details, see DBI::Proxy
documentation.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>DBI_USER</small></b>
<br>
The <small>DBI_USER</small> environment variable takes a
string value that is used as the user name if the
<small>DBI&minus;</small> &gt;connect call is given undef
(as distinct from an empty string) as the username argument.
Be wary of the security implications of using this.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>DBI_PASS</small></b>
<br>
The <small>DBI_PASS</small> environment variable takes a
string value that is used as the password if the
<small>DBI&minus;</small> &gt;connect call is given undef
(as distinct from an empty string) as the password argument.
Be extra wary of the security implications of using
this.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>DBI_DBNAME</small>
(obsolete)</b> <br>
The <small>DBI_DBNAME</small> environment variable takes a
string value that is used only when the obsolescent style of
<small>DBI&minus;</small> &gt;connect (with driver name as
fourth parameter) is used, and when no value is provided for
the first (database name) argument.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>DBI_TRACE</small></b>
<br>
The <small>DBI_TRACE</small> environment variable specifies
the global default trace settings for the <small>DBI</small>
at startup. Can also be used to direct trace output to a
file. When the <small>DBI</small> is loaded it does:</p>

<pre style="margin-left:11%; margin-top: 1em">  DBI&minus;&gt;trace(split /=/, $ENV{DBI_TRACE}, 2) if $ENV{DBI_TRACE};</pre>


<p style="margin-left:11%; margin-top: 1em">So if
<tt>&quot;DBI_TRACE&quot;</tt> contains an
&quot;<tt>&quot;=&quot;</tt>&quot; character then what
follows it is used as the name of the file to append the
trace to.</p>

<p style="margin-left:11%; margin-top: 1em">output appended
to that file. If the name begins with a number followed by
an equal sign (<tt>&quot;=&quot;</tt>), then the number and
the equal sign are stripped off from the name, and the
number is used to set the trace level. For example:</p>

<pre style="margin-left:11%; margin-top: 1em">  DBI_TRACE=1=dbitrace.log perl your_test_script.pl</pre>


<p style="margin-left:11%; margin-top: 1em">On Unix-like
systems using a Bourne-like shell, you can do this easily on
the command line:</p>

<pre style="margin-left:11%; margin-top: 1em">  DBI_TRACE=2 perl your_test_script.pl</pre>


<p style="margin-left:11%; margin-top: 1em">See &quot;
<small>TRACING&quot;</small> for more information.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>PERL_DBI_DEBUG</small>
(obsolete)</b> <br>
An old variable that should no longer be used; equivalent to
<small>DBI_TRACE.</small></p>


<p style="margin-left:11%; margin-top: 1em"><small><b>DBI_PROFILE</b></small>
<br>
The <small>DBI_PROFILE</small> environment variable can be
used to enable profiling of <small>DBI</small> method calls.
See DBI::Profile for more information.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>DBI_PUREPERL</small></b>
<br>
The <small>DBI_PUREPERL</small> environment variable can be
used to enable the use of DBI::PurePerl. See DBI::PurePerl
for more information.</p>

<h2>WARNING AND ERROR MESSAGES
<a name="WARNING AND ERROR MESSAGES"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>Fatal
Errors</b> <br>
Can&rsquo;t call method &quot;prepare&quot; without a
package or object reference</p>

<p style="margin-left:17%;">The <tt>$dbh</tt> handle
you&rsquo;re using to call <tt>&quot;prepare&quot;</tt> is
probably undefined because the preceding
<tt>&quot;connect&quot;</tt> failed. You should always check
the return status of <small>DBI</small> methods, or use the
&quot;RaiseError&quot; attribute.</p>

<p style="margin-left:11%;">Can&rsquo;t call method
&quot;execute&quot; without a package or object
reference</p>

<p style="margin-left:17%;">The <tt>$sth</tt> handle
you&rsquo;re using to call <tt>&quot;execute&quot;</tt> is
probably undefined because the preceding
<tt>&quot;prepare&quot;</tt> failed. You should always check
the return status of <small>DBI</small> methods, or use the
&quot;RaiseError&quot; attribute.</p>

<p style="margin-left:11%;"><small>DBI/DBD</small> internal
version mismatch</p>

<p style="margin-left:17%;">The <small>DBD</small> driver
module was built with a different version of
<small>DBI</small> than the one currently being used. You
should rebuild the <small>DBD</small> module under the
current version of <small>DBI.</small></p>

<p style="margin-left:17%; margin-top: 1em">(Some rare
platforms require &quot;static linking&quot;. On those
platforms, there may be an old <small>DBI</small> or
<small>DBD</small> driver version actually embedded in the
Perl executable being used.)</p>

<p style="margin-left:11%;"><small>DBD</small> driver has
not implemented the AutoCommit attribute</p>

<p style="margin-left:17%;">The <small>DBD</small> driver
implementation is incomplete. Consult the author.</p>

<p style="margin-left:11%;">Can&rsquo;t [sg]et
%s&minus;&gt;{%s}: unrecognised attribute</p>

<p style="margin-left:17%;">You attempted to set or get an
unknown attribute of a handle. Make sure you have spelled
the attribute name correctly; case is significant (e.g.,
&quot;Autocommit&quot; is not the same as
&quot;AutoCommit&quot;).</p>

<h2>Pure-Perl DBI
<a name="Pure-Perl DBI"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">A pure-perl
emulation of the <small>DBI</small> is included in the
distribution for people using pure-perl drivers who, for
whatever reason, can&rsquo;t install the compiled
<small>DBI.</small> See DBI::PurePerl.</p>

<h2>SEE ALSO
<a name="SEE ALSO"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>Driver and
Database Documentation</b> <br>
Refer to the documentation for the <small>DBD</small> driver
that you are using.</p>

<p style="margin-left:11%; margin-top: 1em">Refer to the
<small>SQL</small> Language Reference Manual for the
database engine that you are using.</p>


<p style="margin-left:11%; margin-top: 1em"><b><small>ODBC</small>
and <small>SQL/CLI</small> Standards Reference
Information</b> <br>
More detailed information about the semantics of certain
<small>DBI</small> methods that are based on
<small>ODBC</small> and <small>SQL/CLI</small> standards is
available on-line via microsoft.com, for
<small>ODBC,</small> and www.jtc1sc32.org for the
<small>SQL/CLI</small> standard:</p>

<pre style="margin-left:11%; margin-top: 1em"> DBI method        ODBC function     SQL/CLI Working Draft
 &minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;        &minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;     &minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;&minus;
 column_info       SQLColumns        Page 124
 foreign_key_info  SQLForeignKeys    Page 163
 get_info          SQLGetInfo        Page 214
 primary_key_info  SQLPrimaryKeys    Page 254
 table_info        SQLTables         Page 294
 type_info         SQLGetTypeInfo    Page 239
 statistics_info   SQLStatistics</pre>


<p style="margin-left:11%; margin-top: 1em">To find
documentation on the <small>ODBC</small> function you can
use the <small>MSDN</small> search facility at:</p>

<pre style="margin-left:11%; margin-top: 1em">    http://msdn.microsoft.com/Search</pre>


<p style="margin-left:11%; margin-top: 1em">and search for
something like <tt>&quot;SQLColumns returns&quot;</tt>.</p>

<p style="margin-left:11%; margin-top: 1em">And for
<small>SQL/CLI</small> standard information on SQLColumns
you&rsquo;d read page 124 of the (very large)
<small>SQL/CLI</small> Working Draft available from:</p>

<pre style="margin-left:11%; margin-top: 1em">  http://jtc1sc32.org/doc/N0701&minus;0750/32N0744T.pdf</pre>


<p style="margin-left:11%; margin-top: 1em"><b>Standards
Reference Information</b> <br>
A hyperlinked, browsable version of the <small>BNF</small>
syntax for <small>SQL92</small> (plus Oracle 7
<small>SQL</small> and <small>PL/SQL</small> ) is available
here:</p>

<pre style="margin-left:11%; margin-top: 1em">  http://cui.unige.ch/db&minus;research/Enseignement/analyseinfo/SQL92/BNFindex.html</pre>


<p style="margin-left:11%; margin-top: 1em">A
<small>BNF</small> syntax for <small>SQL3</small> is
available here:</p>

<pre style="margin-left:11%; margin-top: 1em">  http://www.sqlstandards.org/SC32/WG3/Progression_Documents/Informal_working_drafts/iso&minus;9075&minus;2&minus;1999.bnf</pre>


<p style="margin-left:11%; margin-top: 1em">The following
links provide further useful information about
<small>SQL.</small> Some of these are rather dated now but
may still be useful.</p>

<pre style="margin-left:11%; margin-top: 1em">  http://www.jcc.com/SQLPages/jccs_sql.htm
  http://www.contrib.andrew.cmu.edu/~shadow/sql.html
  http://www.altavista.com/query?q=sql+tutorial</pre>


<p style="margin-left:11%; margin-top: 1em"><b>Books and
Articles</b> <br>
Programming the Perl <small>DBI,</small> by Alligator
Descartes and Tim Bunce.
&lt;http://books.perl.org/book/154&gt;</p>

<p style="margin-left:11%; margin-top: 1em">Programming
Perl 3rd Ed. by Larry Wall, Tom Christiansen &amp; Jon
Orwant. &lt;http://books.perl.org/book/134&gt;</p>

<p style="margin-left:11%; margin-top: 1em">Learning Perl
by Randal Schwartz.
&lt;http://books.perl.org/book/101&gt;</p>

<p style="margin-left:11%; margin-top: 1em">Details of many
other books related to perl can be found at
&lt;http://books.perl.org&gt;</p>

<p style="margin-left:11%; margin-top: 1em"><b>Perl
Modules</b> <br>
Index of <small>DBI</small> related modules available from
<small>CPAN:</small></p>

<pre style="margin-left:11%; margin-top: 1em"> http://search.cpan.org/search?mode=module&amp;query=DBIx%3A%3A
 http://search.cpan.org/search?mode=doc&amp;query=DBI</pre>


<p style="margin-left:11%; margin-top: 1em">For a good
comparison of RDBMS-OO mappers and some OO-RDBMS mappers
(including Class::DBI, Alzabo, and DBIx::RecordSet in the
former category and Tangram and <small>SPOPS</small> in the
latter) see the Perl Object-Oriented Persistence project
pages at:</p>

<pre style="margin-left:11%; margin-top: 1em"> http://poop.sourceforge.net</pre>


<p style="margin-left:11%; margin-top: 1em">A similar page
for Java toolkits can be found at:</p>

<pre style="margin-left:11%; margin-top: 1em"> http://c2.com/cgi&minus;bin/wiki?ObjectRelationalToolComparison</pre>


<p style="margin-left:11%; margin-top: 1em"><b>Mailing
List</b> <br>
The <i>dbi-users</i> mailing list is the primary means of
communication among users of the <small>DBI</small> and its
related modules. For details send email to:</p>

<pre style="margin-left:11%; margin-top: 1em"> dbi&minus;users&minus;help@perl.org</pre>


<p style="margin-left:11%; margin-top: 1em">There are
typically between 700 and 900 messages per month. You have
to subscribe in order to be able to post. However you can
opt for a &rsquo;post&minus;only&rsquo; subscription.</p>

<p style="margin-left:11%; margin-top: 1em">Mailing list
archives (of variable quality) are held at:</p>

<pre style="margin-left:11%; margin-top: 1em"> http://groups.google.com/groups?group=perl.dbi.users
 http://www.xray.mpe.mpg.de/mailing&minus;lists/dbi/
 http://www.mail&minus;archive.com/dbi&minus;users%40perl.org/</pre>


<p style="margin-left:11%; margin-top: 1em"><b>Assorted
Related <small>WWW</small> Links</b> <br>
The <small>DBI</small> &quot;Home Page&quot;:</p>

<pre style="margin-left:11%; margin-top: 1em"> http://dbi.perl.org/</pre>


<p style="margin-left:11%; margin-top: 1em">Other
<small>DBI</small> related links:</p>

<pre style="margin-left:11%; margin-top: 1em"> http://tegan.deltanet.com/~phlip/DBUIdoc.html
 http://dc.pm.org/perl_db.html
 http://wdvl.com/Authoring/DB/Intro/toc.html
 http://www.hotwired.com/webmonkey/backend/tutorials/tutorial1.html
 http://bumppo.net/lists/macperl/1999/06/msg00197.html
 http://www.perlmonks.org/?node=DBI%20recipes
 http://www.perlmonks.org/?node=Speeding%20up%20the%20DBI</pre>


<p style="margin-left:11%; margin-top: 1em">Other database
related links:</p>

<pre style="margin-left:11%; margin-top: 1em"> http://www.jcc.com/sql_stnd.html
 http://cuiwww.unige.ch/OSG/info/FreeDB/FreeDB.home.html
 http://www.connectionstrings.com/</pre>


<p style="margin-left:11%; margin-top: 1em">Security,
especially the &quot; <small>SQL</small> Injection&quot;
attack:</p>

<pre style="margin-left:11%; margin-top: 1em"> http://www.ngssoftware.com/research/papers.html
 http://www.ngssoftware.com/papers/advanced_sql_injection.pdf
 http://www.ngssoftware.com/papers/more_advanced_sql_injection.pdf
 http://www.esecurityplanet.com/trends/article.php/2243461
 http://www.spidynamics.com/papers/SQLInjectionWhitePaper.pdf
 http://www.imperva.com/application_defense_center/white_papers/blind_sql_server_injection.html
 http://online.securityfocus.com/infocus/1644</pre>


<p style="margin-left:11%; margin-top: 1em">Commercial and
Data Warehouse Links</p>

<pre style="margin-left:11%; margin-top: 1em"> http://www.dwinfocenter.org
 http://www.datawarehouse.com
 http://www.datamining.org
 http://www.olapcouncil.org
 http://www.idwa.org
 http://www.knowledgecenters.org/dwcenter.asp</pre>


<p style="margin-left:11%; margin-top: 1em">Recommended
Perl Programming Links</p>

<pre style="margin-left:11%; margin-top: 1em"> http://language.perl.com/style/</pre>



<p style="margin-left:11%; margin-top: 1em"><b><small>FAQ</small></b>
<br>
See &lt;http://faq.dbi&minus;support.com/&gt;</p>

<h2>AUTHORS
<a name="AUTHORS"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><small>DBI</small>
by Tim Bunce, &lt;http://www.tim.bunce.name&gt;</p>

<p style="margin-left:11%; margin-top: 1em">This pod text
by Tim Bunce, J. Douglas Dunlop, Jonathan Leffler and
others. Perl by Larry Wall and the
<tt>&quot;perl5&minus;porters&quot;</tt>.</p>

<h2>COPYRIGHT
<a name="COPYRIGHT"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The
<small>DBI</small> module is Copyright (c) 1994&minus;2012
Tim Bunce. Ireland. All rights reserved.</p>

<p style="margin-left:11%; margin-top: 1em">You may
distribute under the terms of either the <small>GNU</small>
General Public License or the Artistic License, as specified
in the Perl 5.10.0 <small>README</small> file.</p>

<h2>SUPPORT / WARRANTY
<a name="SUPPORT / WARRANTY"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The
<small>DBI</small> is free Open Source software. <small>IT
COMES WITHOUT WARRANTY OF ANY KIND.</small></p>

<p style="margin-left:11%; margin-top: 1em"><b>Support</b>
<br>
My consulting company, Data Plan Services, offers annual and
multi-annual support contracts for the <small>DBI.</small>
These provide sustained support for <small>DBI</small>
development, and sustained value for you in return. Contact
me for details.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Sponsor
Enhancements</b> <br>
The <small>DBI</small> Roadmap is available at
&lt;http://search.cpan.org/~timb/DBI/Roadmap.pod&gt;</p>

<p style="margin-left:11%; margin-top: 1em">If your company
would benefit from a specific new <small>DBI</small>
feature, please consider sponsoring its development. Work is
performed rapidly, and usually on a fixed-price
payment-on-delivery basis. Contact me for details.</p>

<p style="margin-left:11%; margin-top: 1em">Using such
targeted financing allows you to contribute to
<small>DBI</small> development, and rapidly get something
specific and valuable in return.</p>

<h2>ACKNOWLEDGEMENTS
<a name="ACKNOWLEDGEMENTS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">I would like to
acknowledge the valuable contributions of the many people I
have worked with on the <small>DBI</small> project,
especially in the early years (1992&minus;1994). In no
particular order: Kevin Stock, Buzz Moschetti, Kurt
Andersen, Ted Lemon, William Hails, Garth Kennedy, Michael
Peppler, Neil S. Briscoe, Jeff Urlwin, David J. Hughes, Jeff
Stander, Forrest D Whitcher, Larry Wall, Jeff Fried, Roy
Johnson, Paul Hudson, Georg Rehfeld, Steve Sizemore, Ron
Pool, Jon Meek, Tom Christiansen, Steve Baumgarten, Randal
Schwartz, and a whole lot more.</p>

<p style="margin-left:11%; margin-top: 1em">Then, of
course, there are the poor souls who have struggled through
untold and undocumented obstacles to actually implement
<small>DBI</small> drivers. Among their ranks are Jochen
Wiedmann, Alligator Descartes, Jonathan Leffler, Jeff
Urlwin, Michael Peppler, Henrik Tougaard, Edwin Pratomo,
Davide Migliavacca, Jan Pazdziora, Peter Haworth, Edmund
Mergl, Steve Williams, Thomas Lowery, and Phlip Plumlee.
Without them, the <small>DBI</small> would not be the
practical reality it is today. I&rsquo;m also especially
grateful to Alligator Descartes for starting work on the
first edition of the &quot;Programming the Perl
<small>DBI&quot;</small> book and letting me jump on
board.</p>

<p style="margin-left:11%; margin-top: 1em">The
<small>DBI</small> and DBD::Oracle were originally developed
while I was Technical Director ( <small>CTO</small> ) of
Ingeneering in the <small>UK</small>
(&lt;http://www.ig.co.uk&gt;) (formerly known as the Paul
Ingram Group). So I&rsquo;d especially like to thank Paul
for his generosity and vision in supporting this work for
many years.</p>

<p style="margin-left:11%; margin-top: 1em">A couple of
specific <small>DBI</small> features have been sponsored by
enlightened companies:</p>

<p style="margin-left:11%; margin-top: 1em">The development
of the <i>swap_inner_handle()</i> method was sponsored by
BizRate.com (&lt;http://BizRate.com&gt;)</p>

<p style="margin-left:11%; margin-top: 1em">The development
of DBD::Gofer and related modules was sponsored by
Shopzilla.com (&lt;http://Shopzilla.com&gt;), where I
currently work.</p>

<h2>CONTRIBUTING
<a name="CONTRIBUTING"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">As you can see
above, many people have contributed to the
<small>DBI</small> and drivers in many ways over many
years.</p>

<p style="margin-left:11%; margin-top: 1em">If you&rsquo;d
like to help then see
&lt;http://dbi.perl.org/contributing&gt; and
&lt;http://search.cpan.org/~timb/DBI/Roadmap.pod&gt;</p>

<p style="margin-left:11%; margin-top: 1em">If you&rsquo;d
like the <small>DBI</small> to do something new or different
then a good way to make that happen is to do it yourself and
send me a patch to the source code that shows the changes.
(But read &quot;Speak before you patch&quot; below.)</p>

<p style="margin-left:11%; margin-top: 1em"><b>Browsing the
source code repository</b> <br>
Use http://svn.perl.org/modules/dbi/trunk (basic) or
http://svn.perl.org/viewcvs/modules/ (more useful)</p>

<p style="margin-left:11%; margin-top: 1em"><b>How to
create a patch using Subversion</b> <br>
The <small>DBI</small> source code is maintained using
Subversion (a replacement for <small>CVS,</small> see
&lt;http://subversion.tigris.org/&gt;). To access the source
you&rsquo;ll need to install a Subversion client. Then, to
get the source code, do:</p>

<pre style="margin-left:11%; margin-top: 1em">  svn checkout http://svn.perl.org/modules/dbi/trunk</pre>


<p style="margin-left:11%; margin-top: 1em">If it prompts
for a username and password use your perl.org account if you
have one, else just &rsquo;guest&rsquo; and
&rsquo;guest&rsquo;. The source code will be in a new
subdirectory called <tt>&quot;trunk&quot;</tt>.</p>

<p style="margin-left:11%; margin-top: 1em">To keep
informed about changes to the source you can send an empty
email to
svn&minus;commit&minus;modules&minus;dbi&minus;subscribe@perl.org
after which you&rsquo;ll get an email with the change log
message and diff of each change checked-in to the
source.</p>

<p style="margin-left:11%; margin-top: 1em">After making
your changes you can generate a patch file, but before you
do, make sure your source is still up to date using:</p>

<pre style="margin-left:11%; margin-top: 1em">  svn update</pre>


<p style="margin-left:11%; margin-top: 1em">If you get any
conflicts reported you&rsquo;ll need to fix them first. Then
generate the patch file from within the
<tt>&quot;trunk&quot;</tt> directory using:</p>

<pre style="margin-left:11%; margin-top: 1em">  svn diff &gt; foo.patch</pre>


<p style="margin-left:11%; margin-top: 1em">Read the patch
file, as a sanity check, and then email it to
dbi&minus;dev@perl.org.</p>

<p style="margin-left:11%; margin-top: 1em"><b>How to
create a patch without Subversion</b> <br>
Unpack a fresh copy of the distribution:</p>

<pre style="margin-left:11%; margin-top: 1em">  tar xfz DBI&minus;1.40.tar.gz</pre>


<p style="margin-left:11%; margin-top: 1em">Rename the
newly created top level directory:</p>

<pre style="margin-left:11%; margin-top: 1em">  mv DBI&minus;1.40 DBI&minus;1.40.your_foo</pre>


<p style="margin-left:11%; margin-top: 1em">Edit the
contents of <small>DBI&minus;1.40</small> .your_foo/* till
it does what you want.</p>

<p style="margin-left:11%; margin-top: 1em">Test your
changes and then remove all temporary files:</p>

<pre style="margin-left:11%; margin-top: 1em">  make test &amp;&amp; make distclean</pre>


<p style="margin-left:11%; margin-top: 1em">Go back to the
directory you originally unpacked the distribution:</p>
<pre style="margin-left:11%; margin-top: 1em">  cd ..</pre>

<p style="margin-left:11%; margin-top: 1em">Unpack
<i>another</i> copy of the original distribution you started
with:</p>

<pre style="margin-left:11%; margin-top: 1em">  tar xfz DBI&minus;1.40.tar.gz</pre>


<p style="margin-left:11%; margin-top: 1em">Then create a
patch file by performing a recursive
<tt>&quot;diff&quot;</tt> on the two top level
directories:</p>

<pre style="margin-left:11%; margin-top: 1em">  diff &minus;r &minus;u DBI&minus;1.40 DBI&minus;1.40.your_foo &gt; DBI&minus;1.40.your_foo.patch</pre>


<p style="margin-left:11%; margin-top: 1em"><b>Speak before
you patch</b> <br>
For anything non-trivial or possibly controversial
it&rsquo;s a good idea to discuss (on
dbi&minus;dev@perl.org) the changes you propose before
actually spending time working on them. Otherwise you run
the risk of them being rejected because they don&rsquo;t fit
into some larger plans you may not be aware of.</p>

<h2>TRANSLATIONS
<a name="TRANSLATIONS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">A German
translation of this manual (possibly slightly out of date)
is available, thanks to O&rsquo;Reilly, at:</p>

<pre style="margin-left:11%; margin-top: 1em">  http://www.oreilly.de/catalog/perldbiger/</pre>


<p style="margin-left:11%; margin-top: 1em">Some other
translations:</p>

<pre style="margin-left:11%; margin-top: 1em"> http://cronopio.net/perl/                              &minus; Spanish
 http://member.nifty.ne.jp/hippo2000/dbimemo.htm        &minus; Japanese</pre>


<h2>TRAINING
<a name="TRAINING"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">References to
<small>DBI</small> related training resources. No
recommendation implied.</p>

<pre style="margin-left:11%; margin-top: 1em">  http://www.treepax.co.uk/
  http://www.keller.com/dbweb/</pre>


<p style="margin-left:11%; margin-top: 1em">(If you offer
professional <small>DBI</small> related training services,
please send me your details so I can add them here.)</p>

<h2>OTHER RELATED WORK AND PERL MODULES
<a name="OTHER RELATED WORK AND PERL MODULES"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Apache::DBI by
E.Mergl@bawue.de</p>

<p style="margin-left:17%;">To be used with the Apache
daemon together with an embedded Perl interpreter like
<tt>&quot;mod_perl&quot;</tt>. Establishes a database
connection which remains open for the lifetime of the
<small>HTTP</small> daemon. This way the <small>CGI</small>
connect and disconnect for every database access becomes
superfluous.</p>

<p style="margin-left:11%;"><small>SQL</small> Parser</p>

<p style="margin-left:17%;">See also the SQL::Statement
module, <small>SQL</small> parser and engine.</p>
<hr>
</body>
</html>
